<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: Ecore Connection Buffering</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Tizen Native API"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   &#160;<span id="projectnumber">4.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('group__Ecore__Con__Buffer.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Ecore Connection Buffering</div>  </div>
<div class="ingroups"><a class="el" href="group__Ecore__Con__Group.html">Ecore_Con - Connection functions</a></div></div><!--header-->
<div class="contents">
<p>As Ecore_Con works on an event driven design, as data arrives, events will be produced containing the data that arrived. It is up to the user of Ecore_Con to either parse as they go, append to a file to later parse the whole file in one go, or append to memory to parse or handle later.</p>
<p>To help with this Eina has some handy API's. The Eina_Binbuf and Eina_Strbuf APIs, abstract dynamic buffer management and make it trivial to handle buffers at runtime, without having to manage them. Eina_Binbuf makes it possible to create, expand, reset and slice a blob of memory - all via API. No system calls, no pointer manipulations and no size calculation.</p>
<p>Additional functions include adding content at specified byte positions in the buffer, escaping the inputs, find and replace strings. This provides extreme flexibility to play around, with a dynamic blob of memory.</p>
<p>It is good to free it (using <a class="el" href="group__Eina__Binary__Buffer__Group.html#gad2a923d52d52c688eb5e30caeed69b3c" title="Frees a string buffer.">eina_binbuf_free()</a>) after using it.</p>
<p>Eina_Binbuf compliments Ecore_Con use cases, where dynamic sizes of data arrive from the network (think http download in chunks). Using Eina_Binbuf provides enough flexibility to handle data as it arrives and to defer its processing until desired, without having to think about where to store the temporary data and how to manage its size.</p>
<p>An example of how to use these with Ecore_Con follows.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;Eina.h&gt;</span>
<span class="preprocessor"> #include &lt;Ecore.h&gt;</span>
<span class="preprocessor"> #include &lt;Ecore_Con.h&gt;</span>
 
 <span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>
 data_callback(<span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> type, <span class="keywordtype">void</span> *event)
 {
    <a class="code" href="struct__Ecore__Con__Event__Url__Data.html">Ecore_Con_Event_Url_Data</a> *url_data = event;
    <span class="keywordflow">if</span> ( url_data-&gt;<a class="code" href="struct__Ecore__Con__Event__Url__Data.html#a1d4725aa77f3875cc3405597a5fbff91">size</a> &gt; 0)
      {
         <span class="comment">// append data as it arrives - don&#39;t worry where or how it gets stored.</span>
         <span class="comment">// Also don&#39;t worry about size, expanding, reallocing etc.</span>
         <span class="comment">// just keep appending - size is automatically handled.</span>
 
         <a class="code" href="group__Eina__Binary__Buffer__Group.html#ga0f4c2dad6d375ce65bf71b26793b61b4" title="Appends a string of exact length to a buffer, reallocating as necessary.">eina_binbuf_append_length</a>(data, url_data-&gt;<a class="code" href="struct__Ecore__Con__Event__Url__Data.html#aaa4c4dbc6575b071164f8152a7808268">data</a>, url_data-&gt;<a class="code" href="struct__Ecore__Con__Event__Url__Data.html#a1d4725aa77f3875cc3405597a5fbff91">size</a>);
 
         fprintf(stderr, <span class="stringliteral">&quot;Appended %d \n&quot;</span>, url_data-&gt;<a class="code" href="struct__Ecore__Con__Event__Url__Data.html#a1d4725aa77f3875cc3405597a5fbff91">size</a>);
      }
    <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;
 }
 
 
 
 <span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>
 completion_callback(<span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> type, <span class="keywordtype">void</span> *event)
 {
    <a class="code" href="struct__Ecore__Con__Event__Url__Complete.html">Ecore_Con_Event_Url_Complete</a> *url_complete = event;
    printf(<span class="stringliteral">&quot;download completed with status code: %d\n&quot;</span>, url_complete-&gt;<a class="code" href="struct__Ecore__Con__Event__Url__Complete.html#ab842caa1615a911c3578e0dfeae5f773">status</a>);
 
    <span class="comment">// get the data back from Eina_Binbuf</span>
    <span class="keywordtype">char</span> *ptr = <a class="code" href="group__Eina__Binary__Buffer__Group.html#ga6dd556787568e0f9eac446ae7d1b5fdd" title="Retrieves a pointer to the contents of a string buffer.">eina_binbuf_string_get</a>(data);
    <span class="keywordtype">size_t</span> size = <a class="code" href="group__Eina__Binary__Buffer__Group.html#gac3b5a05306bf9face35e44c1f5e0a4bd" title="Retrieves the length of the string buffer content.">eina_binbuf_length_get</a>(data);
 
    <span class="comment">// process data as required (write to file)</span>
    fprintf(stderr, <span class="stringliteral">&quot;Size of data = %d bytes\n&quot;</span>, size);
    <span class="keywordtype">int</span> fd = open(<span class="stringliteral">&quot;./elm.png&quot;</span>, O_CREAT);
    write(fd, ptr, size);
    close(fd);
   
    <span class="comment">// free it when done.</span>
    <a class="code" href="group__Eina__Binary__Buffer__Group.html#gad2a923d52d52c688eb5e30caeed69b3c" title="Frees a string buffer.">eina_binbuf_free</a>(data);
 
    <a class="code" href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a>();
 
    <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;
 }
 
 
 <span class="keywordtype">int</span>
 main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
 {
 
    <span class="keyword">const</span> <span class="keywordtype">char</span> *url = <span class="stringliteral">&quot;http://www.enlightenment.org/p/index/d/logo.png&quot;</span>;
 
    <a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();
    <a class="code" href="group__Ecore__Con__Lib__Group.html#gab4ed9a3c2132b73373a63c7f63cd0c51" title="Initializes the Ecore_Con library.">ecore_con_init</a>();
    <a class="code" href="group__Ecore__Con__Url__Group.html#ga47ad809433853db53742f3fd5ce89ac9" title="Initializes the Ecore_Con_Url library.">ecore_con_url_init</a>();
   
 
    <span class="comment">// This is single additional line to manage dynamic network data.</span>
    <a class="code" href="group__Eina__Binary__Buffer__Group.html#ga914e43cfe068d65db0dd3fbb80bcfd2a">Eina_Binbuf</a> *data = <a class="code" href="group__Eina__Binary__Buffer__Group.html#gadbe23382e953ee1952de77242ddf767c" title="Creates a new string buffer.">eina_binbuf_new</a>();
    <a class="code" href="group__Ecore__Con__Url__Group.html#gad928193ae403bd05c1ce5ba48a1d52ea">Ecore_Con_Url</a> *url_con = <a class="code" href="group__Ecore__Con__Url__Group.html#ga33fda26e303bc0eacc3823b908221033" title="Creates and initializes a new Ecore_Con_Url connection object.">ecore_con_url_new</a>(url);
 
    <a class="code" href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62" title="Adds an event handler.">ecore_event_handler_add</a>(<a class="code" href="group__Ecore__Con__Events__Group.html#gadd78afe6a12c9bcb6bc57a1a96913f64">ECORE_CON_EVENT_URL_COMPLETE</a>,
                                                       completion_callback,
                                                       data);
    <a class="code" href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62" title="Adds an event handler.">ecore_event_handler_add</a>(<a class="code" href="group__Ecore__Con__Events__Group.html#gae7b3a53ead72f458acc53b107ddcaeed">ECORE_CON_EVENT_URL_DATA</a>,
                                                       data_callback,
                                                       data);
    <a class="code" href="group__Ecore__Con__Url__Group.html#ga25474c61332fa89a0db7e572c4519bdb" title="Sends a get request.">ecore_con_url_get</a>(url_con);
 
    <a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();
    <span class="keywordflow">return</span> 0;
 }
</pre></div> </div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
