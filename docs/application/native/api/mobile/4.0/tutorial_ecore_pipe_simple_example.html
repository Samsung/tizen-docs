<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: $title</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Tizen Native API"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   &#160;<span id="projectnumber">4.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('tutorial_ecore_pipe_simple_example.html','');
</script>
<div id="doc-content">
<div class="contents">
<div class="textblock"><p>This example shows some simple usage of ecore_pipe. We are going to create a pipe, fork our process, and then the child is going to communicate to the parent the result of its processing through the pipe.</p>
<p>As always we start with our includes, nothing special: <div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;unistd.h&gt;</span>
<span class="preprocessor">#include &lt;Ecore.h&gt;</span>
</pre></div></p>
<p>The first thing we are going to define in our example is the function we are going to run on the child process, which, as mentioned, will do some processing and then will write the result to the pipe: <div class="fragment"><pre class="fragment">
<span class="keyword">static</span> <span class="keywordtype">void</span>
do_lengthy_task(<a class="code" href="group__Ecore__Pipe__Group.html#ga0092a6b764881362d1a051d7af215b3f">Ecore_Pipe</a> *pipe)
{
   <span class="keywordtype">int</span> i, j;
   <span class="keywordtype">char</span> *buffer;
   <span class="keywordflow">for</span> (i = 0; i &lt; 20; i++)
     {
        sleep(1);
        buffer = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * i);
        <span class="keywordflow">for</span> (j = 0; j &lt; i; j++)
          buffer[j] = <span class="charliteral">&#39;a&#39;</span> + j;
        <a class="code" href="group__Ecore__Pipe__Group.html#ga5336bc71e829c391926c26750ae0f407">ecore_pipe_write</a>(pipe, buffer, i);
        free(buffer);
     }
   <a class="code" href="group__Ecore__Pipe__Group.html#ga5336bc71e829c391926c26750ae0f407">ecore_pipe_write</a>(pipe, <span class="stringliteral">&quot;close&quot;</span>, 5);
}
</pre></div> </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The sleep was added so the parent process would think the child process was doing something interesting...</dd></dl>
<p>Next up is our function for handling data arriving in the pipe. It copies the data to another buffer, adds a terminating NULL and prints it. Also if it receives a certain string it stops the main loop(effectively ending the program): <div class="fragment"><pre class="fragment">
<span class="keyword">static</span> <span class="keywordtype">void</span>
handler(<span class="keywordtype">void</span> *data EINA_UNUSED, <span class="keywordtype">void</span> *buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len)
{
   <span class="keywordtype">char</span> *str = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * len + 1);
   memcpy(str, buf, len);
   str[len] = <span class="charliteral">&#39;\0&#39;</span>;
   printf(<span class="stringliteral">&quot;received %u bytes\n&quot;</span>, len);
   printf(<span class="stringliteral">&quot;content: %s\n&quot;</span>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)str);
   free(str);
   <span class="keywordflow">if</span> (len &amp;&amp; !strncmp(buf, <span class="stringliteral">&quot;close&quot;</span>, len &lt; 5 ? len : 5))
     {
        printf(<span class="stringliteral">&quot;close requested\n&quot;</span>);
        <a class="code" href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a>();
     }
}
</pre></div></p>
<p>And now on to our main function, we start by declaring some variables and initializing ecore: <div class="fragment"><pre class="fragment">
<span class="keywordtype">int</span>
main(<span class="keywordtype">void</span>)
{
   <a class="code" href="group__Ecore__Pipe__Group.html#ga0092a6b764881362d1a051d7af215b3f">Ecore_Pipe</a> *pipe;
   pid_t child_pid;

   <a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();
</pre></div></p>
<p>And since we are talking about pipes let's create one: <div class="fragment"><pre class="fragment">
   pipe = <a class="code" href="group__Ecore__Pipe__Group.html#ga3d584a8f962644f748dfd84d39d3421a">ecore_pipe_add</a>(handler, NULL);
</pre></div></p>
<p>Now we are going to fork: <div class="fragment"><pre class="fragment">
   child_pid = fork();
</pre></div> </p>
<dl class="note"><dt><b>Note:</b></dt><dd>duh...</dd></dl>
<p>The child process is going to do the our fancy processing: <div class="fragment"><pre class="fragment">   <span class="keywordflow">if</span> (!child_pid)
     {
        <a class="code" href="group__Ecore__Pipe__Group.html#gab9df469d955d67dbcd95fd6f2dabdc79">ecore_pipe_read_close</a>(pipe);
        do_lengthy_task(pipe);
     }
</pre></div> </p>
<dl class="note"><dt><b>Note:</b></dt><dd>It's very important to call <a class="el" href="group__Ecore__Pipe__Group.html#gab9df469d955d67dbcd95fd6f2dabdc79">ecore_pipe_read_close()</a> here so that the child process won't read what it is writing to the pipe itself.</dd></dl>
<p>And the parent is going to run ecore's main loop waiting for some data: <div class="fragment"><pre class="fragment">   <span class="keywordflow">else</span>
     {
        <a class="code" href="group__Ecore__Pipe__Group.html#ga60099202e0880dd3de617ca14fa0c58b">ecore_pipe_write_close</a>(pipe);
        <a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();
     }
</pre></div> </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Calling <a class="el" href="group__Ecore__Pipe__Group.html#ga60099202e0880dd3de617ca14fa0c58b">ecore_pipe_write_close()</a> here isn't important but since we aren't going to write in the pipe it is good practice.</dd></dl>
<p>And finally when done processing(the child) or done receiving(the parent) we delete the pipe and shutdown ecore: <div class="fragment"><pre class="fragment">
   <a class="code" href="group__Ecore__Pipe__Group.html#ga7ed5669e83a3119d2023c64288f9af60">ecore_pipe_del</a>(pipe);
   <a class="code" href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a>();

   <span class="keywordflow">return</span> 0;
}
</pre></div> </p>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
