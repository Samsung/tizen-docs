<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: Ecore_Con - Creating a client</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Tizen Native API"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   &#160;<span id="projectnumber">4.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ecore_con_client_simple_example_c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Ecore_Con - Creating a client </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Following the same idea as the <a class="el" href="ecore_con_server_simple_example_c.html">Ecore_Con - Creating a server</a> , this example will demonstrate how to create a client that connects to a specified server through a TCP port. You can see the full source code at <a class="el" href="ecore_con_client_simple_example_8c-example.html">ecore_con_client_simple_example::c</a>.</p>
<p>Starting from the <code>main</code> function, after reading the command line argument list and initializing the libraries, we try to connect to the server:</p>
 <div class="fragment"><pre class="fragment">main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])
{
   Ecore_Con_Server *svr;
   <span class="keyword">const</span> <span class="keywordtype">char</span> *address;
   <span class="keywordtype">int</span> port = 8080;

   <span class="keywordflow">if</span> (argc &lt; 2)
     {
        printf(<span class="stringliteral">&quot;wrong usage. Command syntax is:\n&quot;</span>);
        printf(<span class="stringliteral">&quot;\tecore_con_client_simple_example &lt;address&gt; [port]\n&quot;</span>);
        exit(1);
     }

   address = argv[1];

   <span class="keywordflow">if</span> (argc &gt; 2)
     port = atoi(argv[2]);

   <a class="code" href="group__Eina__Main__Group.html#gafee4bfc0e509b6ffed6598edf6f4b3de" title="Initializes the Eina library.">eina_init</a>();
   <a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();
   <a class="code" href="group__Ecore__Con__Lib__Group.html#gab4ed9a3c2132b73373a63c7f63cd0c51" title="Initializes the Ecore_Con library.">ecore_con_init</a>();

   <span class="keywordflow">if</span> (!(svr = <a class="code" href="group__Ecore__Con__Server__Group.html#ga2b9a5a5c222a4373642a8a2cd89c3a96" title="Creates a connection to the specified server and return an associated object.">ecore_con_server_connect</a>(<a class="code" href="group__Ecore__Con__Lib__Group.html#gga4862bfa05383e6e16a1dfc6eafc90564ab02a4b8522d1ed409cfb24131b24c4ed">ECORE_CON_REMOTE_TCP</a>, address, port, NULL)))
     {
        printf(<span class="stringliteral">&quot;could not connect to the server: %s, port %d.\n&quot;</span>,
               address, port);
        exit(2);
     }
</pre></div></p>
<p>After doing this, everything else in <code>main</code> is setting up callbacks for the client events, starting the main loop and shutting down the libraries after it.</p>
<p>Now let's go to the callbacks. These callbacks are very similar to the server callbacks (our implementation for this example is very simple). On the <code>_add</code> callback, we just set a data structure to the server, print some information about the server, and send a welcome message to it:</p>
 <div class="fragment"><pre class="fragment"><a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>
_add(<span class="keywordtype">void</span> *data EINA_UNUSED, <span class="keywordtype">int</span> type EINA_UNUSED, <a class="code" href="struct__Ecore__Con__Event__Server__Add.html">Ecore_Con_Event_Server_Add</a> *ev)
{
   <span class="keywordtype">char</span> welcome[] = <span class="stringliteral">&quot;hello! - sent from the client&quot;</span>;
   <span class="keyword">struct </span>_Server *server = malloc(<span class="keyword">sizeof</span>(*server));
   server-&gt;sdata = 0;

   <a class="code" href="group__Ecore__Con__Server__Group.html#ga12b68266944e6158cf6c17b505dfbe89" title="Sets the data associated with the given server.">ecore_con_server_data_set</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Add.html#a382a9545ed7fb941a30dc4d598dc7e4d">server</a>, server);
   printf(<span class="stringliteral">&quot;Server with ip %s, name %s, port %d, connected = %d!\n&quot;</span>,
          <a class="code" href="group__Ecore__Con__Server__Group.html#ga5654e8080a83341d0485d13efb394a62" title="Gets the IP address of a server that has been connected to.">ecore_con_server_ip_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Add.html#a382a9545ed7fb941a30dc4d598dc7e4d">server</a>),
          ecore_con_server_name_get(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Add.html#a382a9545ed7fb941a30dc4d598dc7e4d">server</a>),
          <a class="code" href="group__Ecore__Con__Server__Group.html#gab3764cce4f570746b5dd863ccc3eec5f" title="Retrieves the server port in use.">ecore_con_server_port_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Add.html#a382a9545ed7fb941a30dc4d598dc7e4d">server</a>),
          <a class="code" href="group__Ecore__Con__Server__Group.html#ga8cf899aa02fcacd499b06b788795c06d" title="Retrieves whether the given server is currently connected.">ecore_con_server_connected_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Add.html#a382a9545ed7fb941a30dc4d598dc7e4d">server</a>));
   <a class="code" href="group__Ecore__Con__Server__Group.html#gadc54105adc673a41731b18a804c97cd9" title="Sends the given data to the given server.">ecore_con_server_send</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Add.html#a382a9545ed7fb941a30dc4d598dc7e4d">server</a>, welcome, <span class="keyword">sizeof</span>(welcome));
   <a class="code" href="group__Ecore__Con__Server__Group.html#ga582b956b0b3e072c0caa406c3fe6b06b" title="Flushes all pending data to the given server.">ecore_con_server_flush</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Add.html#a382a9545ed7fb941a30dc4d598dc7e4d">server</a>);

   <span class="keywordflow">return</span> <a class="code" href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a>;
}
</pre></div></p>
<p>The <code>_del</code> callback is as simple as the previous one. We free the data associated with the server, print the uptime of this client, and quit the main loop (since there's nothing to do once we disconnect):</p>
<p><div class="fragment"><pre class="fragment">
<a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>
_del(<span class="keywordtype">void</span> *data EINA_UNUSED, <span class="keywordtype">int</span> type EINA_UNUSED, <a class="code" href="struct__Ecore__Con__Event__Server__Del.html">Ecore_Con_Event_Server_Del</a> *ev)
{
   <span class="keywordflow">if</span> (!ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Del.html#a116963b404600e7154c61f94ebf52a2e">server</a>)
     {
        printf(<span class="stringliteral">&quot;Failed to establish connection to the server.\nExiting.\n&quot;</span>);
        <a class="code" href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a>();
        <span class="keywordflow">return</span> <a class="code" href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a>;
     }
</pre></div></p>
<p>The <code>_data</code> callback is also similar to the server data callback. it will print any received data, and increase the data counter in the structure associated with this server:</p>
<p><div class="fragment"><pre class="fragment"><a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>
_data(<span class="keywordtype">void</span> *data EINA_UNUSED, <span class="keywordtype">int</span> type EINA_UNUSED, <a class="code" href="struct__Ecore__Con__Event__Server__Data.html">Ecore_Con_Event_Server_Data</a> *ev)
{
   <span class="keywordtype">char</span> fmt[128];
   <span class="keyword">struct </span>_Server *server = <a class="code" href="group__Ecore__Con__Server__Group.html#gaa349f850bb5ab786c530c6e6f91a1942" title="Retrieves the data associated with the given server.">ecore_con_server_data_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Data.html#a632e6c0033302088e26479c4fa17e0c0">server</a>);

   snprintf(fmt, <span class="keyword">sizeof</span>(fmt),
            <span class="stringliteral">&quot;Received %i bytes from server:\n&quot;</span>
            <span class="stringliteral">&quot;&gt;&gt;&gt;&gt;&gt;\n&quot;</span>
            <span class="stringliteral">&quot;%%.%is\n&quot;</span>
            <span class="stringliteral">&quot;&gt;&gt;&gt;&gt;&gt;\n&quot;</span>,
            ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Data.html#a41877d1f1cb9792508b9b1d89d53bec2">size</a>, ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Data.html#a41877d1f1cb9792508b9b1d89d53bec2">size</a>);

   printf(fmt, ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Data.html#a8d45b6d75c55b26771d241211a0d7e7e">data</a>);

   server-&gt;sdata += ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Server__Data.html#a41877d1f1cb9792508b9b1d89d53bec2">size</a>;
   <span class="keywordflow">return</span> <a class="code" href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a>;
}
</pre></div></p>
<p>You can see the server counterpart functions of the ones used in this example in the <a class="el" href="ecore_con_server_simple_example_c.html">Ecore_Con - Creating a server</a>.</p>
<p>This example will connect to the server and start comunicating with it, as demonstrated in the following diagram:  
 <img src="ecore_con-client-server-example2.png" style="max-width: 400px"/>
 <a href="ecore_con-client-server-example2.png">Full size</a>
  <dl class="note"><dt><b>Note:</b></dt><dd>This example contains a serious security flaw: it doesn't check for the size of data being received, thus allowing to the string to be exploited in some way. However, it is left like this to make the code simpler and just demonstrate the API usage. </dd></dl>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
