<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: Benchmark Tutorial</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Tizen Native API"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   &#160;<span id="projectnumber">4.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('tutorial_benchmark_page.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Benchmark Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Benchmark module allows you to write easily benchmarks framework in a project for timing critical part and detect slow parts of code. In addition it automatically creates data files of these benchmark, as well as a gnuplot file which can display the comparison curves of the benchmarks.</p>
<h2><a class="anchor" id="tutorial_benchmark_basic_usage"></a>
Basic Usage</h2>
<p>To create a basic benchmark, you have to follow these steps:</p>
<ul>
<li>Create a new benchmark </li>
<li>Write the functions that wraps the functions you want to benchmark. </li>
<li>Register these wrappers functions. </li>
<li>Run the benchmark. </li>
<li>Free the memory.</li>
</ul>
<p>Here is a basic example of benchmark which creates two functions that will be run. These functions just print a message.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;stdlib.h&gt;</span>
<span class="preprocessor"> #include &lt;stdio.h&gt;</span>

<span class="preprocessor"> #include &lt;Eina.h&gt;</span>

 <span class="keyword">static</span>
 <span class="keywordtype">void</span> work1(<span class="keywordtype">int</span> request)
 {
   printf (<span class="stringliteral">&quot;work1 in progress... Request: %d\n&quot;</span>, request);
 }

 <span class="keyword">static</span>
 <span class="keywordtype">void</span> work2(<span class="keywordtype">int</span> request)
 {
   printf (<span class="stringliteral">&quot;work2 in progress... Request: %d\n&quot;</span>, request);
 }

 <span class="keywordtype">int</span> main()
 {
   <a class="code" href="group__Eina__Benchmark__Group.html#gac5c05887f0ad72bfb28b53e6fde49ce2">Eina_Benchmark</a> *test;
   <a class="code" href="struct__Eina__Array.html">Eina_Array</a>     *ea;

   <span class="keywordflow">if</span> (!<a class="code" href="group__Eina__Main__Group.html#gafee4bfc0e509b6ffed6598edf6f4b3de" title="Initializes the Eina library.">eina_init</a>())
     <span class="keywordflow">return</span> EXIT_FAILURE;

   test = <a class="code" href="group__Eina__Benchmark__Group.html#gacd3e2dcff8292721754714125572936a" title="Creates a new array.">eina_benchmark_new</a>(<span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;run&quot;</span>);
   <span class="keywordflow">if</span> (!test)
     <span class="keywordflow">goto</span> shutdown_eina;

   <a class="code" href="group__Eina__Benchmark__Group.html#gacd15985f85c6cbfe21f7c1c1902dd2b3" title="Adds a test to a benchmark.">eina_benchmark_register</a>(test, <span class="stringliteral">&quot;work-1&quot;</span>, <a class="code" href="group__Eina__Benchmark__Group.html#ga64c3594df1ad868efe1454c34e3e1c37" title="Definition for the cast to an Eina_Benchmark_Specimens.">EINA_BENCHMARK</a>(work1), 200, 300, 10);
   <a class="code" href="group__Eina__Benchmark__Group.html#gacd15985f85c6cbfe21f7c1c1902dd2b3" title="Adds a test to a benchmark.">eina_benchmark_register</a>(test, <span class="stringliteral">&quot;work-2&quot;</span>, <a class="code" href="group__Eina__Benchmark__Group.html#ga64c3594df1ad868efe1454c34e3e1c37" title="Definition for the cast to an Eina_Benchmark_Specimens.">EINA_BENCHMARK</a>(work2), 100, 150, 5);

   ea = <a class="code" href="group__Eina__Benchmark__Group.html#ga56b67e26be3cf49cccffa4c148148eaf" title="Runs the benchmark tests that have been registered.">eina_benchmark_run</a>(test);

   <a class="code" href="group__Eina__Benchmark__Group.html#gac8f2877d714ab6fe90d0fa08f87567c5" title="Frees a benchmark object.">eina_benchmark_free</a>(test);
   <a class="code" href="group__Eina__Main__Group.html#ga2c8b4020427108a30c44707af22c99d3" title="Shuts down the Eina library.">eina_shutdown</a>();

   <span class="keywordflow">return</span> EXIT_SUCCESS;

  shutdown_eina:
   <a class="code" href="group__Eina__Main__Group.html#ga2c8b4020427108a30c44707af22c99d3" title="Shuts down the Eina library.">eina_shutdown</a>();

   <span class="keywordflow">return</span> EXIT_FAILURE;
 }
</pre></div><p>As "test", "run" are passed to <a class="el" href="group__Eina__Benchmark__Group.html#gacd3e2dcff8292721754714125572936a" title="Creates a new array.">eina_benchmark_new()</a> and as the tests "work-1" and "work-2" are registered, the data files bench_test_run.work-1.data and bench_test_run.work-2.data will be created after the <a class="el" href="group__Eina__Benchmark__Group.html#ga56b67e26be3cf49cccffa4c148148eaf" title="Runs the benchmark tests that have been registered.">eina_benchmark_run()</a> call. They contain four columns. The file bench_test_run.work-1.data contains for example:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> # specimen      experiment time starting time   ending time</span>
<span class="preprocessor"></span> 200     23632   2852446 2876078
 210     6924    2883046 2889970
 220     6467    2895962 2902429
 230     6508    2908271 2914779
 240     6278    2920610 2926888
 250     6342    2932830 2939172
 260     6252    2944954 2951206
 270     6463    2956978 2963441
 280     6347    2969548 2975895
 290     6457    2981702 2988159
</pre></div><p>The first column (specimen) is the integer passed to the work1() function when the test is run. The second column (experiment time) is the time, in nanosecond, that work1() takes. The third and fourth column are self-explicit.</p>
<p>You can see that the integer passed work1() starts from 200 and finishes at 290, with a step of 10. These values are computed withe last 3 values passed to <a class="el" href="group__Eina__Benchmark__Group.html#gacd15985f85c6cbfe21f7c1c1902dd2b3" title="Adds a test to a benchmark.">eina_benchmark_register()</a>. See the document of that function for the detailed behavior.</p>
<p>The gnuplot file will be named bench_test_run.gnuplot. Just run:</p>
<div class="fragment"><pre class="fragment"> gnuplot bench_test_run.gnuplot
</pre></div><p>To create the graphic of the comparison curves. The image file is named output_test_run.png.</p>
<h2><a class="anchor" id="tutorial_benchmark_advanced_usage"></a>
More Advanced Usage</h2>
<p>In this section, several test will be created and run. The idea is exactly the same than in the previous section, but with some basic automatic way to run all the benchmarks. The following code benchmarks some Eina converts functions, and some Eina containers types:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;stdlib.h&gt;</span>
<span class="preprocessor"> #include &lt;stdio.h&gt;</span>
<span class="preprocessor"> #include &lt;time.h&gt;</span>

<span class="preprocessor"> #include &lt;Eina.h&gt;</span>

 <span class="keyword">static</span> <span class="keywordtype">void</span> bench_convert(<a class="code" href="group__Eina__Benchmark__Group.html#gac5c05887f0ad72bfb28b53e6fde49ce2">Eina_Benchmark</a> *bench);
 <span class="keyword">static</span> <span class="keywordtype">void</span> bench_container(<a class="code" href="group__Eina__Benchmark__Group.html#gac5c05887f0ad72bfb28b53e6fde49ce2">Eina_Benchmark</a> *bench);

 <span class="keyword">typedef</span> <span class="keyword">struct </span>_Benchmark_Case Benchmark_Case;

 <span class="keyword">struct </span>_Benchmark_Case
 {
    <span class="keyword">const</span> <span class="keywordtype">char</span> *bench_case;
    void (*build)(<a class="code" href="group__Eina__Benchmark__Group.html#gac5c05887f0ad72bfb28b53e6fde49ce2">Eina_Benchmark</a> *bench);
 };

 <span class="keyword">static</span> <span class="keyword">const</span> Benchmark_Case benchmarks[] = {
   { <span class="stringliteral">&quot;Bench 1&quot;</span>, bench_convert },
   { <span class="stringliteral">&quot;Bench 2&quot;</span>, bench_container },
   { NULL,      NULL }
 };

 <span class="keyword">static</span>
 <span class="keywordtype">void</span> convert1(<span class="keywordtype">int</span> request)
 {
   <span class="keywordtype">char</span> tmp[128];
   <span class="keywordtype">int</span> i;

   srand(time(NULL));

   <span class="keywordflow">for</span> (i = 0; i &lt; request; ++i)
     <a class="code" href="group__Eina__Convert__Group.html#ga5e292923035dd6229795f18dce2df671" title="Converts an integer number to a string in decimal base.">eina_convert_itoa</a>(rand(), tmp);
 }

 <span class="keyword">static</span>
 <span class="keywordtype">void</span> convert2(<span class="keywordtype">int</span> request)
 {
   <span class="keywordtype">char</span> tmp[128];
   <span class="keywordtype">int</span> i;

   srand(time(NULL));

   <span class="keywordflow">for</span> (i = 0; i &lt; request; ++i)
     <a class="code" href="group__Eina__Convert__Group.html#gabcff6a3b75bf963036b9b0386359417f" title="Converts an integer number to a string in hexadecimal base.">eina_convert_xtoa</a>(rand(), tmp);
 }

 <span class="keyword">static</span> <span class="keywordtype">void</span>
 bench_convert(<a class="code" href="group__Eina__Benchmark__Group.html#gac5c05887f0ad72bfb28b53e6fde49ce2">Eina_Benchmark</a> *bench)
 {
   <a class="code" href="group__Eina__Benchmark__Group.html#gacd15985f85c6cbfe21f7c1c1902dd2b3" title="Adds a test to a benchmark.">eina_benchmark_register</a>(bench, <span class="stringliteral">&quot;convert-1&quot;</span>, <a class="code" href="group__Eina__Benchmark__Group.html#ga64c3594df1ad868efe1454c34e3e1c37" title="Definition for the cast to an Eina_Benchmark_Specimens.">EINA_BENCHMARK</a>(convert1), 200, 400, 10);
   <a class="code" href="group__Eina__Benchmark__Group.html#gacd15985f85c6cbfe21f7c1c1902dd2b3" title="Adds a test to a benchmark.">eina_benchmark_register</a>(bench, <span class="stringliteral">&quot;convert-2&quot;</span>, <a class="code" href="group__Eina__Benchmark__Group.html#ga64c3594df1ad868efe1454c34e3e1c37" title="Definition for the cast to an Eina_Benchmark_Specimens.">EINA_BENCHMARK</a>(convert2), 200, 400, 10);
 }

 <span class="keyword">static</span>
 <span class="keywordtype">void</span> array(<span class="keywordtype">int</span> request)
 {
   <a class="code" href="struct__Eina__Array.html">Eina_Array</a> *array;
   <a class="code" href="group__Eina__Array__Group.html#gaf9af7cd8afa60d6b1cab805bd5b838aa">Eina_Array_Iterator</a> it;
   <span class="keywordtype">int</span> *data;
   <span class="keywordtype">int</span> i;

   srand(time(NULL));

   array = <a class="code" href="group__Eina__Array__Group.html#gad671e356ded4049ccff24cc46f6f6f43" title="Creates a new array.">eina_array_new</a>(64);

   <span class="keywordflow">for</span> (i = 0; i &lt; request; ++i)
     {
       data = (<span class="keywordtype">int</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
       <span class="keywordflow">if</span> (!data) <span class="keywordflow">continue</span>;
       *data = rand();
       <a class="code" href="group__Eina__Array__Group.html#ga888077184f320f9324d90e11829f81f0" title="Appends a data to an array.">eina_array_push</a>(array, data);
     }

   <a class="code" href="group__Eina__Array__Group.html#ga810ed3618ca03f7d549a1bf2c33b2b6e" title="Definition for the macro to iterate over an array easily.">EINA_ARRAY_ITER_NEXT</a>(array, i, data, it)
     free(data);

   <a class="code" href="group__Eina__Array__Group.html#gaee9eb6a413ab294a5d69771f14cf3543" title="Frees an array.">eina_array_free</a>(array);
 }

 static
 <span class="keywordtype">void</span> list(<span class="keywordtype">int</span> request)
 {
   <a class="code" href="struct__Eina__List.html">Eina_List</a> *l = NULL;
   <span class="keywordtype">int</span> *data;
   <span class="keywordtype">int</span> i;

   srand(time(NULL));

   <span class="keywordflow">for</span> (i = 0; i &lt; request; ++i)
     {
       data = (<span class="keywordtype">int</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
       <span class="keywordflow">if</span> (!data) <span class="keywordflow">continue</span>;
       *data = rand();
       l = <a class="code" href="group__Eina__List__Group.html#ga9f35bfc7c5b798014c3e0a74bc6f39ad" title="Prepends the given data to the given linked list.">eina_list_prepend</a>(l, data);
     }

   <span class="keywordflow">while</span> (l)
     {
       free(<a class="code" href="group__Eina__List__Group.html#gaec845f0bfb16a14e8d7f0cd508ca7e9c" title="Gets the list node data member.">eina_list_data_get</a>(l));
       l = <a class="code" href="group__Eina__List__Group.html#ga7edefe0975beecc76c02525fb9200f5a" title="Removes the specified list node.">eina_list_remove_list</a>(l, l);
     }
 }

 <span class="keyword">static</span> <span class="keywordtype">void</span>
 bench_container(<a class="code" href="group__Eina__Benchmark__Group.html#gac5c05887f0ad72bfb28b53e6fde49ce2">Eina_Benchmark</a> *bench)
 {
   <a class="code" href="group__Eina__Benchmark__Group.html#gacd15985f85c6cbfe21f7c1c1902dd2b3" title="Adds a test to a benchmark.">eina_benchmark_register</a>(bench, <span class="stringliteral">&quot;array&quot;</span>, <a class="code" href="group__Eina__Benchmark__Group.html#ga64c3594df1ad868efe1454c34e3e1c37" title="Definition for the cast to an Eina_Benchmark_Specimens.">EINA_BENCHMARK</a>(array), 200, 300, 10);
   <a class="code" href="group__Eina__Benchmark__Group.html#gacd15985f85c6cbfe21f7c1c1902dd2b3" title="Adds a test to a benchmark.">eina_benchmark_register</a>(bench, <span class="stringliteral">&quot;list&quot;</span>, <a class="code" href="group__Eina__Benchmark__Group.html#ga64c3594df1ad868efe1454c34e3e1c37" title="Definition for the cast to an Eina_Benchmark_Specimens.">EINA_BENCHMARK</a>(list), 200, 300, 10);
 }

 <span class="keywordtype">int</span> main()
 {
   <a class="code" href="group__Eina__Benchmark__Group.html#gac5c05887f0ad72bfb28b53e6fde49ce2">Eina_Benchmark</a> *test;
   <a class="code" href="struct__Eina__Array.html">Eina_Array</a>     *ea;
   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    i;

   <span class="keywordflow">if</span> (!<a class="code" href="group__Eina__Main__Group.html#gafee4bfc0e509b6ffed6598edf6f4b3de" title="Initializes the Eina library.">eina_init</a>())
     <span class="keywordflow">return</span> EXIT_FAILURE;

   <span class="keywordflow">for</span> (i = 0; benchmarks[i].bench_case != NULL; ++i)
     {
       test = <a class="code" href="group__Eina__Benchmark__Group.html#gacd3e2dcff8292721754714125572936a" title="Creates a new array.">eina_benchmark_new</a>(benchmarks[i].bench_case, <span class="stringliteral">&quot;Benchmark example&quot;</span>);
       <span class="keywordflow">if</span> (!test)
         <span class="keywordflow">continue</span>;

       benchmarks[i].build(test);

       ea = <a class="code" href="group__Eina__Benchmark__Group.html#ga56b67e26be3cf49cccffa4c148148eaf" title="Runs the benchmark tests that have been registered.">eina_benchmark_run</a>(test);

       <a class="code" href="group__Eina__Benchmark__Group.html#gac8f2877d714ab6fe90d0fa08f87567c5" title="Frees a benchmark object.">eina_benchmark_free</a>(test);
     }

   <a class="code" href="group__Eina__Main__Group.html#ga2c8b4020427108a30c44707af22c99d3" title="Shuts down the Eina library.">eina_shutdown</a>();

   <span class="keywordflow">return</span> EXIT_SUCCESS;
 }
</pre></div><p>gnuplot can be used to see how are performed the convert functions together, as well as how are performed the containers. So it is now easy to see that the hexadecimal convert function is faster than the decimal one, and that arrays are faster than lists.</p>
<p>You can improve all that by executing automatically gnuplot in your program, or integrate the Eina benchmark framework in an autotooled project. See that <a href="http://trac.enlightenment.org/e/wiki/AutotoolsIntegration#Benchmark">page</a> for more informations. </p>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
