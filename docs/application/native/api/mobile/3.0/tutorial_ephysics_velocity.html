<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: EPhysics - Velocity</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">EPhysics - Velocity </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of this example is to demonstrate the EPhysics Velocity usage - The code adds a small bouncing ball on the ground and responding to users events by making it jump - applying a central impulse on it and showing its velocity and acceleration.</p>
<p>We'll see in this example how to get EPhysics_Body Linear and Angular velocity and acceleration.</p>
<p>For this example we'll have an EPhysics_World and one basic EPhysics_Body, we'll apply impulses that follows user events, it were already covered in <a class="el" href="tutorial_ephysics_bouncing_ball.html">EPhysics - Bouncing Ball</a></p>
<h2><a class="anchor" id="add-velstruct"></a>
Velocity Data Struct</h2>
<p>While in this example we'll be working with a struct to hold some objects in our code. For clarity sake we present you the struct declaration in the following block.</p>
<p><div class="fragment"><pre class="fragment"><span class="keyword">struct </span>_Velocity_Data {
     Test_Data base;
     EPhysics_Body *body;
     <span class="keywordtype">double</span> old_vx;
     <span class="keywordtype">double</span> old_vy;
     <span class="keywordtype">double</span> old_vaz;
     <span class="keywordtype">double</span> last_time;
};
</pre></div></p>
<h2><a class="anchor" id="add-callbacks"></a>
Adding the Callback</h2>
<p>Calling ephysics_body_event_callback_add() will register a callback to a type of physics body event.</p>
<p>EPHYSICS_CALLBACK_BODY_UPDATE : called after every physics iteration. In other words, will be called after each world tick.</p>
<p><div class="fragment"><pre class="fragment">   ephysics_body_event_callback_add(sphere_body, EPHYSICS_CALLBACK_BODY_UPDATE,
                                    _update_vel_cb, velocity_data);
</pre></div></p>
<p>EPHYSICS_CALLBACK_BODY_STOPPED : called when a body is found to be stopped. In other words, when the body is not moving anymore.</p>
<p><div class="fragment"><pre class="fragment">   ephysics_body_event_callback_add(sphere_body, EPHYSICS_CALLBACK_BODY_STOPPED,
                                    _update_vel_cb, velocity_data);
</pre></div></p>
<p>See _EPhysics_Callback_Body_Type for more event types.</p>
<h2><a class="anchor" id="add-velcb"></a>
Velocity Function</h2>
<p>The callback function will be called on every physics iteration to show the linear and angular velocity and acceleration.</p>
<p>Here we're declaring the necessary variables to calculate acelerations and delta time. And checking if its the first time to return before shows informations about the velocity.</p>
<p><div class="fragment"><pre class="fragment">_update_vel_cb(<span class="keywordtype">void</span> *data, EPhysics_Body *body, <span class="keywordtype">void</span> *event_info __UNUSED__)
{
   Velocity_Data *velocity_data = data;
   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a> first_call = <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;
   <span class="keywordtype">double</span> vx, vy, ax, ay, vaz, aaz;
   <span class="keywordtype">double</span> time_now, delta_time;
   <span class="keywordtype">char</span> buff[64];

   <span class="keywordflow">if</span> (!velocity_data-&gt;last_time)
     first_call = <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;
</pre></div></p>
<p>Get the delta time to use it soon to calculate the acceleration on every physics iteration.</p>
<p><div class="fragment"><pre class="fragment">   time_now = <a class="code" href="group__Ecore__Time__Group.html#ga98f2439b5d3e7114a75bfe2f0c22c4e9">ecore_time_get</a>();
   delta_time = time_now - velocity_data-&gt;last_time;
   velocity_data-&gt;last_time = time_now;
</pre></div></p>
<p>Note in this part we get the angular and linear velocities.</p>
<p><div class="fragment"><pre class="fragment">   ephysics_body_angular_velocity_get(body, NULL, NULL, &amp;vaz);
   ephysics_body_linear_velocity_get(body, &amp;vx, &amp;vy, NULL);
</pre></div></p>
<p>We need to handle the velocity using delta time to have the acceleration on every tick. Check if its the first time to return before shows informations about the velocity because we don't have the old aceletations and then the calculation of this informations will be wrong.</p>
<p>Here we calculate the aceletarions using this formula:</p>
<p>(velocity - old_velocity) / delta_time;</p>
<p><div class="fragment"><pre class="fragment">   aaz = (vaz - velocity_data-&gt;old_vaz) / delta_time;
   velocity_data-&gt;old_vaz = vaz;
   ax = (vx - velocity_data-&gt;old_vx) / delta_time;
   velocity_data-&gt;old_vx = vx;
   ay = (vy - velocity_data-&gt;old_vy) / delta_time;
   velocity_data-&gt;old_vy = vy;

   <span class="keywordflow">if</span> (first_call) <span class="keywordflow">return</span>;
</pre></div></p>
<p>Turning data into text, to pass it to edje shows on screen.</p>
<p><div class="fragment"><pre class="fragment">   snprintf(buff, <span class="keyword">sizeof</span>(buff), <span class="stringliteral">&quot;Linear velocity: %.2f, %.2f&quot;</span>, vx, vy);
   <a class="code" href="group__Elm__Layout.html#ga3f40a6922d36558fbaca0b7d7814ed8d" title="Set the text of the given part.">elm_layout_text_set</a>(velocity_data-&gt;base.layout, <span class="stringliteral">&quot;linear_vel&quot;</span>, buff);
   snprintf(buff, <span class="keyword">sizeof</span>(buff), <span class="stringliteral">&quot;Linear acceleration: %.2f, %.2f&quot;</span>, ax, ay);
   <a class="code" href="group__Elm__Layout.html#ga3f40a6922d36558fbaca0b7d7814ed8d" title="Set the text of the given part.">elm_layout_text_set</a>(velocity_data-&gt;base.layout, <span class="stringliteral">&quot;linear_acc&quot;</span>, buff);
   snprintf(buff, <span class="keyword">sizeof</span>(buff), <span class="stringliteral">&quot;Angular velocity: %.2f&quot;</span>, vaz);
   <a class="code" href="group__Elm__Layout.html#ga3f40a6922d36558fbaca0b7d7814ed8d" title="Set the text of the given part.">elm_layout_text_set</a>(velocity_data-&gt;base.layout, <span class="stringliteral">&quot;angular_vel&quot;</span>, buff);
   snprintf(buff, <span class="keyword">sizeof</span>(buff), <span class="stringliteral">&quot;Angular acceleration: %.2f&quot;</span>, aaz);
   <a class="code" href="group__Elm__Layout.html#ga3f40a6922d36558fbaca0b7d7814ed8d" title="Set the text of the given part.">elm_layout_text_set</a>(velocity_data-&gt;base.layout, <span class="stringliteral">&quot;angular_acc&quot;</span>, buff);
}
</pre></div></p>
<p>Here we finish the example. The full source code can be found at <a class="el" href="test_velocity_c.html">test_velocity.c</a>. </p>
</div></div><!-- contents -->
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
