<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: Eina value custom type example</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Tizen Native API"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('eina_value_example_03_page.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Eina value custom type example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>For this example we'll be creating our own custom type of eina value. Eina value can already store struct timeval(man gettimeofday for more information) but it has no type to store struct timezone, so that's what this example will do. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>struct timezone is actually obsolete, so using it in real world programs is probably not a good idea, but this is an example so, bear with us.</dd></dl>
<p>To create our own custom eina value type we need to define functions to do the following operations on it: </p>
<ul>
<li>Setup </li>
<li>Flush </li>
<li>Copy </li>
<li>Compare </li>
<li>Set </li>
<li>Get </li>
<li>Conversion</li>
</ul>
<p>Most of this functions are very simple, so let's look at them, starting with setup which only clear the memory so that we can be certain we won't be using stale data: <div class="fragment"><pre class="fragment"></pre></div></p>
<p>Now the flush function, which is even simpler, it does nothing, that's because there is nothing we need to do, all the necessary steps are taken by eina value itself: <div class="fragment"><pre class="fragment"></pre></div></p>
<p>Our next function, copy, is a bit more interesting, but not much, it just casts our void pointers to struct timezone pointers and does the copy: <div class="fragment"><pre class="fragment"></pre></div> </p>
<dl class="note"><dt><b>Note:</b></dt><dd>By now you might be wondering why our functions receive void pointers instead of pointers to struct timezone, and this is a good point. The reason for this is that eina value doesn't know anything about our type so it must use a generic void pointer, casting that pointer into a proper value is the job of the implementor of the new type.</dd></dl>
<p>Next we have the comparison function, which compares the <code>tz_minuteswest</code> field of struct timezone, we don't compare <code>tz_dsttime</code> because that field is not used in linux: <div class="fragment"><pre class="fragment"></pre></div></p>
<p>Next we have setting, this however requires not one but rather two functions, the reason for this is because to be able to receive arguments of any type eina value uses <a href="https://wikipedia.org/wiki/Variadic_functions">variadic functions</a>, so we need a function to get the argument from a va_list and another to actually to the setting.</p>
<p>Lets first look at the pset function which sets the received value to a pointer: <div class="fragment"><pre class="fragment"></pre></div></p>
<p>Next we have the vset function which get the argument from the va_list and passes it to the pset function: <div class="fragment"><pre class="fragment"></pre></div></p>
<p>And now the function to get the value, a very simple copying of the value to the given pointer: <div class="fragment"><pre class="fragment"></pre></div></p>
<p>And finally our conversion function, this is our longest and most interesting one. For numeric type we simply assign the value of <code>tz_minuteswest</code> to the new type and call a set function using it: <div class="fragment"><pre class="fragment"></pre></div> </p>
<dl class="note"><dt><b>Note:</b></dt><dd>It would be a good idea to add checks for over and underflow for these types and return <a class="el" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a> in thoses cases, we omit this here for brevity.</dd></dl>
<p>For string types we use <code>snprintf()</code> to format our <code>tz_minuteswest</code> field and put it in a string(again <code>tz_dsttime</code> is ignored because it's not used): <div class="fragment"><pre class="fragment"></pre></div></p>
<p>Finally we handle any other types by returning an error in that case: <div class="fragment"><pre class="fragment"></pre></div></p>
<p>Now that we have all the functions, we can populate an <code>Eina_Value_Type</code> to later use it with <code>eina_value_setup()</code>: <div class="fragment"><pre class="fragment"></pre></div></p>
<p>We can now finally use our new TZ_TYPE with eina value, so lets conclude our example by practicing that by setting its value and printing it: <div class="fragment"><pre class="fragment"></pre></div></p>
<p>For the full source code see <a class="el" href="eina_value_03_c.html">eina_value_03.c</a>. </p>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
