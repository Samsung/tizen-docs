<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: complex-types-server.c</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">complex-types-server.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Server to test complex types (arrays, structs, dicts).</p>
<div class="fragment"><pre class="fragment"><span class="comment">//Compile with:</span>
<span class="comment">// gcc -o complex-types-server complex-types-server.c `pkg-config --cflags --libs eldbus ecore`</span>

<span class="preprocessor">#include &quot;Eldbus.h&quot;</span>
<span class="preprocessor">#include &lt;Ecore.h&gt;</span>

<span class="preprocessor">#define BUS &quot;com.profusion&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#define PATH &quot;/com/profusion/Test&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#define IFACE &quot;com.profusion.Test&quot;</span>
<span class="preprocessor"></span>
<span class="keyword">static</span> <span class="keywordtype">char</span> *resp2;
<span class="comment">/* dummy, incremented each time DBus.Properties.Get() is called */</span>
<span class="keyword">static</span> <span class="keywordtype">int</span> int32 = 35;
<span class="keyword">static</span> <a class="code" href="group__Ecore__Timer__Group.html#gaf96ffb609956658ec038e54bd39f46f0">Ecore_Timer</a> *timer;

<span class="keyword">static</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *
_receive_array(<span class="keyword">const</span> Eldbus_Service_Interface *iface <a name="a0"></a><a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *msg)
{
   <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *reply = <a name="a1"></a><a class="code" href="group__Eldbus__Message.html#ga0784dd7e8bed0d5a807fe6af74653c99" title="Create a message that is a reply to a method call.">eldbus_message_method_return_new</a>(msg);
   <a class="code" href="group__Eldbus__Core.html#ga08a70c6651064414e56d75fba2232925">Eldbus_Message_Iter</a> *array;
   <span class="keyword">const</span> <span class="keywordtype">char</span> *txt;

   printf(<span class="stringliteral">&quot;- receiveArray\n&quot;</span>);
   <span class="keywordflow">if</span> (!<a name="a2"></a><a class="code" href="group__Eldbus__Message.html#ga7aec6beec8e8a73982c7f43bd1322df8" title="Get the arguments from an Eldbus_Message.">eldbus_message_arguments_get</a>(msg, <span class="stringliteral">&quot;as&quot;</span>, &amp;array))
     {
        printf(<span class="stringliteral">&quot;Error on eldbus_message_arguments_get()\n&quot;</span>);
        <span class="keywordflow">return</span> reply;
     }

   <span class="keywordflow">while</span> (<a name="a3"></a><a class="code" href="group__Eldbus__Message__Iter.html#ga45c7d707ee830ae5be39c17df05af615" title="Get a complete type from Eldbus_Message_Iter if is not at the end of iterator and move to next field...">eldbus_message_iter_get_and_next</a>(array, <span class="charliteral">&#39;s&#39;</span>, &amp;txt))
     printf(<span class="stringliteral">&quot;%s\n&quot;</span>, txt);
   printf(<span class="stringliteral">&quot;}\n\n&quot;</span>);

   <span class="keywordflow">return</span> reply;
}

<span class="keyword">static</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *
_receive_array_of_string_int_with_size(<span class="keyword">const</span> Eldbus_Service_Interface *iface <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *msg)
{
   <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *reply = <a class="code" href="group__Eldbus__Message.html#ga0784dd7e8bed0d5a807fe6af74653c99" title="Create a message that is a reply to a method call.">eldbus_message_method_return_new</a>(msg);
   <a class="code" href="group__Eldbus__Core.html#ga08a70c6651064414e56d75fba2232925">Eldbus_Message_Iter</a> *array, *struct_si;
   <span class="keywordtype">int</span> size, i = 0;

   printf(<span class="stringliteral">&quot;- receiveArrayOfStringIntWithSize\n{\n&quot;</span>);
   <span class="keywordflow">if</span> (!<a class="code" href="group__Eldbus__Message.html#ga7aec6beec8e8a73982c7f43bd1322df8" title="Get the arguments from an Eldbus_Message.">eldbus_message_arguments_get</a>(msg, <span class="stringliteral">&quot;ia(si)&quot;</span>, &amp;size, &amp;array))
     {
        printf(<span class="stringliteral">&quot;Error on eldbus_message_arguments_get()\n&quot;</span>);
        <span class="keywordflow">return</span> reply;
     }

   <span class="keywordflow">while</span> (<a class="code" href="group__Eldbus__Message__Iter.html#ga45c7d707ee830ae5be39c17df05af615" title="Get a complete type from Eldbus_Message_Iter if is not at the end of iterator and move to next field...">eldbus_message_iter_get_and_next</a>(array, <span class="charliteral">&#39;r&#39;</span>, &amp;struct_si))
     {
        <span class="keyword">const</span> <span class="keywordtype">char</span> *txt;
        <span class="keywordtype">int</span> num;
        <span class="keywordflow">if</span> (!<a name="a4"></a><a class="code" href="group__Eldbus__Message__Iter.html#gae44918ce0b571a30546219d1d5040da0" title="Get data from Eldbus_Message_Iter, for each complete type must have a pointer to store his value...">eldbus_message_iter_arguments_get</a>(struct_si, <span class="stringliteral">&quot;si&quot;</span>, &amp;txt, &amp;num))
          {
             printf(<span class="stringliteral">&quot;Error on eldbus_message_arguments_get()\n&quot;</span>);
             <span class="keywordflow">return</span> reply;
          }
        printf(<span class="stringliteral">&quot;%s | %d\n&quot;</span>, txt, num);
        i++;
     }
   printf(<span class="stringliteral">&quot;size in msg %d | size read %d\n&quot;</span>, size, i);
   printf(<span class="stringliteral">&quot;}\n\n&quot;</span>);

   <span class="keywordflow">return</span> reply;
}

<span class="keyword">static</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *
_receive_variant(<span class="keyword">const</span> Eldbus_Service_Interface *iface EINA_UNUSED, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *msg)
{
   <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *reply = <a class="code" href="group__Eldbus__Message.html#ga0784dd7e8bed0d5a807fe6af74653c99" title="Create a message that is a reply to a method call.">eldbus_message_method_return_new</a>(msg);
   <a class="code" href="group__Eldbus__Core.html#ga08a70c6651064414e56d75fba2232925">Eldbus_Message_Iter</a> *var, *array, *main_iter;

   main_iter = <a name="a5"></a><a class="code" href="group__Eldbus__Message__Iter.html#ga7ca2412ef3cf3c8f77e3782413820814" title="Get the main Eldbus_Message_Iter from the Eldbus_Message.">eldbus_message_iter_get</a>(reply);
   var = <a name="a6"></a><a class="code" href="group__Eldbus__Message__Iter.html#gac053452551e924020d2105d87e73521e" title="Create and append a typed iterator to another iterator.">eldbus_message_iter_container_new</a>(main_iter, <span class="charliteral">&#39;v&#39;</span>, <span class="stringliteral">&quot;as&quot;</span>);
   <a name="a7"></a><a class="code" href="group__Eldbus__Message__Iter.html#gae00cddea6435838b7189bcf5ca816332" title="Append an argument into an Eldbus_Message_Iter. For each complete type you need to provide the corres...">eldbus_message_iter_arguments_append</a>(var, <span class="stringliteral">&quot;as&quot;</span>, &amp;array);

   <a class="code" href="group__Eldbus__Message__Iter.html#gae00cddea6435838b7189bcf5ca816332" title="Append an argument into an Eldbus_Message_Iter. For each complete type you need to provide the corres...">eldbus_message_iter_arguments_append</a>(array, <span class="stringliteral">&quot;s&quot;</span>, <span class="stringliteral">&quot;item1&quot;</span>);
   <a class="code" href="group__Eldbus__Message__Iter.html#gae00cddea6435838b7189bcf5ca816332" title="Append an argument into an Eldbus_Message_Iter. For each complete type you need to provide the corres...">eldbus_message_iter_arguments_append</a>(array, <span class="stringliteral">&quot;s&quot;</span>, <span class="stringliteral">&quot;item2&quot;</span>);
   <a class="code" href="group__Eldbus__Message__Iter.html#gae00cddea6435838b7189bcf5ca816332" title="Append an argument into an Eldbus_Message_Iter. For each complete type you need to provide the corres...">eldbus_message_iter_arguments_append</a>(array, <span class="stringliteral">&quot;s&quot;</span>, <span class="stringliteral">&quot;item3&quot;</span>);

   <a name="a8"></a><a class="code" href="group__Eldbus__Message__Iter.html#ga01840f4c9fb71cbf1c8081cf4e84189c" title="Closes a container-typed value appended to the message.">eldbus_message_iter_container_close</a>(var, array);
   <a class="code" href="group__Eldbus__Message__Iter.html#ga01840f4c9fb71cbf1c8081cf4e84189c" title="Closes a container-typed value appended to the message.">eldbus_message_iter_container_close</a>(main_iter, var);

   <span class="keywordflow">return</span> reply;
}

<span class="keyword">static</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *
_send_variant(<span class="keyword">const</span> Eldbus_Service_Interface *iface EINA_UNUSED, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *msg)
{
   <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *reply = <a class="code" href="group__Eldbus__Message.html#ga0784dd7e8bed0d5a807fe6af74653c99" title="Create a message that is a reply to a method call.">eldbus_message_method_return_new</a>(msg);
   <a class="code" href="group__Eldbus__Core.html#ga08a70c6651064414e56d75fba2232925">Eldbus_Message_Iter</a> *variant;
   <span class="keywordtype">char</span> *type;

   printf(<span class="stringliteral">&quot;- sendVariantData\n{\n&quot;</span>);
   <span class="keywordflow">if</span> (!<a class="code" href="group__Eldbus__Message.html#ga7aec6beec8e8a73982c7f43bd1322df8" title="Get the arguments from an Eldbus_Message.">eldbus_message_arguments_get</a>(msg, <span class="stringliteral">&quot;v&quot;</span>, &amp;variant))
     {
        printf(<span class="stringliteral">&quot;Error on eldbus_message_arguments_get()\n&quot;</span>);
        <span class="keywordflow">return</span> reply;
     }

   type = <a name="a9"></a><a class="code" href="group__Eldbus__Message__Iter.html#gab0201e1d78d70477ba337d0aa2977802" title="Returns the current signature of a message iterator.">eldbus_message_iter_signature_get</a>(variant);
   <span class="keywordflow">if</span> (type[1])
     {
        printf(<span class="stringliteral">&quot;It is a complex type, not handle yet.\n&quot;</span>);
        free(type);
        <span class="keywordflow">return</span> reply;
     }

   <span class="keywordflow">switch</span> (type[0])
     {
      <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:
      <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:
        {
           <span class="keywordtype">char</span> *txt;
           <a class="code" href="group__Eldbus__Message__Iter.html#gae44918ce0b571a30546219d1d5040da0" title="Get data from Eldbus_Message_Iter, for each complete type must have a pointer to store his value...">eldbus_message_iter_arguments_get</a>(variant, type, &amp;txt);
           printf(<span class="stringliteral">&quot;type = %c value = %s\n&quot;</span>, type[0], txt);
           <span class="keywordflow">break</span>;
        }
      <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:
        {
           <span class="keywordtype">int</span> num;
           <a class="code" href="group__Eldbus__Message__Iter.html#gae44918ce0b571a30546219d1d5040da0" title="Get data from Eldbus_Message_Iter, for each complete type must have a pointer to store his value...">eldbus_message_iter_arguments_get</a>(variant, type, &amp;num);
           printf(<span class="stringliteral">&quot;type = %c value = %d\n&quot;</span>, type[0], num);
           <span class="keywordflow">break</span>;
        }
      <span class="keywordflow">default</span>:
        {
           printf(<span class="stringliteral">&quot;Unhandled type\n&quot;</span>);
        }
     }

   printf(<span class="stringliteral">&quot;}\n\n&quot;</span>);

   free(type);
   <span class="keywordflow">return</span> reply;
}

<span class="keyword">static</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *
_send_array_int(<span class="keyword">const</span> Eldbus_Service_Interface *iface EINA_UNUSED, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *msg)
{
   <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *reply = <a class="code" href="group__Eldbus__Message.html#ga0784dd7e8bed0d5a807fe6af74653c99" title="Create a message that is a reply to a method call.">eldbus_message_method_return_new</a>(msg);
   <a class="code" href="group__Eldbus__Core.html#ga08a70c6651064414e56d75fba2232925">Eldbus_Message_Iter</a> *iter, *array;
   <span class="keywordtype">int</span> numbers[] = { 10, 9, 8, 7, 6, 5 };

   printf(<span class="stringliteral">&quot;- sendArrayInt\n\n&quot;</span>);

   iter = <a class="code" href="group__Eldbus__Message__Iter.html#ga7ca2412ef3cf3c8f77e3782413820814" title="Get the main Eldbus_Message_Iter from the Eldbus_Message.">eldbus_message_iter_get</a>(reply);
   array = <a class="code" href="group__Eldbus__Message__Iter.html#gac053452551e924020d2105d87e73521e" title="Create and append a typed iterator to another iterator.">eldbus_message_iter_container_new</a>(iter, <span class="charliteral">&#39;a&#39;</span>, <span class="stringliteral">&quot;i&quot;</span>);
   <a name="a10"></a><a class="code" href="group__Eldbus__Message__Iter.html#ga5482d43616555df5c91e0004085fb97a">eldbus_message_iter_fixed_array_append</a>(array, <span class="charliteral">&#39;i&#39;</span>, numbers, <a name="a11"></a><a class="code" href="group__Eina__Types__Group.html#ga7c1b6f81660b4e30516169e9e7d3261c">EINA_C_ARRAY_LENGTH</a>(numbers));
   <a class="code" href="group__Eldbus__Message__Iter.html#ga01840f4c9fb71cbf1c8081cf4e84189c" title="Closes a container-typed value appended to the message.">eldbus_message_iter_container_close</a>(iter, array);

   <span class="keywordflow">return</span> reply;
}

<span class="keyword">static</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *
_send_array(<span class="keyword">const</span> Eldbus_Service_Interface *iface EINA_UNUSED, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *msg)
{
   <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *reply = <a class="code" href="group__Eldbus__Message.html#ga0784dd7e8bed0d5a807fe6af74653c99" title="Create a message that is a reply to a method call.">eldbus_message_method_return_new</a>(msg);
   <a class="code" href="group__Eldbus__Core.html#ga08a70c6651064414e56d75fba2232925">Eldbus_Message_Iter</a> *iter, *array;
   <span class="keyword">const</span> <span class="keywordtype">char</span> *array_string[5] = {<span class="stringliteral">&quot;qqqq&quot;</span>, <span class="stringliteral">&quot;wwwww&quot;</span>, <span class="stringliteral">&quot;eeeeee&quot;</span>, <span class="stringliteral">&quot;rrrrr&quot;</span>, <span class="stringliteral">&quot;ttttt&quot;</span>};
   <span class="keywordtype">int</span> i;

   printf(<span class="stringliteral">&quot;sendArray\n\n&quot;</span>);

   iter = <a class="code" href="group__Eldbus__Message__Iter.html#ga7ca2412ef3cf3c8f77e3782413820814" title="Get the main Eldbus_Message_Iter from the Eldbus_Message.">eldbus_message_iter_get</a>(reply);
   array = <a class="code" href="group__Eldbus__Message__Iter.html#gac053452551e924020d2105d87e73521e" title="Create and append a typed iterator to another iterator.">eldbus_message_iter_container_new</a>(iter, <span class="charliteral">&#39;a&#39;</span>, <span class="stringliteral">&quot;s&quot;</span>);
   <span class="keywordflow">for</span> (i = 0; i &lt; 5; i++)
     <a class="code" href="group__Eldbus__Message__Iter.html#gae00cddea6435838b7189bcf5ca816332" title="Append an argument into an Eldbus_Message_Iter. For each complete type you need to provide the corres...">eldbus_message_iter_arguments_append</a>(array, <span class="stringliteral">&quot;s&quot;</span>, array_string[i]);
   <a class="code" href="group__Eldbus__Message__Iter.html#ga01840f4c9fb71cbf1c8081cf4e84189c" title="Closes a container-typed value appended to the message.">eldbus_message_iter_container_close</a>(iter, array);

   <span class="keywordflow">return</span> reply;
}

<span class="keyword">static</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *
_plus_one(<span class="keyword">const</span> Eldbus_Service_Interface *iface EINA_UNUSED, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *msg)
{
   <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *reply = <a class="code" href="group__Eldbus__Message.html#ga0784dd7e8bed0d5a807fe6af74653c99" title="Create a message that is a reply to a method call.">eldbus_message_method_return_new</a>(msg);
   <span class="keywordtype">int</span> num;

   printf(<span class="stringliteral">&quot;- plusOne\n\n&quot;</span>);
   <span class="keywordflow">if</span> (!<a class="code" href="group__Eldbus__Message.html#ga7aec6beec8e8a73982c7f43bd1322df8" title="Get the arguments from an Eldbus_Message.">eldbus_message_arguments_get</a>(msg, <span class="stringliteral">&quot;i&quot;</span>, &amp;num))
     {
        printf(<span class="stringliteral">&quot;Error on eldbus_message_arguments_get()\n&quot;</span>);
        <span class="keywordflow">return</span> reply;
     }
   num++;
   <a name="a12"></a><a class="code" href="group__Eldbus__Message.html#ga933ee5158cb25619c9b272aa1765d069" title="Append arguments into an Eldbus_Message.">eldbus_message_arguments_append</a>(reply, <span class="stringliteral">&quot;i&quot;</span>, num);

   <span class="keywordflow">return</span> reply;
}

<span class="keyword">static</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *
_double_container(<span class="keyword">const</span> Eldbus_Service_Interface *iface EINA_UNUSED, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *msg)
{
   <a class="code" href="group__Eldbus__Core.html#ga08a70c6651064414e56d75fba2232925">Eldbus_Message_Iter</a> *array1, *array2, *structure;
   <span class="keywordtype">int</span> num1, num2;
   <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *reply = <a class="code" href="group__Eldbus__Message.html#ga0784dd7e8bed0d5a807fe6af74653c99" title="Create a message that is a reply to a method call.">eldbus_message_method_return_new</a>(msg);

   <span class="keywordflow">if</span> (!<a class="code" href="group__Eldbus__Message.html#ga7aec6beec8e8a73982c7f43bd1322df8" title="Get the arguments from an Eldbus_Message.">eldbus_message_arguments_get</a>(msg, <span class="stringliteral">&quot;a(ii)a(ii)&quot;</span>, &amp;array1, &amp;array2))
     {
        printf(<span class="stringliteral">&quot;Error on eldbus_message_arguments_get()\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
     }

   printf(<span class="stringliteral">&quot;DoubleCountainer\n{\nArray1:\n&quot;</span>);
   <span class="keywordflow">while</span> (<a class="code" href="group__Eldbus__Message__Iter.html#ga45c7d707ee830ae5be39c17df05af615" title="Get a complete type from Eldbus_Message_Iter if is not at the end of iterator and move to next field...">eldbus_message_iter_get_and_next</a>(array1, <span class="charliteral">&#39;r&#39;</span>, &amp;structure))
     {
        <a class="code" href="group__Eldbus__Message__Iter.html#gae44918ce0b571a30546219d1d5040da0" title="Get data from Eldbus_Message_Iter, for each complete type must have a pointer to store his value...">eldbus_message_iter_arguments_get</a>(structure, <span class="stringliteral">&quot;ii&quot;</span>, &amp;num1, &amp;num2);
        printf(<span class="stringliteral">&quot;1 %d - 2 %d\n&quot;</span>, num1, num2);
     }

   printf(<span class="stringliteral">&quot;Array2:\n&quot;</span>);
   <span class="keywordflow">while</span> (<a class="code" href="group__Eldbus__Message__Iter.html#ga45c7d707ee830ae5be39c17df05af615" title="Get a complete type from Eldbus_Message_Iter if is not at the end of iterator and move to next field...">eldbus_message_iter_get_and_next</a>(array2, <span class="charliteral">&#39;r&#39;</span>, &amp;structure))
     {
         <a class="code" href="group__Eldbus__Message__Iter.html#gae44918ce0b571a30546219d1d5040da0" title="Get data from Eldbus_Message_Iter, for each complete type must have a pointer to store his value...">eldbus_message_iter_arguments_get</a>(structure, <span class="stringliteral">&quot;ii&quot;</span>, &amp;num1, &amp;num2);
         printf(<span class="stringliteral">&quot;1 %d - 2 %d\n&quot;</span>, num1, num2);
     }
   printf(<span class="stringliteral">&quot;}\n\n&quot;</span>);
   <span class="keywordflow">return</span> reply;
}

<span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>
_properties_get(<span class="keyword">const</span> Eldbus_Service_Interface *iface EINA_UNUSED, <span class="keyword">const</span> <span class="keywordtype">char</span> *propname, <a class="code" href="group__Eldbus__Core.html#ga08a70c6651064414e56d75fba2232925">Eldbus_Message_Iter</a> *iter, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *request_msg EINA_UNUSED, <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> **error EINA_UNUSED)
{
   printf(<span class="stringliteral">&quot;Properties_get - %s\n&quot;</span>, propname);
   <span class="keywordflow">if</span> (!strcmp(propname, <span class="stringliteral">&quot;Resp2&quot;</span>))
     <a name="a13"></a><a class="code" href="group__Eldbus__Message__Iter.html#gaf3be6a0eb61416b21f21b65c57109b97" title="Append a basic type into an Eldbus_Iterator.">eldbus_message_iter_basic_append</a>(iter, <span class="charliteral">&#39;s&#39;</span>, resp2);
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(propname, <span class="stringliteral">&quot;text&quot;</span>))
     <a class="code" href="group__Eldbus__Message__Iter.html#gaf3be6a0eb61416b21f21b65c57109b97" title="Append a basic type into an Eldbus_Iterator.">eldbus_message_iter_basic_append</a>(iter, <span class="charliteral">&#39;s&#39;</span>, <span class="stringliteral">&quot;lalalala&quot;</span>);
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(propname, <span class="stringliteral">&quot;int32&quot;</span>))
     {
        <a class="code" href="group__Eldbus__Message__Iter.html#gae00cddea6435838b7189bcf5ca816332" title="Append an argument into an Eldbus_Message_Iter. For each complete type you need to provide the corres...">eldbus_message_iter_arguments_append</a>(iter, <span class="stringliteral">&quot;i&quot;</span>, int32);
        int32++;
     }
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(propname, <span class="stringliteral">&quot;st&quot;</span>))
     {
        <a class="code" href="group__Eldbus__Core.html#ga08a70c6651064414e56d75fba2232925">Eldbus_Message_Iter</a> *st;
        <a class="code" href="group__Eldbus__Message__Iter.html#gae00cddea6435838b7189bcf5ca816332" title="Append an argument into an Eldbus_Message_Iter. For each complete type you need to provide the corres...">eldbus_message_iter_arguments_append</a>(iter, <span class="stringliteral">&quot;(ss)&quot;</span>, &amp;st);
        <a class="code" href="group__Eldbus__Message__Iter.html#gae00cddea6435838b7189bcf5ca816332" title="Append an argument into an Eldbus_Message_Iter. For each complete type you need to provide the corres...">eldbus_message_iter_arguments_append</a>(st, <span class="stringliteral">&quot;ss&quot;</span>, <span class="stringliteral">&quot;string1&quot;</span>, <span class="stringliteral">&quot;string2&quot;</span>);
        <a class="code" href="group__Eldbus__Message__Iter.html#ga01840f4c9fb71cbf1c8081cf4e84189c" title="Closes a container-typed value appended to the message.">eldbus_message_iter_container_close</a>(iter, st);
     }
   <span class="keywordflow">return</span> <a name="a14"></a><a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;
}

<span class="keyword">static</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *
_properties_set(<span class="keyword">const</span> Eldbus_Service_Interface *iface EINA_UNUSED, <span class="keyword">const</span> <span class="keywordtype">char</span> *propname, <a class="code" href="group__Eldbus__Core.html#ga08a70c6651064414e56d75fba2232925">Eldbus_Message_Iter</a> *iter, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *msg)
{
   <span class="keywordtype">char</span> *type;

   type = <a class="code" href="group__Eldbus__Message__Iter.html#gab0201e1d78d70477ba337d0aa2977802" title="Returns the current signature of a message iterator.">eldbus_message_iter_signature_get</a>(iter);

   <span class="keywordflow">if</span> (!strcmp(propname, <span class="stringliteral">&quot;int32&quot;</span>))
     {
        <span class="keywordtype">int</span> num;
        <span class="keywordflow">if</span> (type[0] != <span class="charliteral">&#39;i&#39;</span>)
          <span class="keywordflow">goto</span> invalid_signature;
        <a class="code" href="group__Eldbus__Message__Iter.html#gae44918ce0b571a30546219d1d5040da0" title="Get data from Eldbus_Message_Iter, for each complete type must have a pointer to store his value...">eldbus_message_iter_arguments_get</a>(iter, <span class="stringliteral">&quot;i&quot;</span>, &amp;num);
        printf(<span class="stringliteral">&quot;int32 was set to: %d, previously was: %d\n&quot;</span>, num, int32);
        int32 = num;
     }
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(propname, <span class="stringliteral">&quot;Resp2&quot;</span>))
     {
        <span class="keyword">const</span> <span class="keywordtype">char</span> *txt;
        <span class="keywordflow">if</span> (type[0] != <span class="charliteral">&#39;s&#39;</span>)
          <span class="keywordflow">goto</span> invalid_signature;
        <a class="code" href="group__Eldbus__Message__Iter.html#gae44918ce0b571a30546219d1d5040da0" title="Get data from Eldbus_Message_Iter, for each complete type must have a pointer to store his value...">eldbus_message_iter_arguments_get</a>(iter, <span class="stringliteral">&quot;s&quot;</span>, &amp;txt);
        printf(<span class="stringliteral">&quot;Resp2 was set to: %s, previously was: %s\n&quot;</span>, txt, resp2);
        free(resp2);
        resp2 = strdup(txt);
     }
   free(type);
   <span class="keywordflow">return</span> <a class="code" href="group__Eldbus__Message.html#ga0784dd7e8bed0d5a807fe6af74653c99" title="Create a message that is a reply to a method call.">eldbus_message_method_return_new</a>(msg);

invalid_signature:
   free(type);
   <span class="keywordflow">return</span> <a name="a15"></a><a class="code" href="group__Eldbus__Message.html#ga53bd5261d6b82b494b8b8b31e62fb469" title="Create a new message that is an error reply to another message.">eldbus_message_error_new</a>(msg, <span class="stringliteral">&quot;org.freedesktop.DBus.Error.InvalidSignature&quot;</span>,
                                  <span class="stringliteral">&quot;Invalid type.&quot;</span>);
}

<span class="keyword">static</span> <span class="keyword">const</span> Eldbus_Method methods[] = {
      {
        <span class="stringliteral">&quot;ReceiveArray&quot;</span>, <a name="a16"></a><a class="code" href="group__Eldbus__Service.html#gab77338df786b5ad2a9f86693432f23a4" title="Used to insert complete types to signature of methods or signals.">ELDBUS_ARGS</a>({<span class="stringliteral">&quot;as&quot;</span>, <span class="stringliteral">&quot;array_of_strings&quot;</span>}),
        NULL, _receive_array, 0
      },
      {
        <span class="stringliteral">&quot;ReceiveArrayOfStringIntWithSize&quot;</span>,
        <a class="code" href="group__Eldbus__Service.html#gab77338df786b5ad2a9f86693432f23a4" title="Used to insert complete types to signature of methods or signals.">ELDBUS_ARGS</a>({<span class="stringliteral">&quot;i&quot;</span>, <span class="stringliteral">&quot;size_of_array&quot;</span>}, {<span class="stringliteral">&quot;a(si)&quot;</span>, <span class="stringliteral">&quot;array&quot;</span>}),
        NULL, _receive_array_of_string_int_with_size, 0
      },
      {
        <span class="stringliteral">&quot;SendVariantData&quot;</span>, <a class="code" href="group__Eldbus__Service.html#gab77338df786b5ad2a9f86693432f23a4" title="Used to insert complete types to signature of methods or signals.">ELDBUS_ARGS</a>({<span class="stringliteral">&quot;v&quot;</span>, <span class="stringliteral">&quot;variant_data&quot;</span>}),
        NULL, _send_variant, 0
      },
      {
       <span class="stringliteral">&quot;ReceiveVariantData&quot;</span>, NULL, <a class="code" href="group__Eldbus__Service.html#gab77338df786b5ad2a9f86693432f23a4" title="Used to insert complete types to signature of methods or signals.">ELDBUS_ARGS</a>({<span class="stringliteral">&quot;v&quot;</span>, <span class="stringliteral">&quot;variant_data&quot;</span>}),
       _receive_variant, 0
      },
      {
        <span class="stringliteral">&quot;SendArrayInt&quot;</span>, NULL,
        <a class="code" href="group__Eldbus__Service.html#gab77338df786b5ad2a9f86693432f23a4" title="Used to insert complete types to signature of methods or signals.">ELDBUS_ARGS</a>({<span class="stringliteral">&quot;ai&quot;</span>, <span class="stringliteral">&quot;array_of_int&quot;</span>}), _send_array_int, 0
      },
      {
        <span class="stringliteral">&quot;SendArray&quot;</span>, NULL, <a class="code" href="group__Eldbus__Service.html#gab77338df786b5ad2a9f86693432f23a4" title="Used to insert complete types to signature of methods or signals.">ELDBUS_ARGS</a>({<span class="stringliteral">&quot;as&quot;</span>, <span class="stringliteral">&quot;array_string&quot;</span>}),
        _send_array, 0
      },
      {
        <span class="stringliteral">&quot;PlusOne&quot;</span>, <a class="code" href="group__Eldbus__Service.html#gab77338df786b5ad2a9f86693432f23a4" title="Used to insert complete types to signature of methods or signals.">ELDBUS_ARGS</a>({<span class="stringliteral">&quot;i&quot;</span>, <span class="stringliteral">&quot;integer&quot;</span>}),
        <a class="code" href="group__Eldbus__Service.html#gab77338df786b5ad2a9f86693432f23a4" title="Used to insert complete types to signature of methods or signals.">ELDBUS_ARGS</a>({<span class="stringliteral">&quot;i&quot;</span>, <span class="stringliteral">&quot;integer_plus_one&quot;</span>}), _plus_one, 0
      },
      {
        <span class="stringliteral">&quot;DoubleContainner&quot;</span>, <a class="code" href="group__Eldbus__Service.html#gab77338df786b5ad2a9f86693432f23a4" title="Used to insert complete types to signature of methods or signals.">ELDBUS_ARGS</a>({<span class="stringliteral">&quot;a(ii)&quot;</span>, <span class="stringliteral">&quot;array1&quot;</span>}, {<span class="stringliteral">&quot;a(ii)&quot;</span>, <span class="stringliteral">&quot;array2&quot;</span>}),
        NULL, _double_container, 0
      },
      { }
};

<span class="keyword">static</span> <span class="keyword">const</span> Eldbus_Property properties[] = {
      { <span class="stringliteral">&quot;Resp2&quot;</span>, <span class="stringliteral">&quot;s&quot;</span>, NULL, _properties_set, 0 },
      { <span class="stringliteral">&quot;text&quot;</span>, <span class="stringliteral">&quot;s&quot;</span>, NULL, NULL, 0 },
      { <span class="stringliteral">&quot;int32&quot;</span>, <span class="stringliteral">&quot;i&quot;</span>, NULL, _properties_set, 0 },
      { <span class="stringliteral">&quot;st&quot;</span>, <span class="stringliteral">&quot;(ss)&quot;</span>, NULL, NULL, 0 },
      { }
};

<span class="keyword">static</span> <span class="keyword">const</span> Eldbus_Service_Interface_Desc iface_desc = {
   IFACE, methods, NULL, properties, _properties_get, NULL
};

<span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a> _emit_changed(<span class="keywordtype">void</span> *data)
{
   Eldbus_Service_Interface *iface = data;
   <a name="a17"></a><a class="code" href="group__Eldbus__Service.html#ga51cfeabdb75e0f0413bb398f12769f67" title="Add property to list of changed properties A DBus.PropertiesChanged signal will be sent in an idler w...">eldbus_service_property_changed</a>(iface, <span class="stringliteral">&quot;int32&quot;</span>);
   eldbus_service_property_invalidate_set(iface, <span class="stringliteral">&quot;Resp2&quot;</span>, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);
   <span class="keywordflow">return</span> <a name="a18"></a><a class="code" href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a>;
}

<span class="keyword">static</span> <span class="keywordtype">void</span>
on_name_request(<span class="keywordtype">void</span> *data, <span class="keyword">const</span> <a class="code" href="group__Eldbus__Core.html#ga14e8c4d4b96af5fb8bb5c66dc315593a">Eldbus_Message</a> *msg, <a class="code" href="group__Eldbus__Core.html#ga7a5d4dc070bd925034de6e52c4260be7">Eldbus_Pending</a> *pending EINA_UNUSED)
{
   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> reply;
   Eldbus_Service_Interface *iface = data;

   <span class="keywordflow">if</span> (<a name="a19"></a><a class="code" href="group__Eldbus__Message.html#ga3aeec7d275bef2bb244ed9a045540921" title="Get the error text and name from a Eldbus_Message.">eldbus_message_error_get</a>(msg, NULL, NULL))
     {
        printf(<span class="stringliteral">&quot;error on on_name_request\n&quot;</span>);
        <span class="keywordflow">return</span>;
     }

   <span class="keywordflow">if</span> (!<a class="code" href="group__Eldbus__Message.html#ga7aec6beec8e8a73982c7f43bd1322df8" title="Get the arguments from an Eldbus_Message.">eldbus_message_arguments_get</a>(msg, <span class="stringliteral">&quot;u&quot;</span>, &amp;reply))
     {
        printf(<span class="stringliteral">&quot;error geting arguments on on_name_request\n&quot;</span>);
        <span class="keywordflow">return</span>;
     }

   <span class="keywordflow">if</span> (reply != <a name="a20"></a><a class="code" href="group__Eldbus__Basic.html#gacf5e700a1223c56f319d6f341e8d5624">ELDBUS_NAME_REQUEST_REPLY_PRIMARY_OWNER</a>)
     {
        printf(<span class="stringliteral">&quot;error name already in use\n&quot;</span>);
        <span class="keywordflow">return</span>;
     }

   timer = <a name="a21"></a><a class="code" href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add</a>(3, _emit_changed, iface);
}

<span class="keywordtype">int</span>
main(<span class="keywordtype">void</span>)
{
   <a class="code" href="group__Eldbus__Core.html#ga5f0557a7e65ed263fcc1678874b8f7e7">Eldbus_Connection</a> *conn;
   Eldbus_Service_Interface *iface;

   <a name="a22"></a><a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();
   <a name="a23"></a><a class="code" href="group__Eldbus__Core.html#ga695dacda6632542dea454e39659ab54f" title="Initialize eldbus.">eldbus_init</a>();

   conn = <a name="a24"></a><a class="code" href="group__Eldbus__Conneciton.html#ga203ec794fc0c7e1bddce4eb18b628c04">eldbus_connection_get</a>(ELDBUS_CONNECTION_TYPE_SESSION);

   resp2 = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * 5);
   strcpy(resp2, <span class="stringliteral">&quot;test&quot;</span>);
   iface = <a name="a25"></a><a class="code" href="group__Eldbus__Service.html#ga5e48c24176e0d4e845eaa24be5a89c5b" title="Register an interface in the given path and connection.">eldbus_service_interface_register</a>(conn, PATH, &amp;iface_desc);
   <a name="a26"></a><a class="code" href="group__Eldbus__Basic.html#gaa2bade82fbf17312ab03440525630ac4">eldbus_name_request</a>(conn, BUS, <a name="a27"></a><a class="code" href="group__Eldbus__Basic.html#ga31878c736bc89a712bbcd27699c5b519">ELDBUS_NAME_REQUEST_FLAG_DO_NOT_QUEUE</a>,
                      on_name_request, iface);

   <a name="a28"></a><a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();

   free(resp2);
   <a name="a29"></a><a class="code" href="group__Ecore__Timer__Group.html#gaba2b599c7aabe3ab664dc3d47f62a33a">ecore_timer_del</a>(timer);
   <a name="a30"></a><a class="code" href="group__Eldbus__Service.html#ga16f7215afc4c9432c2bf639e437f193c" title="Unregister a interface. Note: This doesn&#39;t unregister the object path if interface count reaches 0...">eldbus_service_interface_unregister</a>(iface);
   <a name="a31"></a><a class="code" href="group__Eldbus__Conneciton.html#ga1c035aac8b601b416bba11d0d68f80ae" title="Decrement connection reference count.">eldbus_connection_unref</a>(conn);

   <a name="a32"></a><a class="code" href="group__Eldbus__Core.html#ga1162c16632b1d81e6dba6620397dcda9" title="Shutdown eldbus.">eldbus_shutdown</a>();
   <a name="a33"></a><a class="code" href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a>();
   <span class="keywordflow">return</span> 0;
}
</pre></div> </div><!-- contents -->
</div><!-- contents -->
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
