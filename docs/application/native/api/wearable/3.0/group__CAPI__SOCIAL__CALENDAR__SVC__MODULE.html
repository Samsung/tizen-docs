<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: Calendar</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Tizen Native API"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   &#160;<span id="projectnumber">3.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('group__CAPI__SOCIAL__CALENDAR__SVC__MODULE.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Calendar</div>  </div>
<div class="ingroups"><a class="el" href="group__CAPI__SOCIAL__FRAMEWORK.html">Social</a></div></div><!--header-->
<div class="contents">
<hr/><a name="details" id="details"></a><h2> </h2>
<p>The Calendar Service API provides functions for managing calendars(including events, to-dos). This API allows you not only to store information about calendar but also to query calendar information. </p>
<h2><a class="anchor" id="CAPI_SOCIAL_CALENDARS_SVC_MODULE_HEADER"></a>
Required Header</h2>
<p>#include &lt;calendar.h&gt;</p>
<h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_OVERVIEW"></a>
Overview</h2>
<p>A calendar is a system of organizing days for social purposes and is composed of records like events and to-dos. These records are made up of another sub records like alarms, attendees or extended ones. Events could have recurrence rule, instances would be generated.</p>
<div class="image">
<img src="calendar_model.png" alt="calendar_model.png"/>
<div class="caption">
Figure: Calendar model</div></div>
<p> The Calendar-Service provides an interface to manage the information of records. </p>
<table class="doxtable">
<caption align="bottom">Table: Calendar service properties. </caption>
<tr>
<td>* Managing information stored in database. <br/>
 * Aggregating information from various accounts. <br/>
 * Notifying changes of information. <br/>
 * Searching information. <br/>
 * Vcalendar supports ver1.0(vcs) / 2.0(ics).   </td></tr>
</table>
<p>Calendar service module works in a way similar to client-service architecture. In this architecture Tizen application is a client side and has to connect to service before using calendar service APIs. Connection/disconnection MUST be done with use of <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__COMMON__MODULE.html#gad4b7ac08994a0e0d1d937bf0fd907bc1" title="Connects to the calendar service.">calendar_connect()</a> / <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__COMMON__MODULE.html#ga7fe23faebdf5648317efb97197562efd" title="Disconnects from the calendar service.">calendar_disconnect()</a>.</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__COMMON__MODULE.html#gad4b7ac08994a0e0d1d937bf0fd907bc1" title="Connects to the calendar service.">calendar_connect</a>();

 <span class="comment">// jobs for records</span>

 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__COMMON__MODULE.html#ga7fe23faebdf5648317efb97197562efd" title="Disconnects from the calendar service.">calendar_disconnect</a>(); *
</pre></div><h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Entities"></a>
Entities</h2>
<p>Calendar service manages information related to following entities.</p>
<ul>
<li>Calendar books<ul>
<li>Represents where event and to-do should belong to.</li>
<li>Created by one of calendars sources below<ol type="i">
<li>Local device, which has no account.</li>
<li>Service providers such as Google or Yahoo, with account.</li>
<li>Applications like ChatON, Joyn, Facebook, etc.</li>
</ol>
</li>
<li>Have properties like name, account id, color.</li>
</ul>
</li>
<li>Events<ul>
<li>Have properties like summary, start_time, description.</li>
<li>Single entry can be available on each calendar book.</li>
</ul>
</li>
<li>To-dos<ul>
<li>Similar with event entry.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Entities_Relationship_between_entities"></a>
Relationship between entities</h3>
<div class="image">
<img src="entities.png" alt="entities.png"/>
<div class="caption">
Figure: Relationship between entities</div></div>
 <h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Entities_Multiple_Address_books_from_Accounts"></a>
Multiple Address books from Accounts</h3>
<p>Each account can create multiple calendar books. Calendar book name does not need to be unique on the device because it is handled with id. Local device address book has no account and its related account id is zero.</p>
<h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Views"></a>
Views</h2>
<p><a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__VIEW__MODULE.html">View/Property</a> To access and handle entities, views are provided. <br/>
 According to data-view declarations, generic access functions are used (<a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga2d05d97a550df7d70e022b1e293dfee0" title="Inserts a record into the calendar database.">calendar_db_insert_record()</a>, <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gab52360e3274ceea8c85e38ce6a00a42a" title="Gets an integer value from a record.">calendar_record_get_int()</a>, …). <br/>
 Data-View is almost same as database "VIEW" which limits access and guarantees the performance by offering various views for the proper purpose. _calendar_instance_utime, _calendar_instance_localtime views are not offered but combination with another view are provided. </p>
<table class="doxtable">
<caption align="bottom">Table: Calendar views </caption>
<tr>
<th>Editable view  </th><th>Read only view   </th></tr>
<tr>
<td>_calendar_book <br/>
 _calendar_event <br/>
 _calendar_todo <br/>
 _calendar_timezone <br/>
 _calendar_attendee <br/>
 _calendar_alarm <br/>
 _calendar_extended_property  </td><td><p class="starttd">_calendar_updated_info <br/>
 _calendar_event_calendar_book <br/>
 _calendar_todo_calendar_book <br/>
 _calendar_event_calendar_book_attendee <br/>
 _calendar_instance_utime_calendar_book <br/>
 _calendar_instance_localtime_calendar_book <br/>
 _calendar_instance_utime_calendar_book_extended <br/>
 _calendar_instance_localtime_calendar_book_extended</p>
<p class="endtd"></p>
</td></tr>
</table>
<p>_calendar_updated_info is used when identifying record changes depending on version. The other read only views are combination of editable views for UI convenience. <br/>
 _calendar_event + _calendar_book = _calendar_event_calendar_book <br/>
 _calendar_instance_utime + _calendar_book = _calendar_instance_utime_calendar_book <br/>
 _calendar_event + _calendar_book + _calendar_attendee = _calendar_event_calendar_book_attendee <br/>
</p>
<h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Views_Properties"></a>
Properties</h3>
<p>Record types which have *_id as their properties, hold identifiers of other records - e.g. attendee and alarm views hold id of their corresponding events or to-dos in event_id or todo_id property respectively (as children of the corresponding events or to-dos record). Properties of type 'record' are other records. For example, a event record has 'attendee' and 'alarm', which means that records of those types can be children of event type records. In calendar_view.h header file, view macros are found and below figure shows what macro means.</p>
<div class="image">
<img src="view_property.png" alt="view_property.png"/>
<div class="caption">
Figure: Properties</div></div>
<p> There is an example how to create event with view.</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// create an event with _calendar_event view.</span>
 calendar_record_h <span class="keyword">event</span> = NULL;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga1fae9705425d18c3e1b3b56b8f0a26c3" title="Creates a record handle.">calendar_record_create</a>(_calendar_event._uri, &amp;event);

 <span class="comment">// set event summary to _calendar_event view.</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gafd27e03cc8088be90ce37888d16d9712" title="Sets a string to a record.">calendar_record_set_str</a>(event, _calendar_event.summary, <span class="stringliteral">&quot;Meeting&quot;</span>);
</pre></div><h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Views_Version"></a>
Version</h3>
<p>Calendar service uses version system in below APIs. </p>
<table class="doxtable">
<caption align="bottom">Table: Version related APIs </caption>
<tr>
<td><a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga579850165253736055158750bae8bbba" title="Gets the current calendar database version.">calendar_db_get_current_version(int* calendar_db_version)</a> <br/>
 <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#gac60510d7c18f3a6e241f0189ceea4ff7" title="Retrieves records with the given calendar database version.">calendar_db_get_changes_by_version(const char *view_uri, int calendar_book_id, int calendar_db_version, calendar_list_h *record_list, int *current_calendar_db_version)</a> <br/>
 <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga9afa5689dca0107f1d1ccbbeffbfd4f4" title="Gets the last successful change version of the database on the current connection.">calendar_db_get_last_change_version(int* last_change_version)</a> <br/>
 <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga4383557750918c177bfed6bd8c3cbb6f" title="Retrieves changed exception records since the given calendar database version. Exceptions are the mod...">calendar_db_get_changes_exception_by_version(const char *view_uri, int original_event_id, int calendar_db_version, calendar_list_h *list)</a>   </td></tr>
</table>
<p>Whenever modifications are in DB, version number is increased every time. <br/>
 If sync applications like Google, Facebook sync at version 13 and they try to sync again every 1 minute, they want to get changes from version 14 to current version. <br/>
 To get current version, <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga579850165253736055158750bae8bbba" title="Gets the current calendar database version.">calendar_db_get_current_version()</a> is used and <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#gac60510d7c18f3a6e241f0189ceea4ff7" title="Retrieves records with the given calendar database version.">calendar_db_get_changes_by_version()</a> is used to get the modified record list. <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga4383557750918c177bfed6bd8c3cbb6f" title="Retrieves changed exception records since the given calendar database version. Exceptions are the mod...">calendar_db_get_changes_exception_by_version()</a> is used to get modified instances in recurring event. (see exception in Events and instances)</p>
<h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Records"></a>
Records</h2>
<p>An important concept in Calendar service APIs is a record. It may be helpful to know that a record represents an actual record in the internal database, but in general, you can think of a record as a structure describing a single (but complex) view, like a calendar event or a time zone. A record has many properties, for example, a to-do record has the to-do's description, priority, progress, created, last modified and completed time, plus many others. <br/>
 A record can also contain an identifier field, which holds an identifier of another record. Setting this field's value establishes a relation between the records, for example, a calendar event contains the identifier of a calendar book to which it belongs.</p>
<h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Records_URI"></a>
URI</h3>
<p>A record's type is identified by a structure called the view. For example, the _calendar_event view describes the properties of the calendar event record. Every view has a special field - _uri - that uniquely identifies the view. In many cases you will need to provide the _uri value to indicate what type of record you wish to create or operate on.</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// create an event and get handle</span>
 calendar_record_h <span class="keyword">event</span> = NULL;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga1fae9705425d18c3e1b3b56b8f0a26c3" title="Creates a record handle.">calendar_record_create</a>(_calendar_event._uri, &amp;event);
</pre></div><h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Records_Record_handle"></a>
Record handle</h3>
<p>To use a record, you must obtain its handle. There are many ways to obtain it, including creating a new record and referring to child records of a record.</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// create an event and get handle</span>
 calendar_record_h <span class="keyword">event</span> = NULL;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga1fae9705425d18c3e1b3b56b8f0a26c3" title="Creates a record handle.">calendar_record_create</a>(_calendar_event._uri, &amp;event);

 <span class="comment">// get record handle with id</span>
 calendar_record_h event2 = NULL
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga8e868464302c1b35de9f0e4cde2fb35c" title="Gets a record from the calendar database.">calendar_db_get_record</a>(_calendar_event._uri, event_id, &amp;event2);
</pre></div><h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Records_Basic_types"></a>
Basic types</h3>
<p>Records contain properties of basic types: integer, lli (long integer, long long int), double, string and <a class="el" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a>.<br/>
 The <a class="el" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a> type holds either a long long int, or three integers (year, month, day). There are setter and getter functions for each type: </p>
<table class="doxtable">
<caption align="bottom">Table: Setter and getter functions </caption>
<tr>
<th>Property  </th><th>Setter  </th><th>Getter   </th></tr>
<tr>
<td>integer  </td><td>calendar_record_set_int  </td><td>calendar_record_get_int   </td></tr>
<tr>
<td>long long integer  </td><td>calendar_record_set_lli  </td><td>calendar_record_get_lli   </td></tr>
<tr>
<td>double  </td><td>calendar_record_set_double  </td><td>calendar_record_get_double   </td></tr>
<tr>
<td>string  </td><td>calendar_record_set_str  </td><td>calendar_record_get_str   </td></tr>
<tr>
<td><a class="el" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a>  </td><td>calendar_record_set_caltime  </td><td>calendar_record_get_caltime   </td></tr>
</table>
<p>A record's type is identified by a structure called the view. For example, the _calendar_event view describes the properties of the calendar event record. Every view has a special field - _uri - that uniquely identifies the view. In many cases you will need to provide the _uri value to indicate what type of record you wish to create or operate on.</p>
<h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Records_Child"></a>
Child</h3>
<p>Records of certain type also hold 'child list' properties. If a record has property of this type, it can be a parent of other records, called child records. For example, attendee records can hold an event's identifier in their event_id property. The event is the parent record of the child attendee records. To use a record, you must obtain its handle. There are many ways to obtains it, including creating a new record and referring to child records of a record. Sample code:<br/>
 the code below creates an event and inserts it into default event book (see below on calendar books).</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// create an event</span>
 calendar_record_h event;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga1fae9705425d18c3e1b3b56b8f0a26c3" title="Creates a record handle.">calendar_record_create</a>(_calendar_event._uri, &amp;event);

 <span class="comment">// set event summary</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gafd27e03cc8088be90ce37888d16d9712" title="Sets a string to a record.">calendar_record_set_str</a>(event, _calendar_event.summary, <span class="stringliteral">&quot;Meeting&quot;</span>);

 <span class="comment">// put the event into the default calendar book for events</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga4e7ad91f276c9707f6a2e58ab074e314" title="Sets an integer value to a record.">calendar_record_set_int</a>(event, _calendar_event.calendar_book_id, book_id);

 <span class="comment">// add alarm as child</span>
 calendar_record_h alarm = NULL;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga1fae9705425d18c3e1b3b56b8f0a26c3" title="Creates a record handle.">calendar_record_create</a>(_calendar_alarm._uri, &amp;alarm);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga4e7ad91f276c9707f6a2e58ab074e314" title="Sets an integer value to a record.">calendar_record_set_int</a>(alarm, _calendar_alarm.tick_unit, <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga631b1b606158479e3a14a921b006b4fea294004de4baa20ed2c127efc3eb6add6">CALENDAR_ALARM_TIME_UNIT_MINUTE</a>);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga4e7ad91f276c9707f6a2e58ab074e314" title="Sets an integer value to a record.">calendar_record_set_int</a>(alarm, _calendar_alarm.tick, 5);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gafad88b4db55a0cf6b8f8f5d550159e0b" title="Adds a child record to the parent record.">calendar_record_add_child_record</a>(event, _calendar_event.calendar_alarm, alarm);

 <span class="comment">// insert calendar book into the database</span>
 <span class="keywordtype">int</span> event_id = 0;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga2d05d97a550df7d70e022b1e293dfee0" title="Inserts a record into the calendar database.">calendar_db_insert_record</a>(event, &amp;event_id);

 <span class="comment">// destroy</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga5385dccee514d7cd86b99286ac9f05cf" title="Destroys a record handle and releases all its resources.">calendar_record_destroy</a>(event, <span class="keyword">true</span>);
</pre></div><h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Calendar_books"></a>
Calendar Books</h2>
<p>A calendar book is a placeholder for other records in Calendar API. Every event and to-do has to belong to a calendar book. There are three built-in calendar books. </p>
<table class="doxtable">
<caption align="bottom">Table: Calendar books </caption>
<tr>
<td>DEFAULT_EVENT_CALENDAR_BOOK_ID  </td><td>Event book   </td></tr>
<tr>
<td>DEFAULT_TODO_CALENDAR_BOOK_ID  </td><td>Todo book   </td></tr>
<tr>
<td>DEFAULT_BIRTHDAY_CALENDAR_BOOK_ID  </td><td>Birthday book   </td></tr>
</table>
<p>There is an example how calendar book id is set.</p>
<div class="fragment"><pre class="fragment"> calendar_record_h <span class="keyword">event</span> = NULL;

 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga1fae9705425d18c3e1b3b56b8f0a26c3" title="Creates a record handle.">calendar_record_create</a>(_calendar_event._uri, &amp;event);

 <span class="comment">// set default calendar book id</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga4e7ad91f276c9707f6a2e58ab074e314" title="Sets an integer value to a record.">calendar_record_set_int</a>(event, _calendar_event.calendar_id, <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga6c4e4906ac9af103a6af91beded959d6" title="Definition for a default event calendar book database ID.">DEFAULT_EVENT_CALENDAR_BOOK_ID</a>);

 <span class="comment">// set other fields</span>

 <span class="keywordtype">int</span> event_id = 0;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga2d05d97a550df7d70e022b1e293dfee0" title="Inserts a record into the calendar database.">calendar_db_insert_record</a>(event &amp;event_id);

 <span class="comment">// destroy</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga5385dccee514d7cd86b99286ac9f05cf" title="Destroys a record handle and releases all its resources.">calendar_record_destroy</a>(event, <span class="keyword">true</span>);
</pre></div><p>To receive a list of existing calendar books, use the following:</p>
<div class="fragment"><pre class="fragment"> calendar_list_h calendar_book_list = NULL;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga451ae97d8e55835dd56ee63decd1ea48" title="Retrieves all records as a list.">calendar_db_get_all_records</a>(_calendar_book._uri, 0, 0, &amp;calendar_book_list);
</pre></div><h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Events_and_instances"></a>
Events and Instances</h2>
<p>Two important concepts are event and instance. An event record describes various properties of the event, like description, categories, priority and many others. It also contains information on when the event takes place, there can be more than one instance of the event. Each instance has its corresponding instance record. <br/>
 If event is inserted with rrule, alarm and attendee, its data is saved to each database. Generated instances based on rrule are also stored in instance database.</p>
<div class="image">
<img src="view_db.png" alt="view_db.png"/>
<div class="caption">
Figure: Views and databases</div></div>
<p> For example, if an event has the following properties: </p>
<table class="doxtable">
<caption align="bottom">Table: Event and instance example </caption>
<tr>
<th>event  </th><th>instances   </th></tr>
<tr>
<td>start date on 2012-10-09 (Tuesday) <br/>
 frequency set to 'WEEKLY' <br/>
 interval set to 1 <br/>
 count set to 3  </td><td>2012-10-09 Tuesday <br/>
 2012-10-16 Tuesday <br/>
 2012-10-23 Tuesday   </td></tr>
</table>
<p>Interval is a multiplier of frequency, which means that if it is set to N, instances occur every N weeks (or whatever was set in frequency attribute). The recurrence model in Calendar API is compliant with iCalendar specification (<a href="http://www.ietf.org/rfc/rfc2445.txt">www.ietf.org/rfc/rfc2445.txt</a>). The following event properties have the same functionality as their corresponding values in iCalendar: </p>
<table class="doxtable">
<caption align="bottom">Table: Recurrence rules. </caption>
<tr>
<th>Recurrence rule property  </th><th>comment   </th></tr>
<tr>
<td>freq  </td><td>Yearly, monthly, weekly, daily   </td></tr>
<tr>
<td>count  </td><td>Until count. If count is 3, 3 instances are generated   </td></tr>
<tr>
<td>interval  </td><td>The interval is positive integer representing how often the recurrence rule repeats   </td></tr>
<tr>
<td>byday  </td><td>MO, TU, WE, TH, FR, SA, SU   </td></tr>
<tr>
<td>bymonthday  </td><td>Days of month   </td></tr>
<tr>
<td>byyearday  </td><td>Days of year   </td></tr>
<tr>
<td>byweekno  </td><td>Ordinals specifying weeks of the year   </td></tr>
<tr>
<td>bymonth  </td><td>Months of year   </td></tr>
<tr>
<td>bysetpos  </td><td>Values which corresponds to the nth occurrence within the set of events   </td></tr>
<tr>
<td>wkst  </td><td>The day on which the workweek starts   </td></tr>
</table>
<h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Events_and_instances_Exceptions"></a>
Exceptions</h3>
<p>If one of instances is modified in summary, date… or deleted, this is called exception.<br/>
 For example, if 2nd instance date is modified from 16th to 17th, 17th is the exception. </p>
<table class="doxtable">
<caption align="bottom">Table: Exception example </caption>
<tr>
<th>event  </th><th>instances  </th><th>exceptions   </th></tr>
<tr>
<td>start date on 2012-10-09 (Tuesday) <br/>
 frequency set to 'WEEKLY' <br/>
 interval set to 1 <br/>
 count set to 3  </td><td>2012-10-09 Tuesday <br/>
 2012-10-23 Tuesday  </td><td>2012-10-17 Tuesday <br/>
   </td></tr>
</table>
<p>To get changes in exception, <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga4383557750918c177bfed6bd8c3cbb6f" title="Retrieves changed exception records since the given calendar database version. Exceptions are the mod...">calendar_db_get_changes_exception_by_version()</a> is called. These instances and exceptions are deleted together when original event is deleted.</p>
<h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Calendar_time_structure"></a>
Calendar Time Structure</h2>
<p>The calendar time structure, calendar_caltime_s, is defined as follows:</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">typedef</span> <span class="keyword">struct</span>
 {
     <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga809c1bb1db41169c65939b929520e9b6" title="Enumeration for the time type.">calendar_time_type_e</a> type;
     <span class="keyword">union </span>{
         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> utime;
         <span class="keyword">struct </span>{
             <span class="keywordtype">int</span> year;
             <span class="keywordtype">int</span> month;
             <span class="keywordtype">int</span> mday;
         } date;
     } time;
 } <a class="code" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a>;
</pre></div><p>The structure should be used when setting the calendar time type (_CALENDAR_PROPERTY_CALTIME) properties of records. It can hold two types of data: UTC time (long long int) and date, given as year, month and day of the month (three integers). These types are identified by values of calendar_time_type_e, which are CALENDAR_TIME_UTIME and CALENDAR_TIME_LOCALTIME, respectively. The data type determines the usage of the structure. </p>
<table class="doxtable">
<caption align="bottom">Table: Data types </caption>
<tr>
<th>Identifier  </th><th>Type  </th><th>Name  </th><th>Purpose   </th></tr>
<tr>
<td>CALENDAR_TIME_UTIME  </td><td>long long int  </td><td>utime  </td><td>UTC time, used to describe non-all-day events   </td></tr>
<tr>
<td>CALENDAR_TIME_LOCALTIME  </td><td>struct  </td><td>date  </td><td>date only (year, month and day of the month), used to describe all day events   </td></tr>
</table>
<h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Calendar_time_structure_UTC_time_usage"></a>
UTC Time Usage</h3>
<p>Structures with UTC time should be used for non-all-day events. In such cases, the API user should convert local time to UTC time. The local time zone identifier should be stored in the record, in the corresponding property. For example, when setting starting time of an event, the local time zone should be stored in start_tzid. When converting local time to UTC time, the function below can be useful. The function converts the given date and time to the corresponding UTC time, considering the given time zone (first argument).</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #define ms2sec(ms) (long long int)(ms / 1000.0)</span>
<span class="preprocessor"></span>
 <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> _time_convert_itol(<span class="keywordtype">char</span> *tzid, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> mon, <span class="keywordtype">int</span> d, <span class="keywordtype">int</span> h, <span class="keywordtype">int</span> min, <span class="keywordtype">int</span> s)
 {
     <span class="keywordtype">int</span> ret = 0;
     <a class="code" href="group__CAPI__BASE__UTILS__I18N__UCHAR__MODULE.html#gae6871ae4101c3d6462efc5d2dd9a6122" title="i18n_uchar.">i18n_uchar</a> utf16_timezone[CAL_STR_SHORT_LEN64] = {0};
     <a class="code" href="group__CAPI__BASE__UTILS__I18N__USTRING__MODULE.html#gafd9d5d4b85a7b152eb373609b0a7ae8f" title="Copies a byte string encoded in the default codepage to a ustring.">i18n_ustring_copy_ua_n</a>(utf16_timezone, tzid, <span class="keyword">sizeof</span>(utf16_timezone)/<span class="keyword">sizeof</span>(<a class="code" href="group__CAPI__BASE__UTILS__I18N__UCHAR__MODULE.html#gae6871ae4101c3d6462efc5d2dd9a6122" title="i18n_uchar.">i18n_uchar</a>));

     <a class="code" href="group__CAPI__BASE__UTILS__I18N__UCALENDAR__MODULE.html#ga7432adbd8d47daa469fc2512af579168" title="i18n_ucalendar_h.">i18n_ucalendar_h</a> ucal = NULL;
     <span class="keywordtype">char</span> *loc_default = NULL;
     <a class="code" href="group__CAPI__BASE__UTILS__I18N__ULOCALE__MODULE.html#ga80b5d5afd68bdc8d65ef1114f875d5b4" title="Gets I18N&#39;s default locale.">i18n_ulocale_get_default</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> **)&amp;loc_default);
     ret = <a class="code" href="group__CAPI__BASE__UTILS__I18N__UCALENDAR__MODULE.html#ga8ea3d8bf908b9fbbf634c56fab7a6ae7" title="Creates an i18n_ucalendar_h. An i18n_ucalendar_h may be used to convert a millisecond value to a year...">i18n_ucalendar_create</a>(utf16_timezone, -1, loc_default, <a class="code" href="group__CAPI__BASE__UTILS__I18N__UCALENDAR__MODULE.html#ggaa89574b71b28451c38c50a703692b91eaab2b9e09358c47e6ca432a1a253287ee">I18N_UCALENDAR_GREGORIAN</a>, &amp;ucal);
     <span class="keywordflow">if</span> (<a class="code" href="group__CAPI__BASE__UTILS__I18N__MODULE.html#gga5ff3597a44d9e4d893a474cd586b9adeaa88da6b0ffb3ce7c4ce9b52e39cb28da">I18N_ERROR_NONE</a> != ret) {
           <a class="code" href="group__CAPI__SYSTEM__DLOG.html#gaeb5d6a73b9b98abd319e9aaa8ee62bad" title="Sends log with priority and tag.">dlog_print</a>(<a class="code" href="group__CAPI__SYSTEM__DLOG.html#gga87e2b0bdb074915521f34ea7e53d9c54afe587b82bef57a833efb01cb01ab331d">DLOG_DEBUG</a>, LOG_TAG, <span class="stringliteral">&quot;i18n_ucalendar_create() Fail (%d)\n&quot;</span>, ret);
         <span class="keywordflow">return</span> -1;
     }

     <a class="code" href="group__CAPI__BASE__UTILS__I18N__UCALENDAR__MODULE.html#gafb4b578f226c0aba321189f3a8aaccd7" title="Sets a calendar&#39;s current date.">i18n_ucalendar_set_date_time</a>(ucal, y, mon - 1, d, h, min, s);

     <a class="code" href="group__CAPI__BASE__UTILS__I18N__UDATE__MODULE.html#ga0c4ab3c4cc779bde778f3d9ee1ab0591" title="Date and Time data type.   This is a primitive data type that holds the date and time as the number o...">i18n_udate</a> date;
     ret = i18n_ucalendar_get_millisecond(ucal, &amp;date);
     <span class="keywordflow">if</span> (<a class="code" href="group__CAPI__BASE__UTILS__I18N__MODULE.html#gga5ff3597a44d9e4d893a474cd586b9adeaa88da6b0ffb3ce7c4ce9b52e39cb28da">I18N_ERROR_NONE</a> != ret) {
         <a class="code" href="group__CAPI__SYSTEM__DLOG.html#gaeb5d6a73b9b98abd319e9aaa8ee62bad" title="Sends log with priority and tag.">dlog_print</a>(<a class="code" href="group__CAPI__SYSTEM__DLOG.html#gga87e2b0bdb074915521f34ea7e53d9c54afe587b82bef57a833efb01cb01ab331d">DLOG_DEBUG</a>, LOG_TAG, <span class="stringliteral">&quot;i18n_ucalendar_create() Fail (%d)\n&quot;</span>, ret);
         <a class="code" href="group__CAPI__BASE__UTILS__I18N__UCALENDAR__MODULE.html#ga0dfc2b1e62909b5d6d685d7969d89bdc" title="Destroys an i18n_ucalendar_h.">i18n_ucalendar_destroy</a>(ucal);
         <span class="keywordflow">return</span> -1;
     }
     <a class="code" href="group__CAPI__BASE__UTILS__I18N__UCALENDAR__MODULE.html#ga0dfc2b1e62909b5d6d685d7969d89bdc" title="Destroys an i18n_ucalendar_h.">i18n_ucalendar_destroy</a>(ucal);

     <span class="keywordflow">return</span> ms2sec(date);
 }
</pre></div><p>Sample code:<br/>
 </p>
<div class="fragment"><pre class="fragment"> <span class="comment">// fill calendar time structures (start and end time)</span>
 <a class="code" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a> st = {0};
 <a class="code" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a> et = {0};

 st.<a class="code" href="structcalendar__time__s.html#aebcc6048db0c62e4fce87c820caaaa09">type</a> = <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga809c1bb1db41169c65939b929520e9b6ae1bc98c9075299548fc6d2c7a242a0aa">CALENDAR_TIME_UTIME</a>;
 st.time.<a class="code" href="structcalendar__time__s.html#ac20da9736309e9275c0d3c4e98cea211">utime</a> = _time_convert_itol(<span class="stringliteral">&quot;Asia/Seoul&quot;</span>, 2012, 9, 15, 11, 0, 0);

 et.<a class="code" href="structcalendar__time__s.html#aebcc6048db0c62e4fce87c820caaaa09">type</a> = <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga809c1bb1db41169c65939b929520e9b6ae1bc98c9075299548fc6d2c7a242a0aa">CALENDAR_TIME_UTIME</a>;
 et.time.<a class="code" href="structcalendar__time__s.html#ac20da9736309e9275c0d3c4e98cea211">utime</a> = _time_convert_itol(<span class="stringliteral">&quot;Asia/Seoul&quot;</span>, 2012, 9, 15, 12, 0, 0);

 <span class="comment">// create an event record</span>
 <span class="comment">// ...</span>

 <span class="comment">// set local time zone of start time</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gafd27e03cc8088be90ce37888d16d9712" title="Sets a string to a record.">calendar_record_set_str</a>(event, _calendar_event.start_tzid, <span class="stringliteral">&quot;Asia/Seoul&quot;</span>);

 <span class="comment">// set start time</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gaa2fc055b51470ab9034fbce7675309bd" title="Sets a calendar_time_s value to a record.">calendar_record_set_caltime</a>(event, _calendar_event.start_time, st);

 <span class="comment">// set local time zone of end time</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gafd27e03cc8088be90ce37888d16d9712" title="Sets a string to a record.">calendar_record_set_str</a>(event, _calendar_event.end_tzid, <span class="stringliteral">&quot;Asia/Seoul&quot;</span>);

 <span class="comment">// set end time</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gaa2fc055b51470ab9034fbce7675309bd" title="Sets a calendar_time_s value to a record.">calendar_record_set_caltime</a>(event, _calendar_event.end_time, et);
</pre></div><h3><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Calendar_time_structure_Date_usage"></a>
Date Usage</h3>
<p>Another usage of time structure is an all day event. In case of such events, the structure's type field MUST be set to CALENDAR_TIME_LOCALTIME. Only the date (no time) will be stored. Such structures can be used to set start and end time of an event. <br/>
 Both start and end time of the event MUST be set. The end date value MUST be later in time than the value of the start date.</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// range is 2days: 2014/02/17 00:00:00 ~ 2014/02/19 00:00:00</span>

 <a class="code" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a> st = {0};
 st.<a class="code" href="structcalendar__time__s.html#aebcc6048db0c62e4fce87c820caaaa09">type</a> = <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga809c1bb1db41169c65939b929520e9b6a9e29af8aa7f40bbcf941ef036107b70d">CALENDAR_TIME_LOCALTIME</a>;
 st.time.date.year = 2014;
 st.time.date.month = 2;
 st.time.date.mday = 17;

 <a class="code" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a> et = {0};
 et.<a class="code" href="structcalendar__time__s.html#aebcc6048db0c62e4fce87c820caaaa09">type</a> = <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga809c1bb1db41169c65939b929520e9b6a9e29af8aa7f40bbcf941ef036107b70d">CALENDAR_TIME_LOCALTIME</a>;
 et.time.date.year = 2014;
 et.time.date.month = 2;
 et.time.date.mday = 19;

 <span class="comment">// create an event record</span>
 <span class="comment">// ...</span>
</pre></div><h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Creating_a_recurring_event"></a>
Recurring Events</h2>
<p>To create a recurring event in Calendar API, you MUST set frequency. There is a sample code how to create recurring event. Firstly, set start and end time.</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a> st = {0};
 st.<a class="code" href="structcalendar__time__s.html#aebcc6048db0c62e4fce87c820caaaa09">type</a> = <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga809c1bb1db41169c65939b929520e9b6ae1bc98c9075299548fc6d2c7a242a0aa">CALENDAR_TIME_UTIME</a>;
 st.time.<a class="code" href="structcalendar__time__s.html#ac20da9736309e9275c0d3c4e98cea211">utime</a> = _time_convert_itol(<span class="stringliteral">&quot;Asia/Seoul&quot;</span>, 2012, 9, 15, 11, 0, 0);

 <a class="code" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a> et = {0};
 et.<a class="code" href="structcalendar__time__s.html#aebcc6048db0c62e4fce87c820caaaa09">type</a> = <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga809c1bb1db41169c65939b929520e9b6ae1bc98c9075299548fc6d2c7a242a0aa">CALENDAR_TIME_UTIME</a>;
 et.time.<a class="code" href="structcalendar__time__s.html#ac20da9736309e9275c0d3c4e98cea211">utime</a> = _time_convert_itol(<span class="stringliteral">&quot;Asia/Seoul&quot;</span>, 2012, 9, 15, 12, 0, 0);
</pre></div><p>Then, the remaining properties should be set. Each frequency needs other proper fields except daily event. If other values are not inserted, these values are calculated based on start time. </p>
<table class="doxtable">
<caption align="bottom">Table: Frequency properties </caption>
<tr>
<th>Freq  </th><th>Property  </th><th>Comment   </th></tr>
<tr>
<td>CALENDAR_RECURRENCE_YEARLY  </td><td>byyearday  </td><td>Every 100th day   </td></tr>
<tr>
<td></td><td>byweekno  </td><td>Every 34th week   </td></tr>
<tr>
<td></td><td>bymonthday  </td><td>Every 1st February (birthday)  </td></tr>
<tr>
<td></td><td>byday  </td><td>Every 1st Monday of May (holiday)   </td></tr>
<tr>
<td>CALENDAR_RECURRENCE_MONTHLY  </td><td>bymonthday  </td><td>Every 29th (payday)   </td></tr>
<tr>
<td></td><td>byday  </td><td>Every last Friday   </td></tr>
<tr>
<td>CALENDAR_RECURRENCE_WEEKLY  </td><td>byday  </td><td>Every week   </td></tr>
<tr>
<td>CALENDAR_RECURRENCE_DAILY  </td><td>-  </td><td>-   </td></tr>
</table>
<p>If byday is not set in weekly event, default byday is followed start day of week. By the same token, default interval is 1 and default range type is endless. </p>
<table class="doxtable">
<caption align="bottom">Table: Range types </caption>
<tr>
<th>Range type  </th><th>Comment   </th></tr>
<tr>
<td>CALENDAR_RANGE_NONE  </td><td>Endless(max date is 2036/12/31)   </td></tr>
<tr>
<td>CALENDAR_RANGE_UNTIL  </td><td>Should set until property   </td></tr>
<tr>
<td>CALENDAR_RANGE_COUNT  </td><td>Should set count property   </td></tr>
</table>
<div class="fragment"><pre class="fragment"> calendar_record_h event;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga1fae9705425d18c3e1b3b56b8f0a26c3" title="Creates a record handle.">calendar_record_create</a>(_calendar_event._uri, &amp;event);

 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gafd27e03cc8088be90ce37888d16d9712" title="Sets a string to a record.">calendar_record_set_str</a>(event, _calendar_event.start_tzid, <span class="stringliteral">&quot;Asia/Seoul&quot;</span>);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gaa2fc055b51470ab9034fbce7675309bd" title="Sets a calendar_time_s value to a record.">calendar_record_set_caltime</a>(event, _calendar_event.start_time, st);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gafd27e03cc8088be90ce37888d16d9712" title="Sets a string to a record.">calendar_record_set_str</a>(event, _calendar_event.end_tzid, <span class="stringliteral">&quot;Asia/Seoul&quot;</span>);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gaa2fc055b51470ab9034fbce7675309bd" title="Sets a calendar_time_s value to a record.">calendar_record_set_caltime</a>(event, _calendar_event.end_time, et);

 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga4e7ad91f276c9707f6a2e58ab074e314" title="Sets an integer value to a record.">calendar_record_set_int</a>(event, _calendar_event.freq, <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga09e4062e3a0cb96c26ef5d654cafb79cab87c81b7ff9896c9fb7e292bc69ad9e4">CALENDAR_RECURRENCE_WEEKLY</a>);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga4e7ad91f276c9707f6a2e58ab074e314" title="Sets an integer value to a record.">calendar_record_set_int</a>(event, _calendar_event.interval, 1)
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga4e7ad91f276c9707f6a2e58ab074e314" title="Sets an integer value to a record.">calendar_record_set_int</a>(event, _calendar_event.count, 3);
</pre></div><p>The last step is inserting the event into the database. Records representing instances of the event are created when the event record is inserted.</p>
<div class="fragment"><pre class="fragment"> <span class="keywordtype">int</span> event_id = 0;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga2d05d97a550df7d70e022b1e293dfee0" title="Inserts a record into the calendar database.">calendar_db_insert_record</a>(event, &amp;event_id);

 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga5385dccee514d7cd86b99286ac9f05cf" title="Destroys a record handle and releases all its resources.">calendar_record_destroy</a>(event, <span class="keyword">true</span>);
</pre></div><h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Filters_and_queries"></a>
Filters and Queries</h2>
<p>Queries are used to retrieve data which satisfies given criteria, like an integer property being greater than a given value, or a string property containing a given substring. The criteria are defined by creating filters and adding conditions to them, joining them with logical operators. Also, instead of a condition, another filter can be added, which can be used to create more complex filters. Operator precedence in filters determined by the order in which the conditions and filters are added. When a filter is ready, it can be set as a property of a query. Other query properties allow configuring how the returned results are grouped and sorted. Operator precedence in filters is determined by the order in which the conditions and filters are added are added. For example, if the following sequence is added: </p>
<table class="doxtable">
<caption align="bottom">Table: Filter and conditions </caption>
<tr>
<th>Filter with conditions  </th><th>Result   </th></tr>
<tr>
<td>Contidion C1 <br/>
 OR <br/>
 Contidion C2 <br/>
 AND <br/>
 Condition C3  </td><td>(C1 OR C2) AND C3   </td></tr>
<tr>
<td>Filter F1: <br/>
 Condition C1 <br/>
 OR <br/>
 Condition C2 <br/>
<br/>
 Filter F2: <br/>
 Condition C3 <br/>
 OR <br/>
 Condition C4 <br/>
<br/>
 Filter F3: <br/>
 Condition C5 <br/>
 AND <br/>
 F1 <br/>
 AND <br/>
 F2  </td><td>(C5 AND F1) AND F2 <br/>
 Which is: <br/>
 (C5 AND (C1 OR C2)) AND (C3 OR C4)   </td></tr>
</table>
<p>The following code creates a filter, accepting events with high priority or those that include the word "meeting" in their description.</p>
<div class="fragment"><pre class="fragment"> calendar_filter_h filter = NULL;

 <span class="comment">// create a filter returning event type records</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#ga3b0732470c12fb4d037e9ae4e0ba5714" title="Creates a filter handle.">calendar_filter_create</a>(_calendar_event._uri, &amp;filter);

 <span class="comment">// add &#39;priority equals high&#39; condition</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#ga6a1252bffe192b70296c87060ea796f5" title="Adds a condition for the integer type property.">calendar_filter_add_int</a>(filter, _calendar_event.priority, <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#ggad0c1292d17ef22cfbcd3303f43368575ad79ed49dfbc1e43edce89f15d158515a">CALENDAR_MATCH_EQUAL</a>, <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ggac408d2c106f08a82b64129746e819779a7b1391176ded0d00f343e883c6ea9c69">CALENDAR_EVENT_PRIORITY_HIGH</a>);

 <span class="comment">// add OR operator</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#ga5d4e444099841ef34a266fe38529a0bc" title="Adds an operator between conditions.">calendar_filter_add_operator</a>(filter, <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#gga472d224863bec5007b9e80e375322e32aabdca5025f1acec271057820bb7a535e">CALENDAR_FILTER_OPERATOR_OR</a>);

 <span class="comment">// add &#39;description contains &quot;meeting&quot;&#39; condition</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#gaca9ef88389ee5469d18521a8ab4c4a7b" title="Adds a condition for the string type property.">calendar_filter_add_str</a>(filter, _calendar_event.description, <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#gga14dd457083174129363462574f8eeb8cab911daa2babbb188a306401153f7020a">CALENDAR_MATCH_CONTAINS</a>, <span class="stringliteral">&quot;meeting&quot;</span>);
</pre></div><p>The filter should be inserted into a query and the query should be executed:</p>
<div class="fragment"><pre class="fragment"> calendar_query_h query = NULL;
 calendar_list_h list = NULL;

 <span class="comment">// create a query returning event type records</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__QUERY__MODULE.html#ga8ac0b52b111839ec845a49285fda98f0" title="Creates a query handle.">calendar_query_create</a>(_calendar_event._uri, &amp;query);

 <span class="comment">// add the filter</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__QUERY__MODULE.html#gab15988601ac680605b0cef3c85fea31e" title="Sets the filter for a query.">calendar_query_set_filter</a>(query, filter);

 <span class="comment">// execute the query, results are returned in a list</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga150cd0ca5a6465841edc75eb9d6be378" title="Retrieves records using a query handle.">calendar_db_get_records_with_query</a>(query, 0, 0, &amp;list);

 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#ga4b42fbcc5db14ae8c167014103342f65" title="Destroys a filter handle.">calendar_filter_destroy</a>(filter);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__QUERY__MODULE.html#ga403e760acd53a9100bc92199de9a5e7e" title="Destroys a query handle.">calendar_query_destroy</a>(query);

 <span class="comment">// use the list</span>
 <span class="comment">// ...</span>

 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__LIST__MODULE.html#gafdf79b880072b8a499ec47579e844a05" title="Destroys a calendar list handle and releases all its resources.">calendar_list_destroy</a>(list, <span class="keyword">true</span>);
</pre></div><h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Projections"></a>
Projections</h2>
<p>Useful concept in Calendar service APIs is projection, related to searching with filters and queries. Projection allows you to query the Data for just those specific properties of a record that you actually need, at lower latency and cost than retrieving the entire properties. Sample code:<br/>
 create filter which will get event id, summary and start time from the record with its summary has “test” (string filter). Create a query and add the filter to it. Results are received in a list.</p>
<div class="fragment"><pre class="fragment"> calendar_query_h query = NULL;
 calendar_filter_h filter = NULL;

 <span class="comment">// set query with filter</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__QUERY__MODULE.html#ga8ac0b52b111839ec845a49285fda98f0" title="Creates a query handle.">calendar_query_create</a>(_calendar_event_calendar_book_attendee._uri, &amp;query);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#ga3b0732470c12fb4d037e9ae4e0ba5714" title="Creates a filter handle.">calendar_filter_create</a>(_calendar_event_calendar_book_attendee._uri, &amp;filter);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#gaca9ef88389ee5469d18521a8ab4c4a7b" title="Adds a condition for the string type property.">calendar_filter_add_str</a>(filter, _calendar_event.summary, <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#gga14dd457083174129363462574f8eeb8cab911daa2babbb188a306401153f7020a">CALENDAR_MATCH_CONTAINS</a>, <span class="stringliteral">&quot;test&quot;</span>);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__QUERY__MODULE.html#gab15988601ac680605b0cef3c85fea31e" title="Sets the filter for a query.">calendar_query_set_filter</a>(query, filter);

 <span class="comment">// set projection</span>
 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> projection[3];
 projection[0]=_calendar_event_calendar_book_attendee.event_id;
 projection[1]=_calendar_event_calendar_book_attendee.summary;
 projection[2]=_calendar_event_calendar_book_attendee.start_time;

 <span class="comment">// get list</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__QUERY__MODULE.html#gae225941c89cf77b2e89552cc3b199f7b" title="Adds property IDs for projection.">calendar_query_set_projection</a>(query, projection, 3);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga150cd0ca5a6465841edc75eb9d6be378" title="Retrieves records using a query handle.">calendar_db_get_records_with_query</a>(query, 0, 0, &amp;list);

 <span class="comment">// destroy handle</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__FILTER__MODULE.html#ga4b42fbcc5db14ae8c167014103342f65" title="Destroys a filter handle.">calendar_filter_destroy</a>(filter);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__QUERY__MODULE.html#ga403e760acd53a9100bc92199de9a5e7e" title="Destroys a query handle.">calendar_query_destroy</a>(query);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__LIST__MODULE.html#gafdf79b880072b8a499ec47579e844a05" title="Destroys a calendar list handle and releases all its resources.">calendar_list_destroy</a>(list, <span class="keyword">true</span>);
</pre></div><h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Reminders"></a>
Reminders</h2>
<p>Alarm and reminder is the similar terminology but reminder is used as package name storages, shown in below figure 5. When alarm alerts, calendar-service sends notification to all packages which is registered in reminder DB table with calendar_reminder_add_receiver(). This shows how to set alarm and how alarm works.</p>
<div class="image">
<img src="alarm_process.png" alt="alarm_process.png"/>
<div class="caption">
Figure: Alarm process</div></div>
<p> After adding receiver, registered alarm would be alerted on reserved time by inserting alarm as child. </p>
<table class="doxtable">
<caption align="bottom">Table: Alarm fields </caption>
<tr>
<th>tick_unit  </th><th>related field  </th><th>comment   </th></tr>
<tr>
<td>CALENDAR_ALARM_TIME_UNIT_SPECIFIC  </td><td>time  </td><td>This represents the number of seconds elapsed since the Epoch, 1970-01-01 00:00:00 +0000 (UTC)   </td></tr>
<tr>
<td>CALENDAR_ALARM_TIME_UNIT_WEEK  </td><td>tick  </td><td>The number of weeks before start time   </td></tr>
<tr>
<td>CALENDAR_ALARM_TIME_UNIT_DAY  </td><td>tick  </td><td>The number of days before start time   </td></tr>
<tr>
<td>CALENDAR_ALARM_TIME_UNIT_HOUR  </td><td>tick  </td><td>The number of hours before start time   </td></tr>
<tr>
<td>CALENDAR_ALARM_TIME_UNIT_MINUTE  </td><td>tick  </td><td>The number of minutes before start time   </td></tr>
</table>
<p>Below example shows the alarm which is set 1 minute before start time.</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// set alarm with normal unit</span>
 calendar_record_h alarm = NULL;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga1fae9705425d18c3e1b3b56b8f0a26c3" title="Creates a record handle.">calendar_record_create</a>(_calendar_alarm._uri, &amp;alarm);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga4e7ad91f276c9707f6a2e58ab074e314" title="Sets an integer value to a record.">calendar_record_set_int</a>(alarm, _calendar_alarm.tick_unit, <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga631b1b606158479e3a14a921b006b4fea294004de4baa20ed2c127efc3eb6add6">CALENDAR_ALARM_TIME_UNIT_MINUTE</a>);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga4e7ad91f276c9707f6a2e58ab074e314" title="Sets an integer value to a record.">calendar_record_set_int</a>(alarm, _calendar_alarm.tick, 1); <span class="comment">// before 1min (60secs)</span>

 <span class="comment">// add alarm as child</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gafad88b4db55a0cf6b8f8f5d550159e0b" title="Adds a child record to the parent record.">calendar_record_add_child_record</a>(event, _calendar_event.calendar_alarm, alarm);
</pre></div><p>With CALENDAR_ALARM_TIME_UNIT_SPECIFIC, the alarm could be set regardless of the start time.</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// set alarm with specific unit</span>
 calendar_record_h alarm = NULL;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga1fae9705425d18c3e1b3b56b8f0a26c3" title="Creates a record handle.">calendar_record_create</a>(_calendar_alarm._uri, &amp;alarm);
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#ga4e7ad91f276c9707f6a2e58ab074e314" title="Sets an integer value to a record.">calendar_record_set_int</a>(alarm, _calendar_alarm.tick_unit, <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga631b1b606158479e3a14a921b006b4fea82e0f69f937e927d1c756be4ad0f0f3e">CALENDAR_ALARM_TIME_UNIT_SPECIFIC</a>);
 <span class="comment">// suppose start time is 1404036000(Sun, 29 Jun 2014 10:00:00 GMT) and alarm is set 60secs after from start time.</span>
 <a class="code" href="structcalendar__time__s.html" title="The structure of time.">calendar_time_s</a> ct;
 ct.<a class="code" href="structcalendar__time__s.html#aebcc6048db0c62e4fce87c820caaaa09">type</a> = <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gga809c1bb1db41169c65939b929520e9b6ae1bc98c9075299548fc6d2c7a242a0aa">CALENDAR_TIME_UTIME</a>;
 ct.time.<a class="code" href="structcalendar__time__s.html#ac20da9736309e9275c0d3c4e98cea211">utime</a> = 1404036000 + 60;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gaa2fc055b51470ab9034fbce7675309bd" title="Sets a calendar_time_s value to a record.">calendar_record_set_caltime</a>(alarm, _calendar_alarm.alarm_time, ct);

 <span class="comment">// add alarm as child</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__RECORD__MODULE.html#gafad88b4db55a0cf6b8f8f5d550159e0b" title="Adds a child record to the parent record.">calendar_record_add_child_record</a>(event, _calendar_event.calendar_alarm, alarm);
</pre></div><p>How to register package as reminder. In manifest.xml file, below code must be inserted.</p>
<div class="fragment"><pre class="fragment"> &lt;app-control&gt;
    &lt;operation name=<span class="stringliteral">&quot;http://tizen.org/appcontrol/operation/view&quot;</span> /&gt;
    &lt;mime name=<span class="stringliteral">&quot;application/x-tizen.calendar.reminder&quot;</span> /&gt;
 &lt;/app-control&gt;
</pre></div><p>When alarm alerts, calendar-service sends data with key, value pairs.<br/>
 With "ids" key, id array could be get.<br/>
 Each detail value could be get with "each id" key.<br/>
 The detail data is the combination of alarm values. id, time, tick, unit and type is connected with "&amp;" charater.<br/>
 ex&gt; id=64&amp;time=1415106300&amp;tick=0&amp;unit=60&amp;type=0</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// &quot;ids&quot; string is the key, to get id array</span>
 <span class="keywordtype">char</span> **ids = NULL;
 <span class="keywordtype">int</span> len = 0;
 <a class="code" href="group__CAPI__APP__CONTROL__MODULE.html#ga0985f722c12ddc24f66b8bcb4d17f2c7" title="Gets the extra data array from the app_control.">app_control_get_extra_data_array</a>(b, <span class="stringliteral">&quot;ids&quot;</span>, &amp;ids, &amp;len);

 <span class="keywordtype">int</span> i = 0;
 <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {
    <span class="comment">// &quot;id&quot; is the key to get detail value</span>
    <span class="keywordtype">char</span> *value = NULL;
    <a class="code" href="group__CAPI__APP__CONTROL__MODULE.html#ga006a7a9fb47c82edaa5413ad0af23f7e" title="Gets the extra data from the app_control.">app_control_get_extra_data</a>(b, ids[i], &amp;value);
    <span class="keywordflow">if</span> (NULL == value) {
        <span class="keywordflow">continue</span>;
    }
    <span class="comment">// parse detail data</span>

    <span class="comment">// free</span>
    free(ids[i]);
    ids[i] = NULL;
 }

 free(ids);
</pre></div><h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Db_change_noties"></a>
Database Change Notifications</h2>
<p>Applications add/remove callback function to detect/ignore the calendar DB changes with <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#gaa201c12f8c684843506adfab0e1bbb1b" title="Registers a callback function to be invoked when a record changes.">calendar_db_add_changed_cb()</a> / <a class="el" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#ga2f2777fbcd9a52f7df4778ce881419c4" title="Unregisters a callback function.">calendar_db_remove_changed_cb()</a>. <br/>
 Clients await calendar change notification on client side. If calendar is changed by another module, server publishes inotify event. Inotify module broadcasts to subscribe modules. Internal inotify handler is called at client side. User callback function is called with user data.</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// add callback function</span>
 <span class="keywordtype">void</span> __event_changed_cb(<span class="keyword">const</span> <span class="keywordtype">char</span> *view_uri, <span class="keywordtype">void</span> *user_data)
 {
 }
 <span class="comment">// add changed noti callback</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__DATABASE__MODULE.html#gaa201c12f8c684843506adfab0e1bbb1b" title="Registers a callback function to be invoked when a record changes.">calendar_db_add_changed_cb</a>(_calendar_event._uri, __event_changed_cb, NULL);
</pre></div><h2><a class="anchor" id="CAPI_SOCIAL_CALENDAR_SVC_MODULE_Vcalendar"></a>
Vcalendar</h2>
<p>To exchange of personal calendaring and scheduling information, vcalendar is used. In order to avoid confusion with this referenced work, this is to be known as the vcalendar specification. Vcalendar ver2.0 is known as icalendar. </p>
<table class="doxtable">
<caption align="bottom">Table: Vcalendar example ( <a href="http://www.ietf.org/rfc/rfc2445.txt">http://www.ietf.org/rfc/rfc2445.txt</a> ) </caption>
<tr>
<td>BEGIN:VCALENDAR<br/>
 VERSION:2.0<br/>
 PRODID:-//hacksw/handcal//NONSGML v1.0//EN<br/>
 BEGIN:VEVENT<br/>
 DTSTART:19970714T170000Z<br/>
 DTEND:19970715T035959Z<br/>
 SUMMARY:Bastille Day Party<br/>
 END:VEVENT<br/>
 END:VCALENDAR<br/>
   </td></tr>
</table>
<p>Calendar service provides APIs to compose vcalendar stream. With stream, file could be made or data could be transmitted with json data.</p>
<div class="fragment"><pre class="fragment"> calendar_list_h list = NULL;
 <span class="comment">// create or get list to make vcalendar stream</span>

 <span class="keywordtype">char</span> *stream = NULL;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__VCALENDAR__MODULE.html#ga3f6235db2fa30ceb55cb06a273dadfcb" title="Retrieves a vcalendar stream from a calendar list.">calendar_vcalendar_make_from_records</a>(list, &amp;stream);

 <span class="comment">// jobs for stream</span>

 <span class="comment">// free</span>
 free(stream);
</pre></div><p>Vcalendar could be parsed with calendar service APIs as well.</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// read  stream from file</span>

 calendar_list_h list = NULL;
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__VCALENDAR__MODULE.html#gacaf0baeec89d3e453b315f1f25956837" title="Retrieves all calendars from a vcalendar stream.">calendar_vcalendar_parse_to_calendar</a>(stream, &amp;list);

 <span class="comment">// jobs for list…</span>
 <a class="code" href="group__CAPI__SOCIAL__CALENDAR__SVC__LIST__MODULE.html#gafdf79b880072b8a499ec47579e844a05" title="Destroys a calendar list handle and releases all its resources.">calendar_list_destroy</a>(list, <span class="keyword">true</span>);
</pre></div> </div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
