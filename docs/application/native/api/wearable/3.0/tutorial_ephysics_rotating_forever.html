<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: EPhysics - Rotating Forever</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">EPhysics - Rotating Forever </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of this example is to demonstrate the EPhysics Rotate usage - The code applies different ways to rotate an EPhysics_Body, such as torque, torque impulse and rotation set.</p>
<p>For this example we'll have an EPhysics_World with gravity setted to zero, and four basic EPhysics_Bodys.</p>
<p>The basic concepts like - defining an EPhysics_World, render geometry, physics limiting boundaries, add an EPhysics_Body, associate it to evas objects, change restitution, friction and impulse properties, were already covered in <a class="el" href="tutorial_ephysics_bouncing_ball.html">EPhysics - Bouncing Ball</a></p>
<h2><a class="anchor" id="add-rotate"></a>
Rotating</h2>
<p>For the first body we'll apply a torque impulse to make it rotate around Z axis (rotate on x-y plane). Will make the body rolls on clockwise rotation, if the value is negative, the impulse will be on counter clockwise.</p>
<p><div class="fragment"><pre class="fragment">   ephysics_body_torque_impulse_apply(body, 0, 0, 1);
</pre></div></p>
<p>For the second body we'll use an offset to apply the force, the three last parameters are responsible to set a relative position to apply the force.In other words, the force applied with an offset will make the body rotates and move around the other cubes.</p>
<p><div class="fragment"><pre class="fragment">   ephysics_body_impulse_apply(body, 30, 0, 0, 0, -10, 0);
</pre></div></p>
<p>For the third body we'll use a timer to rotate the body and a callback to delete it.</p>
<p><div class="fragment"><pre class="fragment">   timer = <a class="code" href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add</a>(1, _rotate_cb, body);

   ephysics_body_event_callback_add(body,
                                    EPHYSICS_CALLBACK_BODY_DEL,
                                    _del_cb, timer);
</pre></div></p>
 <div class="fragment"><pre class="fragment">_del_cb(<span class="keywordtype">void</span> *data, EPhysics_Body *body __UNUSED__, <span class="keywordtype">void</span> *event_info __UNUSED__)
{
   <a class="code" href="group__Ecore__Timer__Group.html#gaba2b599c7aabe3ab664dc3d47f62a33a">ecore_timer_del</a>(data);
}
</pre></div></p>
<p>In the function we'll get the body rotation on z axis in degrees and handle it increasing 5 degrees on its position on z axis on each tick of the timer.</p>
 <div class="fragment"><pre class="fragment">_rotate_cb(<span class="keywordtype">void</span> *data)
{
   EPhysics_Quaternion *quat_prev, quat_delta, quat;
   EPhysics_Body *body = data;

   quat_prev = ephysics_body_rotation_get(body, NULL);
   ephysics_quaternion_set(&amp;quat_delta, 0, 0, -0.15, 0.98);
   ephysics_quaternion_normalize(&amp;quat_delta);
   ephysics_body_rotation_set(
      body, ephysics_quaternion_multiply(&amp;quat_delta, quat_prev, &amp;quat));
   free(quat_prev);

   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;
}
</pre></div></p>
<p>For the forth body we'll use 2 timers, but before that, we'll apply an initial torque, changing the body angular acceleration and a callback to delete the timers we'll add.</p>
<p><div class="fragment"><pre class="fragment">   ephysics_body_torque_apply(body, 0, 0, 2);
   ephysics_body_event_callback_add(body,
                                    EPHYSICS_CALLBACK_BODY_DEL,
</pre></div></p>
<p>Just the callback function to delete the timers.</p>
 <div class="fragment"><pre class="fragment">_del_torque_cb(<span class="keywordtype">void</span> *data __UNUSED__, <a class="code" href="group__Evas__Canvas.html#ga5ff87cc4ce6bc43e3b640a6d37f73043">Evas</a> *e __UNUSED__, <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *obj, <span class="keywordtype">void</span> *event_info __UNUSED__)
{
   <a class="code" href="group__Ecore__Timer__Group.html#gaf96ffb609956658ec038e54bd39f46f0">Ecore_Timer</a> *timer;

   timer = <a class="code" href="group__Evas__Object__Group__Extras.html#gafbad43015793eda4ae50202c0ce0e652">evas_object_data_get</a>(obj, <span class="stringliteral">&quot;increase_timer&quot;</span>);
   <span class="keywordflow">if</span> (timer)
     <a class="code" href="group__Ecore__Timer__Group.html#gaba2b599c7aabe3ab664dc3d47f62a33a">ecore_timer_del</a>(timer);

   timer = <a class="code" href="group__Evas__Object__Group__Extras.html#gafbad43015793eda4ae50202c0ce0e652">evas_object_data_get</a>(obj, <span class="stringliteral">&quot;stop_timer&quot;</span>);
   <span class="keywordflow">if</span> (timer)
     <a class="code" href="group__Ecore__Timer__Group.html#gaba2b599c7aabe3ab664dc3d47f62a33a">ecore_timer_del</a>(timer);
}
</pre></div></p>
<p>As we commented we'll use 2 timers, one to increase the torque and another to stop the torque, cleaning the forces related to the body.</p>
<p><div class="fragment"><pre class="fragment">   timer = <a class="code" href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add</a>(3, _increase_torque_cb, body);
   <a class="code" href="group__Evas__Object__Group__Extras.html#ga70134a7068c9bff4107a761abe0a2ad4">evas_object_data_set</a>(cube, <span class="stringliteral">&quot;increase_timer&quot;</span>, timer);
   timer = <a class="code" href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add</a>(5, _stop_torque_cb, body);
   <a class="code" href="group__Evas__Object__Group__Extras.html#ga70134a7068c9bff4107a761abe0a2ad4">evas_object_data_set</a>(cube, <span class="stringliteral">&quot;stop_timer&quot;</span>, timer);
</pre></div></p>
<p>In the increase function we'll apply a torque over the body, changing its angular acceleration, it will leads to a change on angular velocity over time. We're using a timer to increase the angular acceleration on each tick of the timer.</p>
 <div class="fragment"><pre class="fragment">_increase_torque_cb(<span class="keywordtype">void</span> *data)
{
   EPhysics_Body *body = data;
   <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *obj;

   ephysics_body_torque_apply(body, 0, 0, 2);
   obj = ephysics_body_evas_object_get(body);
   <a class="code" href="group__Evas__Object__Group__Extras.html#ga70134a7068c9bff4107a761abe0a2ad4">evas_object_data_set</a>(obj, <span class="stringliteral">&quot;increase_timer&quot;</span>, NULL);

   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;
}
</pre></div></p>
<p>In the stop function we'll clear all the forces applied to the body, setting its linear and angular acceleration to zero. We're using this timer to "control" the body velocity, since we are increasing it by another timer. Note that we set the acceleration to zero not the velocity.</p>
<p><div class="fragment"><pre class="fragment">_stop_torque_cb(<span class="keywordtype">void</span> *data)
{
   EPhysics_Body *body = data;
   <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *obj;

   ephysics_body_forces_clear(body);
   obj = ephysics_body_evas_object_get(body);
   <a class="code" href="group__Evas__Object__Group__Extras.html#ga70134a7068c9bff4107a761abe0a2ad4">evas_object_data_set</a>(obj, <span class="stringliteral">&quot;stop_timer&quot;</span>, NULL);

   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;
}
</pre></div></p>
<p>Here we finish the example. The full source code can be found at <a class="el" href="test_rotating_forever_c.html">test_rotating_forever.c</a>. </p>
</div></div><!-- contents -->
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
