<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: Edje Signals example 2</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Tizen Native API"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   &#160;<span id="projectnumber">3.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('tutorial_edje_signals_2.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Edje Signals example 2 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this example we will make use of signals to help to move an image away from the mouse pointer.</p>
<p>Signals are software interruption, this means that when it happens and if the program is sensitive to it the program will stop whatever it is doing and handle the signal.</p>
<p>In this example we are only sensitive to the "mouse,move" signal so we need to register a callback to it. To do this we will add a signal callback to our edje object that will detect "mouse,move" signal coming from the part "part_image" and when this happens we will call the function _on_mouse_over passing the evas pointer as a parameter. The evas pointer is passed as a parameter because we need to know where is the mouse pointer in the screen.</p>
<p>We can see bellow how we can listen to the signal:</p>
 <div class="fragment"><pre class="fragment">   <a class="code" href="group__Edje__Object.html#gad1275e926c53f7af0fdbe2b107c8e9e5" title="Adds a callback for an arriving Edje signal, emitted by a given Edje object.">edje_object_signal_callback_add</a>(edje_obj, <span class="stringliteral">&quot;mouse,move&quot;</span>, <span class="stringliteral">&quot;part_image&quot;</span>,
                                   _on_mouse_over, evas);
</pre></div></p>
<p>Now, let's pass to the callback function. If we want to keep the ball away from the mouse pointer we need to now where is the ball and where is the mouse and we can easily discovery these things using this:</p>
<p>For the object position in the canvas:  <div class="fragment"><pre class="fragment">   <a class="code" href="group__Evas__Font__Group.html#ga6f52fab1a96dc58c85ee481d84bac871">evas_object_geometry_get</a>(edje_obj, &amp;x, &amp;y, NULL, NULL);
</pre></div></p>
<p>For the mouse position relative to the screen: <div class="fragment"><pre class="fragment">   <a class="code" href="group__Evas__Canvas.html#ga7fac49dba2d8fef5d8faf0d67548c4fc" title="This function returns the current known pointer coordinates.">evas_pointer_output_xy_get</a>(evas, &amp;mouseX, &amp;mouseY);
</pre></div></p>
<p>Now that we have the position of the mouse and the object we just need to set the new location and move the object. To set the new location we do this: <div class="fragment"><pre class="fragment">   <span class="keywordflow">if</span> ((rand() % 2) == 0)
     x += ((mouseX - x) + (x / 4 + mouseY / 2));
   <span class="keywordflow">else</span>
     x -= ((mouseX - x) + (x / 4 + mouseY / 2));

   <span class="keywordflow">if</span> ((rand() % 2) == 0)
     y += ((mouseY - y) + (y / 4 + mouseX / 2));
   <span class="keywordflow">else</span>
     y -= ((mouseY - y) + (y / 4 + mouseX / 2));
</pre></div></p>
<p>You can change the formula above if you like. Because we are changing the object's position we need to do something if the new position is beyond the canvas size. So here it is:</p>
<p><div class="fragment"><pre class="fragment">   <span class="keywordflow">if</span> (x &gt; WIDTH)
     x = WIDTH;
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &lt; 0) x = 0;

   <span class="keywordflow">if</span> (y &gt; HEIGHT)
     y = HEIGHT;
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (y &lt; 0) y = 0;
</pre></div></p>
<p>Then now what we need to do is move the object: <div class="fragment"><pre class="fragment">   <a class="code" href="group__Evas__Font__Group.html#ga02da8091bbac768b8e86c7b74b2a94f9">evas_object_move</a>(edje_obj, x, y);
</pre></div></p>
<p>Here is the complete callback function:</p>
 <div class="fragment"><pre class="fragment">_on_mouse_over(<span class="keywordtype">void</span> *data, <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *edje_obj,
               <span class="keyword">const</span> <span class="keywordtype">char</span> *emission EINA_UNUSED, <span class="keyword">const</span> <span class="keywordtype">char</span> *source EINA_UNUSED)
{
   <a class="code" href="group__Evas__Canvas.html#ga5ff87cc4ce6bc43e3b640a6d37f73043">Evas</a> *evas;
   <span class="keywordtype">int</span> x, y, mouseX, mouseY;

   evas = (<a class="code" href="group__Evas__Canvas.html#ga5ff87cc4ce6bc43e3b640a6d37f73043">Evas</a> *) data;
   <a class="code" href="group__Evas__Font__Group.html#ga6f52fab1a96dc58c85ee481d84bac871">evas_object_geometry_get</a>(edje_obj, &amp;x, &amp;y, NULL, NULL);

   <a class="code" href="group__Evas__Canvas.html#ga7fac49dba2d8fef5d8faf0d67548c4fc" title="This function returns the current known pointer coordinates.">evas_pointer_output_xy_get</a>(evas, &amp;mouseX, &amp;mouseY);

   <span class="keywordflow">if</span> ((rand() % 2) == 0)
     x += ((mouseX - x) + (x / 4 + mouseY / 2));
   <span class="keywordflow">else</span>
     x -= ((mouseX - x) + (x / 4 + mouseY / 2));

   <span class="keywordflow">if</span> ((rand() % 2) == 0)
     y += ((mouseY - y) + (y / 4 + mouseX / 2));
   <span class="keywordflow">else</span>
     y -= ((mouseY - y) + (y / 4 + mouseX / 2));

   <span class="keywordflow">if</span> (x &gt; WIDTH)
     x = WIDTH;
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &lt; 0) x = 0;

   <span class="keywordflow">if</span> (y &gt; HEIGHT)
     y = HEIGHT;
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (y &lt; 0) y = 0;

   fprintf(stdout, <span class="stringliteral">&quot;Moving object to - (%d,%d)\n&quot;</span>, x, y);

   <a class="code" href="group__Evas__Font__Group.html#ga02da8091bbac768b8e86c7b74b2a94f9">evas_object_move</a>(edje_obj, x, y);
}
</pre></div></p>
<p>When you compile and run it you should see this: </p>
<div class="image">
<img src="signal2final.png" alt="signal2final.png"/>
</div>
  <p>The .edc file: </p>
<div class="fragment"><pre class="fragment"></pre></div><p>The source code: </p>
<div class="fragment"><pre class="fragment"><span class="comment">//Compile with:</span>
<span class="comment">// edje_cc signalsBubble.edc &amp;&amp; gcc -o signals2 signals2.c `pkg-config --libs --cflags ecore ecore-evas edje`</span>

<span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<span class="preprocessor"></span><span class="preprocessor">#include &quot;config.h&quot;</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#define PACKAGE_EXAMPLES_DIR &quot;.&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#define EINA_UNUSED</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifndef PACKAGE_DATA_DIR</span>
<span class="preprocessor"></span><span class="preprocessor">#define PACKAGE_DATA_DIR &quot;.&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;Ecore.h&gt;</span>
<span class="preprocessor">#include &lt;Ecore_Evas.h&gt;</span>
<span class="preprocessor">#include &lt;Edje.h&gt;</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>

<span class="preprocessor">#define WIDTH     (700)</span>
<span class="preprocessor"></span><span class="preprocessor">#define HEIGHT    (700)</span>
<span class="preprocessor"></span>
<span class="keyword">static</span> <span class="keywordtype">void</span>
_on_delete(Ecore_Evas *ee EINA_UNUSED)
{
   <a class="code" href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a>();
}

<span class="comment">/* mouse over signals */</span>
<span class="keyword">static</span> <span class="keywordtype">void</span>
_on_mouse_over(<span class="keywordtype">void</span> *data, <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *edje_obj,
               <span class="keyword">const</span> <span class="keywordtype">char</span> *emission EINA_UNUSED, <span class="keyword">const</span> <span class="keywordtype">char</span> *source EINA_UNUSED)
{
   <a class="code" href="group__Evas__Canvas.html#ga5ff87cc4ce6bc43e3b640a6d37f73043">Evas</a> *evas;
   <span class="keywordtype">int</span> x, y, mouseX, mouseY;

   evas = (<a class="code" href="group__Evas__Canvas.html#ga5ff87cc4ce6bc43e3b640a6d37f73043">Evas</a> *) data;
   <a class="code" href="group__Evas__Font__Group.html#ga6f52fab1a96dc58c85ee481d84bac871">evas_object_geometry_get</a>(edje_obj, &amp;x, &amp;y, NULL, NULL);

   <a class="code" href="group__Evas__Canvas.html#ga7fac49dba2d8fef5d8faf0d67548c4fc" title="This function returns the current known pointer coordinates.">evas_pointer_output_xy_get</a>(evas, &amp;mouseX, &amp;mouseY);

   <span class="keywordflow">if</span> ((rand() % 2) == 0)
     x += ((mouseX - x) + (x / 4 + mouseY / 2));
   <span class="keywordflow">else</span>
     x -= ((mouseX - x) + (x / 4 + mouseY / 2));

   <span class="keywordflow">if</span> ((rand() % 2) == 0)
     y += ((mouseY - y) + (y / 4 + mouseX / 2));
   <span class="keywordflow">else</span>
     y -= ((mouseY - y) + (y / 4 + mouseX / 2));

   <span class="keywordflow">if</span> (x &gt; WIDTH)
     x = WIDTH;
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &lt; 0) x = 0;

   <span class="keywordflow">if</span> (y &gt; HEIGHT)
     y = HEIGHT;
   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (y &lt; 0) y = 0;

   fprintf(stdout, <span class="stringliteral">&quot;Moving object to - (%d,%d)\n&quot;</span>, x, y);

   <a class="code" href="group__Evas__Font__Group.html#ga02da8091bbac768b8e86c7b74b2a94f9">evas_object_move</a>(edje_obj, x, y);
}

<span class="keywordtype">int</span>
main(<span class="keywordtype">int</span> argc EINA_UNUSED, <span class="keywordtype">char</span> **argv EINA_UNUSED)
{
   <span class="keyword">const</span> <span class="keywordtype">char</span> *edje_file = PACKAGE_DATA_DIR<span class="stringliteral">&quot;/signalsBubble.edj&quot;</span>;
   Ecore_Evas *ee;
   <a class="code" href="group__Evas__Canvas.html#ga5ff87cc4ce6bc43e3b640a6d37f73043">Evas</a> *evas;
   <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *bg;
   <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *edje_obj;

   <span class="keywordflow">if</span> (!<a class="code" href="group__Ecore__Evas__Group.html#gad36db3002bbf891d28af0d6b22dda1b5" title="Inits the Ecore_Evas system.">ecore_evas_init</a>()) <span class="keywordflow">return</span> EXIT_FAILURE;

   <span class="keywordflow">if</span> (!<a class="code" href="group__Edje__General__Group.html#ga1c9c6594f38023c29fbfb2d0c8c675db" title="Initializes the Edje library.">edje_init</a>()) <span class="keywordflow">goto</span> shutdown_ecore_evas;

   ee = ecore_evas_new(NULL, 0, 0, WIDTH, HEIGHT, NULL);

   <span class="keywordflow">if</span> (!ee) <span class="keywordflow">goto</span> shutdown_edje;

   <a class="code" href="group__Ecore__Evas__Group.html#ga2f3f0d28733a6a6f75066f6f2d96472f" title="Sets a callback for Ecore_Evas delete request events.">ecore_evas_callback_delete_request_set</a>(ee, _on_delete);
   <a class="code" href="group__Ecore__Evas__Group.html#ga09f31ba06a5424c66ee239dd92ff9f6e" title="Sets the title of an Ecore_Evas&#39; window.">ecore_evas_title_set</a>(ee, <span class="stringliteral">&quot;Edje animations and signals&quot;</span>);

   evas = <a class="code" href="group__Ecore__Evas__Group.html#ga21b6108d757f0aea6c4126d59cfb8826" title="Gets an Ecore_Evas&#39;s Evas.">ecore_evas_get</a>(ee);

   bg = <a class="code" href="group__Evas__Object__Rectangle.html#ga4d80fc32ad1cac28428cebd65d746751">evas_object_rectangle_add</a>(evas);
   <a class="code" href="group__Evas__Font__Group.html#gae34bdcfd7f5100151f6ea8ef4a392949">evas_object_color_set</a>(bg, 255, 255, 255, 255); <span class="comment">//White</span>
   <a class="code" href="group__Evas__Font__Group.html#ga02da8091bbac768b8e86c7b74b2a94f9">evas_object_move</a>(bg, 0, 0); <span class="comment">//orign</span>
   <a class="code" href="group__Evas__Font__Group.html#ga21e8604c0e4a93e469bff4bd069e82b5">evas_object_resize</a>(bg, WIDTH, HEIGHT); <span class="comment">//cover the window</span>
   <a class="code" href="group__Evas__Font__Group.html#ga9cbc13661584e49fb9d9cdab514a1eeb">evas_object_show</a>(bg);

   ecore_evas_object_associate(ee, bg, ECORE_EVAS_OBJECT_ASSOCIATE_BASE);
   evas_object_focus_set(bg, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);

   edje_obj = edje_object_add(evas);

   <span class="keywordflow">if</span> (!edje_object_file_set(edje_obj, edje_file, <span class="stringliteral">&quot;image_group&quot;</span>))
     {
        <span class="keywordtype">int</span> err = <a class="code" href="group__Edje__Object.html#ga20a6e01d3a62e04d0d85bd8c673601cf" title="Gets the (last) file loading error for a given Edje object.">edje_object_load_error_get</a>(edje_obj);
        <span class="keyword">const</span> <span class="keywordtype">char</span> *errmsg = <a class="code" href="group__Edje__Object__File.html#ga034465c2de4ab495802da20f332c386e" title="Converts the given Edje file load error code into a string describing it in English.">edje_load_error_str</a>(err);
        fprintf(stderr, <span class="stringliteral">&quot;Could not load the edje file - reason:%s\n&quot;</span>, errmsg);
        <span class="keywordflow">goto</span> shutdown_edje;
     }

   <a class="code" href="group__Edje__Object.html#gad1275e926c53f7af0fdbe2b107c8e9e5" title="Adds a callback for an arriving Edje signal, emitted by a given Edje object.">edje_object_signal_callback_add</a>(edje_obj, <span class="stringliteral">&quot;mouse,move&quot;</span>, <span class="stringliteral">&quot;part_image&quot;</span>,
                                   _on_mouse_over, evas);
   <a class="code" href="group__Evas__Font__Group.html#ga21e8604c0e4a93e469bff4bd069e82b5">evas_object_resize</a>(edje_obj, 63, 63);
   <a class="code" href="group__Evas__Font__Group.html#ga02da8091bbac768b8e86c7b74b2a94f9">evas_object_move</a>(edje_obj, 50, 50);
   <a class="code" href="group__Evas__Font__Group.html#ga9cbc13661584e49fb9d9cdab514a1eeb">evas_object_show</a>(edje_obj);

   <a class="code" href="group__Ecore__Evas__Group.html#gaaea54d6b6ab85ac2f3355052d04e487e" title="Shows an Ecore_Evas&#39; window.">ecore_evas_show</a>(ee);

   <a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();

   <a class="code" href="group__Ecore__Evas__Group.html#ga68f83d423894b2797e8e693376921161" title="Frees an Ecore_Evas.">ecore_evas_free</a>(ee);
   <a class="code" href="group__Edje__General__Group.html#ga01041f6702f2d81bf10c3e41899805cb" title="Shuts down the Edje library.">edje_shutdown</a>();
   <a class="code" href="group__Ecore__Evas__Group.html#gab1a47c09b475148c037c0a3d68644fa4" title="Shuts down the Ecore_Evas system.">ecore_evas_shutdown</a>();

   <span class="keywordflow">return</span> EXIT_SUCCESS;

   shutdown_edje: <a class="code" href="group__Edje__General__Group.html#ga01041f6702f2d81bf10c3e41899805cb" title="Shuts down the Edje library.">edje_shutdown</a>();

   shutdown_ecore_evas: <a class="code" href="group__Ecore__Evas__Group.html#gab1a47c09b475148c037c0a3d68644fa4" title="Shuts down the Ecore_Evas system.">ecore_evas_shutdown</a>();

   <span class="keywordflow">return</span> EXIT_FAILURE;
}
</pre></div><p>To compile use this command: </p>
<div class="fragment"><pre class="fragment">
 * gcc -o signals2 signals2.c -DPACKAGE_BIN_DIR=\"/Where/enlightenment/is/installed/bin\"
 * -DPACKAGE_LIB_DIR=\"/Where/enlightenment/is/installed/lib\"
 * -DPACKAGE_DATA_DIR=\"/Where/enlightenment/is/installed/share\"
 * `pkg-config --cflags --libs evas ecore ecore-evas edje`
 *
 * edje_cc -id /path/to/the/image signalsBubble.edc
 * </pre></div> </div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
