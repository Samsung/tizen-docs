<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: File descriptor data example, with Eet unions and variants</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Tizen Native API"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   &#160;<span id="projectnumber">3.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('Example_Eet_Data_File_Descriptor_02.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">File descriptor data example, with Eet unions and variants </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is an example much like the one shown in <a class="el" href="eet_data_file_descriptor.html">Advanced use of Eet Data Descriptors</a>. The difference is that here we're attaining ourselves to two new data types to store in an Eet file -- <b>unions</b> and <b>variants</b>. We don't try to come with data mapping to real world use cases, here. Instead, we're defining 3 different simple structures to be used throughout the example:  <div class="fragment"><pre class="fragment"><span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Struct1      Example_Struct1;
<span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Struct2      Example_Struct2;
<span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Struct3      Example_Struct3;
<span class="keyword">struct </span>_Example_Struct1
{
   <span class="keywordtype">double</span>      val1;
   <span class="keywordtype">int</span>         stuff;
   <span class="keyword">const</span> <span class="keywordtype">char</span> *s1;
};

<span class="keyword">struct </span>_Example_Struct2
{
   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>          b1;
   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> v1;
};

<span class="keyword">struct </span>_Example_Struct3
{
   <span class="keywordtype">int</span> body;
};
</pre></div></p>
<p>To identify, for both union and variant data cases, the type of each chunk of data, we're defining types to point to each of those structs:  <div class="fragment"><pre class="fragment"><span class="keyword">typedef</span> <span class="keyword">enum</span> _Example_Data_Type      Example_Data_Type;
<span class="keyword">enum</span> _Example_Data_Type
{
   EET_UNKNOWN = 0,
   EET_STRUCT1,
   EET_STRUCT2,
   EET_STRUCT3,
   EET_BASIC_FLOAT,
   EET_BASIC_STRING
};
</pre></div></p>
<p>We have also a mapping from those types to name strings, to be used in the Eet unions and variants <code>type_get()</code> and <code>type_set()</code> type identifying callbacks: <div class="fragment"><pre class="fragment"><span class="keyword">struct</span>
{
   Example_Data_Type u;
   <span class="keyword">const</span> <span class="keywordtype">char</span>       *name;
} eet_mapping[] = {
   { EET_STRUCT1, <span class="stringliteral">&quot;ST1&quot;</span> },
   { EET_STRUCT2, <span class="stringliteral">&quot;ST2&quot;</span> },
   { EET_STRUCT3, <span class="stringliteral">&quot;ST3&quot;</span> },
   { EET_BASIC_FLOAT, <span class="stringliteral">&quot;float&quot;</span> },
   { EET_BASIC_STRING, <span class="stringliteral">&quot;string&quot;</span> },
   { EET_UNKNOWN, NULL }
};
</pre></div></p>
<p>In this example, we have no fancy hash to store our data into profiles/accounts, but just two lists for union and variant data nodes:  <div class="fragment"><pre class="fragment"><span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Lists        Example_Lists;
<span class="keyword">struct </span>_Example_Lists
{
   <a class="code" href="struct__Eina__List.html">Eina_List</a> *union_list;
   <a class="code" href="struct__Eina__List.html">Eina_List</a> *variant_list;
};
</pre></div></p>
<p>Let's begin with our unions, then, which look like:  <div class="fragment"><pre class="fragment"><span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Union        Example_Union;
<span class="keyword">struct </span>_Example_Union
{
   Example_Data_Type type;

   <span class="keyword">union </span>{
      Example_Struct1 st1;
      Example_Struct2 st2;
      Example_Struct3 st3;
      <span class="keywordtype">float</span> f;
      <span class="keyword">const</span> <span class="keywordtype">char</span>* string;
   } u;
};
</pre></div></p>
<p>The first interesting part of the code is where we define our data descriptors for the main lists, the unions and all of structures upon which those two depend.  <div class="fragment"><pre class="fragment"><span class="comment">/* declaring types */</span>
_data_descriptors_init(<span class="keywordtype">void</span>)
{
   <a class="code" href="struct__Eet__Data__Descriptor__Class.html">Eet_Data_Descriptor_Class</a> eddc;

   <a class="code" href="group__Eet__Data__Group.html#ga0bf94c07d8e69cfaac8dd2d615d7542c">EET_EINA_FILE_DATA_DESCRIPTOR_CLASS_SET</a>(&amp;eddc, Example_Lists);
   _lists_descriptor = <a class="code" href="group__Eet__Data__Group.html#ga4fedba15a4c27e7e75db9d92e538321a">eet_data_descriptor_file_new</a>(&amp;eddc);

   _struct_1_descriptor = _st1_dd();
   _struct_2_descriptor = _st2_dd();
   _struct_3_descriptor = _st3_dd();

   <span class="comment">/* for union */</span>
   <a class="code" href="group__Eet__Data__Group.html#ga0bf94c07d8e69cfaac8dd2d615d7542c">EET_EINA_FILE_DATA_DESCRIPTOR_CLASS_SET</a>(&amp;eddc, Example_Union);
   _union_descriptor = <a class="code" href="group__Eet__Data__Group.html#ga4fedba15a4c27e7e75db9d92e538321a">eet_data_descriptor_file_new</a>(&amp;eddc);

   eddc.<a class="code" href="struct__Eet__Data__Descriptor__Class.html#a4e3696014d6907dadd55840bf6008317">version</a> = <a class="code" href="group__Eet__Data__Group.html#ga61a090586eff90415b429f1017acf8a7">EET_DATA_DESCRIPTOR_CLASS_VERSION</a>;
   eddc.func.<a class="code" href="struct__Eet__Data__Descriptor__Class.html#af71fcc4124973c0da6aa0e84dce426cb">type_get</a> = _union_type_get;
   eddc.func.<a class="code" href="struct__Eet__Data__Descriptor__Class.html#a1b6477a2a52b797a662c3fff9793f97e">type_set</a> = _union_type_set;
   _union_unified_descriptor = <a class="code" href="group__Eet__Data__Group.html#ga4fedba15a4c27e7e75db9d92e538321a">eet_data_descriptor_file_new</a>(&amp;eddc);

   <a class="code" href="group__Eet__Data__Group.html#gad0daa543d93a64add80961ae5387d45a" title="Adds a mapping to a data descriptor that will be used by union, variant or inherited type...">EET_DATA_DESCRIPTOR_ADD_MAPPING</a>(
     _union_unified_descriptor, <span class="stringliteral">&quot;ST1&quot;</span>, _struct_1_descriptor);
   <a class="code" href="group__Eet__Data__Group.html#gad0daa543d93a64add80961ae5387d45a" title="Adds a mapping to a data descriptor that will be used by union, variant or inherited type...">EET_DATA_DESCRIPTOR_ADD_MAPPING</a>(
     _union_unified_descriptor, <span class="stringliteral">&quot;ST2&quot;</span>, _struct_2_descriptor);
   <a class="code" href="group__Eet__Data__Group.html#gad0daa543d93a64add80961ae5387d45a" title="Adds a mapping to a data descriptor that will be used by union, variant or inherited type...">EET_DATA_DESCRIPTOR_ADD_MAPPING</a>(
     _union_unified_descriptor, <span class="stringliteral">&quot;ST3&quot;</span>, _struct_3_descriptor);
   <a class="code" href="group__Eet__Data__Group.html#gaaf153807a88cd2c3483c5c34bb920a95" title="Adds a mapping of a basic type to a data descriptor that will be used by a union type.">EET_DATA_DESCRIPTOR_ADD_MAPPING_BASIC</a>(
     _union_unified_descriptor, <span class="stringliteral">&quot;float&quot;</span>, <a class="code" href="group__Eet__Data__Group.html#ga447b1b41e09b24ac6b3fbbac8d3efb30">EET_T_FLOAT</a>);
   <a class="code" href="group__Eet__Data__Group.html#gaaf153807a88cd2c3483c5c34bb920a95" title="Adds a mapping of a basic type to a data descriptor that will be used by a union type.">EET_DATA_DESCRIPTOR_ADD_MAPPING_BASIC</a>(
     _union_unified_descriptor, <span class="stringliteral">&quot;string&quot;</span>, <a class="code" href="group__Eet__Data__Group.html#ga0d2cf409bf3f151156d74d18ac59e3d1">EET_T_STRING</a>);

   <a class="code" href="group__Eet__Data__Group.html#ga07b711dca3d4bcaa0ccb8ced48341b90" title="Adds an union type to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_UNION</a>(
     _union_descriptor, Example_Union, <span class="stringliteral">&quot;u&quot;</span>, u, type,
     _union_unified_descriptor);

   <a class="code" href="group__Eet__Data__Group.html#gabb4c7833ba053f2322e6b667a9ec7f04" title="Adds a linked list type to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_LIST</a>(
     _lists_descriptor, Example_Lists, <span class="stringliteral">&quot;union_list&quot;</span>, union_list,
     _union_descriptor);
</pre></div> The code for descriptors on <code>Example_Struct1</code>, <code>Example_Struct2</code> and <code>Example_Struct3</code> is straightforward, a matter already covered on <a class="el" href="eet_data_file_descriptor.html">Advanced use of Eet Data Descriptors</a>. What is new, here, are the two type matching functions for our unions. There, we must set the <code>data</code> pointer to its matching type, on <code>_union_type_set</code> and return the correct matching type, on <code>_union_type_get:</code>  <div class="fragment"><pre class="fragment"></pre></div></p>
<p>With the <a class="el" href="group__Eet__Data__Group.html#gad0daa543d93a64add80961ae5387d45a" title="Adds a mapping to a data descriptor that will be used by union, variant or inherited type...">EET_DATA_DESCRIPTOR_ADD_MAPPING</a> calls, which follow, we make the the link between our type names and their respective structs. The code handling actual data is pretty much the same as in <a class="el" href="eet_data_file_descriptor.html">Advanced use of Eet Data Descriptors</a> -- one uses command line arguments to enter new data chunks (or just to visualize the contents of an Eet file), signalling if they are unions or variants. One must also pass the type of the data chuck to enter, with integers 1, 2 or 3. Then, come the fields for each type:  <div class="fragment"><pre class="fragment">                <span class="stringliteral">&quot;Usage:\n\t%s &lt;input&gt; &lt;output&gt; [action action-params]\n\n&quot;</span>
                <span class="stringliteral">&quot;where actions and their parameters are:\n&quot;</span>
                <span class="stringliteral">&quot;\tunion &lt;type&gt; [fields]\n&quot;</span>
                <span class="stringliteral">&quot;\tvariant &lt;type&gt; [fields]\n&quot;</span>
                <span class="stringliteral">&quot;\n&quot;</span>,
                argv[0]);
</pre></div></p>
<p>Variants are very similar to unions, except that data chunks need <b>not</b> contain previously allocated space for each of the possible types of data going in them:  <div class="fragment"><pre class="fragment"><span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Variant_Type Example_Variant_Type;
<span class="keyword">struct </span>_Example_Variant_Type
{
   <span class="keyword">const</span> <span class="keywordtype">char</span> *type;
   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>   unknow : 1;
};

<span class="keyword">struct </span>_Example_Variant
{
   Example_Variant_Type t;

   <span class="keywordtype">void</span>                *data; <span class="comment">/* differently than the union type, we</span>
<span class="comment">                               * don&#39;t need to pre-allocate the memory</span>
<span class="comment">                               * for the field*/</span>
};
</pre></div></p>
<p>The code declaring the data descriptors and handling the data is very similar to the unions part, and is left for the reader to check for him/herself. The complete code of the example follows.</p>
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//Compile with:</span>
<a name="l00002"></a>00002 <span class="comment">// gcc -o eet-data-file_descriptor_02 eet-data-file_descriptor_02.c `pkg-config --cflags --libs eet eina`</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;Eina.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;Eet.h&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;limits.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="keyword">typedef</span> <span class="keyword">enum</span> _Example_Data_Type      Example_Data_Type;
<a name="l00013"></a>00013 <span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Variant_Type Example_Variant_Type;
<a name="l00014"></a>00014 <span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Variant      Example_Variant;
<a name="l00015"></a>00015 <span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Union        Example_Union;
<a name="l00016"></a>00016 <span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Struct1      Example_Struct1;
<a name="l00017"></a>00017 <span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Struct2      Example_Struct2;
<a name="l00018"></a>00018 <span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Struct3      Example_Struct3;
<a name="l00019"></a>00019 <span class="keyword">typedef</span> <span class="keyword">struct </span>_Example_Lists        Example_Lists;
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="keyword">enum</span> _Example_Data_Type
<a name="l00022"></a>00022 {
<a name="l00023"></a>00023    EET_UNKNOWN = 0,
<a name="l00024"></a>00024    EET_STRUCT1,
<a name="l00025"></a>00025    EET_STRUCT2,
<a name="l00026"></a>00026    EET_STRUCT3,
<a name="l00027"></a>00027    EET_BASIC_FLOAT,
<a name="l00028"></a>00028    EET_BASIC_STRING
<a name="l00029"></a>00029 };
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="keyword">struct</span>
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033    Example_Data_Type u;
<a name="l00034"></a>00034    <span class="keyword">const</span> <span class="keywordtype">char</span>       *name;
<a name="l00035"></a>00035 } eet_mapping[] = {
<a name="l00036"></a>00036    { EET_STRUCT1, <span class="stringliteral">&quot;ST1&quot;</span> },
<a name="l00037"></a>00037    { EET_STRUCT2, <span class="stringliteral">&quot;ST2&quot;</span> },
<a name="l00038"></a>00038    { EET_STRUCT3, <span class="stringliteral">&quot;ST3&quot;</span> },
<a name="l00039"></a>00039    { EET_BASIC_FLOAT, <span class="stringliteral">&quot;float&quot;</span> },
<a name="l00040"></a>00040    { EET_BASIC_STRING, <span class="stringliteral">&quot;string&quot;</span> },
<a name="l00041"></a>00041    { EET_UNKNOWN, NULL }
<a name="l00042"></a>00042 };
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="keyword">struct </span>_Example_Struct1
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046    <span class="keywordtype">double</span>      val1;
<a name="l00047"></a>00047    <span class="keywordtype">int</span>         stuff;
<a name="l00048"></a>00048    <span class="keyword">const</span> <span class="keywordtype">char</span> *s1;
<a name="l00049"></a>00049 };
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="keyword">struct </span>_Example_Struct2
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053    <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>          b1;
<a name="l00054"></a>00054    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> v1;
<a name="l00055"></a>00055 };
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="keyword">struct </span>_Example_Struct3
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059    <span class="keywordtype">int</span> body;
<a name="l00060"></a>00060 };
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="keyword">struct </span>_Example_Union
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064    Example_Data_Type type;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066    <span class="keyword">union </span>{
<a name="l00067"></a>00067       Example_Struct1 st1;
<a name="l00068"></a>00068       Example_Struct2 st2;
<a name="l00069"></a>00069       Example_Struct3 st3;
<a name="l00070"></a>00070       <span class="keywordtype">float</span> f;
<a name="l00071"></a>00071       <span class="keyword">const</span> <span class="keywordtype">char</span>* string;
<a name="l00072"></a>00072    } u;
<a name="l00073"></a>00073 };
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="keyword">struct </span>_Example_Variant_Type
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077    <span class="keyword">const</span> <span class="keywordtype">char</span> *type;
<a name="l00078"></a>00078    <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>   unknow : 1;
<a name="l00079"></a>00079 };
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="keyword">struct </span>_Example_Variant
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083    Example_Variant_Type t;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085    <span class="keywordtype">void</span>                *data; <span class="comment">/* differently than the union type, we</span>
<a name="l00086"></a>00086 <span class="comment">                               * don&#39;t need to pre-allocate the memory</span>
<a name="l00087"></a>00087 <span class="comment">                               * for the field*/</span>
<a name="l00088"></a>00088 };
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="keyword">struct </span>_Example_Lists
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092    <a class="code" href="struct__Eina__List.html">Eina_List</a> *union_list;
<a name="l00093"></a>00093    <a class="code" href="struct__Eina__List.html">Eina_List</a> *variant_list;
<a name="l00094"></a>00094 };
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00097"></a>00097 _st1_set(Example_Struct1 *st1,
<a name="l00098"></a>00098          <span class="keywordtype">double</span>           v1,
<a name="l00099"></a>00099          <span class="keywordtype">int</span>              v2,
<a name="l00100"></a>00100          <span class="keyword">const</span> <span class="keywordtype">char</span>      *v3)
<a name="l00101"></a>00101 {
<a name="l00102"></a>00102    st1-&gt;val1 = v1;
<a name="l00103"></a>00103    st1-&gt;stuff = v2;
<a name="l00104"></a>00104    st1-&gt;s1 = v3;
<a name="l00105"></a>00105 } <span class="comment">/* _st1_set */</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00108"></a>00108 _st2_set(Example_Struct2   *st2,
<a name="l00109"></a>00109          <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>          v1,
<a name="l00110"></a>00110          <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> v2)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112    st2-&gt;b1 = v1;
<a name="l00113"></a>00113    st2-&gt;v1 = v2;
<a name="l00114"></a>00114 } <span class="comment">/* _st2_set */</span>
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00117"></a>00117 _st3_set(Example_Struct3 *st3,
<a name="l00118"></a>00118          <span class="keywordtype">int</span>              v1)
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120    st3-&gt;body = v1;
<a name="l00121"></a>00121 } <span class="comment">/* _st3_set */</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00124"></a>00124 <span class="comment">/* union</span>
<a name="l00125"></a>00125 <span class="comment">   type_get() */</span>
<a name="l00126"></a>00126 _union_type_get(<span class="keyword">const</span> <span class="keywordtype">void</span> *data,
<a name="l00127"></a>00127                 <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>  *unknow)
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129    <span class="keyword">const</span> Example_Data_Type *u = data;
<a name="l00130"></a>00130    <span class="keywordtype">int</span> i;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132    <span class="keywordflow">if</span> (unknow)
<a name="l00133"></a>00133      *unknow = <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135    <span class="keywordflow">for</span> (i = 0; eet_mapping[i].name != NULL; ++i)
<a name="l00136"></a>00136      <span class="keywordflow">if</span> (*u == eet_mapping[i].u)
<a name="l00137"></a>00137        <span class="keywordflow">return</span> eet_mapping[i].name;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139    <span class="keywordflow">if</span> (unknow)
<a name="l00140"></a>00140      *unknow = <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142    <span class="keywordflow">return</span> NULL;
<a name="l00143"></a>00143 } <span class="comment">/* _union_type_get */</span>
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>
<a name="l00146"></a>00146 _union_type_set(<span class="keyword">const</span> <span class="keywordtype">char</span> *type,
<a name="l00147"></a>00147                 <span class="keywordtype">void</span>       *data,
<a name="l00148"></a>00148                 <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>   unknow)
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150    Example_Data_Type *u = data;
<a name="l00151"></a>00151    <span class="keywordtype">int</span> i;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153    <span class="keywordflow">if</span> (unknow)
<a name="l00154"></a>00154      <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156    <span class="keywordflow">for</span> (i = 0; eet_mapping[i].name != NULL; ++i)
<a name="l00157"></a>00157      <span class="keywordflow">if</span> (strcmp(eet_mapping[i].name, type) == 0)
<a name="l00158"></a>00158        {
<a name="l00159"></a>00159           *u = eet_mapping[i].u;
<a name="l00160"></a>00160           <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;
<a name="l00161"></a>00161        }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163    <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;
<a name="l00164"></a>00164 } <span class="comment">/* _union_type_set */</span>
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00167"></a>00167 _variant_type_get(<span class="keyword">const</span> <span class="keywordtype">void</span> *data,
<a name="l00168"></a>00168                   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>  *unknow)
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170    <span class="keyword">const</span> Example_Variant_Type *type = data;
<a name="l00171"></a>00171    <span class="keywordtype">int</span> i;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173    <span class="keywordflow">if</span> (unknow)
<a name="l00174"></a>00174      *unknow = type-&gt;unknow;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176    <span class="keywordflow">for</span> (i = 0; eet_mapping[i].name != NULL; ++i)
<a name="l00177"></a>00177      <span class="keywordflow">if</span> (strcmp(type-&gt;type, eet_mapping[i].name) == 0)
<a name="l00178"></a>00178        <span class="keywordflow">return</span> eet_mapping[i].name;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180    <span class="keywordflow">if</span> (unknow)
<a name="l00181"></a>00181      *unknow = <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183    <span class="keywordflow">return</span> type-&gt;type;
<a name="l00184"></a>00184 } <span class="comment">/* _variant_type_get */</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>
<a name="l00187"></a>00187 _variant_type_set(<span class="keyword">const</span> <span class="keywordtype">char</span> *type,
<a name="l00188"></a>00188                   <span class="keywordtype">void</span>       *data,
<a name="l00189"></a>00189                   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>   unknow)
<a name="l00190"></a>00190 {
<a name="l00191"></a>00191    Example_Variant_Type *vt = data;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193    vt-&gt;type = type;
<a name="l00194"></a>00194    vt-&gt;unknow = unknow;
<a name="l00195"></a>00195    <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;
<a name="l00196"></a>00196 } <span class="comment">/* _variant_type_set */</span>
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *
<a name="l00199"></a>00199 _st1_dd(<span class="keywordtype">void</span>)
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201    <a class="code" href="struct__Eet__Data__Descriptor__Class.html">Eet_Data_Descriptor_Class</a> eddc;
<a name="l00202"></a>00202    <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *res;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204    <a class="code" href="group__Eet__Data__Group.html#ga0bf94c07d8e69cfaac8dd2d615d7542c">EET_EINA_FILE_DATA_DESCRIPTOR_CLASS_SET</a>(&amp;eddc, Example_Struct1);
<a name="l00205"></a>00205    res = <a class="code" href="group__Eet__Data__Group.html#ga4fedba15a4c27e7e75db9d92e538321a">eet_data_descriptor_file_new</a>(&amp;eddc);
<a name="l00206"></a>00206    <a class="code" href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a" title="Adds a basic data element to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_BASIC</a>(
<a name="l00207"></a>00207      res, Example_Struct1, <span class="stringliteral">&quot;val1&quot;</span>, val1, <a class="code" href="group__Eet__Data__Group.html#gac2d8336b1127fd382c65416cf45cd3e8">EET_T_DOUBLE</a>);
<a name="l00208"></a>00208    <a class="code" href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a" title="Adds a basic data element to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_BASIC</a>(
<a name="l00209"></a>00209      res, Example_Struct1, <span class="stringliteral">&quot;stuff&quot;</span>, stuff, <a class="code" href="group__Eet__Data__Group.html#ga4e196733795867f14c6e387af7287baa">EET_T_INT</a>);
<a name="l00210"></a>00210    <a class="code" href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a" title="Adds a basic data element to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_BASIC</a>(
<a name="l00211"></a>00211      res, Example_Struct1, <span class="stringliteral">&quot;s1&quot;</span>, s1, <a class="code" href="group__Eet__Data__Group.html#ga0d2cf409bf3f151156d74d18ac59e3d1">EET_T_STRING</a>);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213    <span class="keywordflow">return</span> res;
<a name="l00214"></a>00214 } <span class="comment">/* _st1_dd */</span>
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *
<a name="l00217"></a>00217 _st2_dd(<span class="keywordtype">void</span>)
<a name="l00218"></a>00218 {
<a name="l00219"></a>00219    <a class="code" href="struct__Eet__Data__Descriptor__Class.html">Eet_Data_Descriptor_Class</a> eddc;
<a name="l00220"></a>00220    <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *res;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222    <a class="code" href="group__Eet__Data__Group.html#ga0bf94c07d8e69cfaac8dd2d615d7542c">EET_EINA_FILE_DATA_DESCRIPTOR_CLASS_SET</a>(&amp;eddc, Example_Struct2);
<a name="l00223"></a>00223    res = <a class="code" href="group__Eet__Data__Group.html#ga4fedba15a4c27e7e75db9d92e538321a">eet_data_descriptor_file_new</a>(&amp;eddc);
<a name="l00224"></a>00224    <a class="code" href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a" title="Adds a basic data element to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_BASIC</a>(
<a name="l00225"></a>00225      res, Example_Struct2, <span class="stringliteral">&quot;b1&quot;</span>, b1, <a class="code" href="group__Eet__Data__Group.html#ga09a1341cc158fda0ba60ad2386ecd795">EET_T_UCHAR</a>);
<a name="l00226"></a>00226    <a class="code" href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a" title="Adds a basic data element to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_BASIC</a>(
<a name="l00227"></a>00227      res, Example_Struct2, <span class="stringliteral">&quot;v1&quot;</span>, v1, <a class="code" href="group__Eet__Data__Group.html#gac984c4b3f0ad353a14679cf39a70ebd7">EET_T_ULONG_LONG</a>);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229    <span class="keywordflow">return</span> res;
<a name="l00230"></a>00230 } <span class="comment">/* _st2_dd */</span>
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *
<a name="l00233"></a>00233 _st3_dd(<span class="keywordtype">void</span>)
<a name="l00234"></a>00234 {
<a name="l00235"></a>00235    <a class="code" href="struct__Eet__Data__Descriptor__Class.html">Eet_Data_Descriptor_Class</a> eddc;
<a name="l00236"></a>00236    <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *res;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238    <a class="code" href="group__Eet__Data__Group.html#ga0bf94c07d8e69cfaac8dd2d615d7542c">EET_EINA_FILE_DATA_DESCRIPTOR_CLASS_SET</a>(&amp;eddc, Example_Struct3);
<a name="l00239"></a>00239    res = <a class="code" href="group__Eet__Data__Group.html#ga4fedba15a4c27e7e75db9d92e538321a">eet_data_descriptor_file_new</a>(&amp;eddc);
<a name="l00240"></a>00240    <a class="code" href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a" title="Adds a basic data element to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_BASIC</a>(
<a name="l00241"></a>00241      res, Example_Struct3, <span class="stringliteral">&quot;body&quot;</span>, body, <a class="code" href="group__Eet__Data__Group.html#ga4e196733795867f14c6e387af7287baa">EET_T_INT</a>);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243    <span class="keywordflow">return</span> res;
<a name="l00244"></a>00244 } <span class="comment">/* _st3_dd */</span>
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="comment">/* string that represents the entry in the eet file. you might like to</span>
<a name="l00247"></a>00247 <span class="comment"> * have different profiles or so in the same file, this is possible</span>
<a name="l00248"></a>00248 <span class="comment"> * with different strings</span>
<a name="l00249"></a>00249 <span class="comment"> */</span>
<a name="l00250"></a>00250 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> CACHE_FILE_ENTRY[] = <span class="stringliteral">&quot;cache&quot;</span>;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="comment">/* keep the descriptor static global, so it can be shared by different</span>
<a name="l00253"></a>00253 <span class="comment"> * functions (load/save) of this and only this file.</span>
<a name="l00254"></a>00254 <span class="comment"> */</span>
<a name="l00255"></a>00255 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *_lists_descriptor;
<a name="l00256"></a>00256 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *_struct_1_descriptor;
<a name="l00257"></a>00257 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *_struct_2_descriptor;
<a name="l00258"></a>00258 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *_struct_3_descriptor;
<a name="l00259"></a>00259 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *_union_descriptor;
<a name="l00260"></a>00260 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *_variant_descriptor;
<a name="l00261"></a>00261 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *_union_unified_descriptor;
<a name="l00262"></a>00262 <span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *_variant_unified_descriptor;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <span class="comment">/* keep file handle alive, so mmap()ed strings are all alive as</span>
<a name="l00265"></a>00265 <span class="comment"> * well */</span>
<a name="l00266"></a>00266 <span class="keyword">static</span> <a class="code" href="group__Eet__File__Group.html#ga8d9779184a9870c1a225f1f40c76e8a7">Eet_File</a> *_cache_file = NULL;
<a name="l00267"></a>00267 <span class="keyword">static</span> <a class="code" href="group__Eet__File__Group.html#gaf0984c8280699ca5a3c4966f5580324c">Eet_Dictionary</a> *_cache_dict = NULL;
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00270"></a>00270 <span class="comment">/* declaring types */</span>
<a name="l00271"></a>00271 _data_descriptors_init(<span class="keywordtype">void</span>)
<a name="l00272"></a>00272 {
<a name="l00273"></a>00273    <a class="code" href="struct__Eet__Data__Descriptor__Class.html">Eet_Data_Descriptor_Class</a> eddc;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275    <a class="code" href="group__Eet__Data__Group.html#ga0bf94c07d8e69cfaac8dd2d615d7542c">EET_EINA_FILE_DATA_DESCRIPTOR_CLASS_SET</a>(&amp;eddc, Example_Lists);
<a name="l00276"></a>00276    _lists_descriptor = <a class="code" href="group__Eet__Data__Group.html#ga4fedba15a4c27e7e75db9d92e538321a">eet_data_descriptor_file_new</a>(&amp;eddc);
<a name="l00277"></a>00277 
<a name="l00278"></a>00278    _struct_1_descriptor = _st1_dd();
<a name="l00279"></a>00279    _struct_2_descriptor = _st2_dd();
<a name="l00280"></a>00280    _struct_3_descriptor = _st3_dd();
<a name="l00281"></a>00281 
<a name="l00282"></a>00282    <span class="comment">/* for union */</span>
<a name="l00283"></a>00283    <a class="code" href="group__Eet__Data__Group.html#ga0bf94c07d8e69cfaac8dd2d615d7542c">EET_EINA_FILE_DATA_DESCRIPTOR_CLASS_SET</a>(&amp;eddc, Example_Union);
<a name="l00284"></a>00284    _union_descriptor = <a class="code" href="group__Eet__Data__Group.html#ga4fedba15a4c27e7e75db9d92e538321a">eet_data_descriptor_file_new</a>(&amp;eddc);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286    eddc.<a class="code" href="struct__Eet__Data__Descriptor__Class.html#a4e3696014d6907dadd55840bf6008317">version</a> = <a class="code" href="group__Eet__Data__Group.html#ga61a090586eff90415b429f1017acf8a7">EET_DATA_DESCRIPTOR_CLASS_VERSION</a>;
<a name="l00287"></a>00287    eddc.func.<a class="code" href="struct__Eet__Data__Descriptor__Class.html#af71fcc4124973c0da6aa0e84dce426cb">type_get</a> = _union_type_get;
<a name="l00288"></a>00288    eddc.func.<a class="code" href="struct__Eet__Data__Descriptor__Class.html#a1b6477a2a52b797a662c3fff9793f97e">type_set</a> = _union_type_set;
<a name="l00289"></a>00289    _union_unified_descriptor = <a class="code" href="group__Eet__Data__Group.html#ga4fedba15a4c27e7e75db9d92e538321a">eet_data_descriptor_file_new</a>(&amp;eddc);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291    <a class="code" href="group__Eet__Data__Group.html#gad0daa543d93a64add80961ae5387d45a" title="Adds a mapping to a data descriptor that will be used by union, variant or inherited type...">EET_DATA_DESCRIPTOR_ADD_MAPPING</a>(
<a name="l00292"></a>00292      _union_unified_descriptor, <span class="stringliteral">&quot;ST1&quot;</span>, _struct_1_descriptor);
<a name="l00293"></a>00293    <a class="code" href="group__Eet__Data__Group.html#gad0daa543d93a64add80961ae5387d45a" title="Adds a mapping to a data descriptor that will be used by union, variant or inherited type...">EET_DATA_DESCRIPTOR_ADD_MAPPING</a>(
<a name="l00294"></a>00294      _union_unified_descriptor, <span class="stringliteral">&quot;ST2&quot;</span>, _struct_2_descriptor);
<a name="l00295"></a>00295    <a class="code" href="group__Eet__Data__Group.html#gad0daa543d93a64add80961ae5387d45a" title="Adds a mapping to a data descriptor that will be used by union, variant or inherited type...">EET_DATA_DESCRIPTOR_ADD_MAPPING</a>(
<a name="l00296"></a>00296      _union_unified_descriptor, <span class="stringliteral">&quot;ST3&quot;</span>, _struct_3_descriptor);
<a name="l00297"></a>00297    <a class="code" href="group__Eet__Data__Group.html#gaaf153807a88cd2c3483c5c34bb920a95" title="Adds a mapping of a basic type to a data descriptor that will be used by a union type.">EET_DATA_DESCRIPTOR_ADD_MAPPING_BASIC</a>(
<a name="l00298"></a>00298      _union_unified_descriptor, <span class="stringliteral">&quot;float&quot;</span>, <a class="code" href="group__Eet__Data__Group.html#ga447b1b41e09b24ac6b3fbbac8d3efb30">EET_T_FLOAT</a>);
<a name="l00299"></a>00299    <a class="code" href="group__Eet__Data__Group.html#gaaf153807a88cd2c3483c5c34bb920a95" title="Adds a mapping of a basic type to a data descriptor that will be used by a union type.">EET_DATA_DESCRIPTOR_ADD_MAPPING_BASIC</a>(
<a name="l00300"></a>00300      _union_unified_descriptor, <span class="stringliteral">&quot;string&quot;</span>, <a class="code" href="group__Eet__Data__Group.html#ga0d2cf409bf3f151156d74d18ac59e3d1">EET_T_STRING</a>);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302    <a class="code" href="group__Eet__Data__Group.html#ga07b711dca3d4bcaa0ccb8ced48341b90" title="Adds an union type to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_UNION</a>(
<a name="l00303"></a>00303      _union_descriptor, Example_Union, <span class="stringliteral">&quot;u&quot;</span>, u, type,
<a name="l00304"></a>00304      _union_unified_descriptor);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306    <a class="code" href="group__Eet__Data__Group.html#gabb4c7833ba053f2322e6b667a9ec7f04" title="Adds a linked list type to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_LIST</a>(
<a name="l00307"></a>00307      _lists_descriptor, Example_Lists, <span class="stringliteral">&quot;union_list&quot;</span>, union_list,
<a name="l00308"></a>00308      _union_descriptor);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310    <span class="comment">/* for variant */</span>
<a name="l00311"></a>00311    <a class="code" href="group__Eet__Data__Group.html#ga0bf94c07d8e69cfaac8dd2d615d7542c">EET_EINA_FILE_DATA_DESCRIPTOR_CLASS_SET</a>(&amp;eddc, Example_Variant);
<a name="l00312"></a>00312    _variant_descriptor = <a class="code" href="group__Eet__Data__Group.html#ga4fedba15a4c27e7e75db9d92e538321a">eet_data_descriptor_file_new</a>(&amp;eddc);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314    eddc.<a class="code" href="struct__Eet__Data__Descriptor__Class.html#a4e3696014d6907dadd55840bf6008317">version</a> = <a class="code" href="group__Eet__Data__Group.html#ga61a090586eff90415b429f1017acf8a7">EET_DATA_DESCRIPTOR_CLASS_VERSION</a>;
<a name="l00315"></a>00315    eddc.func.<a class="code" href="struct__Eet__Data__Descriptor__Class.html#af71fcc4124973c0da6aa0e84dce426cb">type_get</a> = _variant_type_get;
<a name="l00316"></a>00316    eddc.func.<a class="code" href="struct__Eet__Data__Descriptor__Class.html#a1b6477a2a52b797a662c3fff9793f97e">type_set</a> = _variant_type_set;
<a name="l00317"></a>00317    _variant_unified_descriptor = <a class="code" href="group__Eet__Data__Group.html#gaea8c28de4b6c0a8c8f09dfe521b42a00">eet_data_descriptor_stream_new</a>(&amp;eddc);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319    <a class="code" href="group__Eet__Data__Group.html#gad0daa543d93a64add80961ae5387d45a" title="Adds a mapping to a data descriptor that will be used by union, variant or inherited type...">EET_DATA_DESCRIPTOR_ADD_MAPPING</a>(
<a name="l00320"></a>00320      _variant_unified_descriptor, <span class="stringliteral">&quot;ST1&quot;</span>, _struct_1_descriptor);
<a name="l00321"></a>00321    <a class="code" href="group__Eet__Data__Group.html#gad0daa543d93a64add80961ae5387d45a" title="Adds a mapping to a data descriptor that will be used by union, variant or inherited type...">EET_DATA_DESCRIPTOR_ADD_MAPPING</a>(
<a name="l00322"></a>00322      _variant_unified_descriptor, <span class="stringliteral">&quot;ST2&quot;</span>, _struct_2_descriptor);
<a name="l00323"></a>00323    <a class="code" href="group__Eet__Data__Group.html#gad0daa543d93a64add80961ae5387d45a" title="Adds a mapping to a data descriptor that will be used by union, variant or inherited type...">EET_DATA_DESCRIPTOR_ADD_MAPPING</a>(
<a name="l00324"></a>00324      _variant_unified_descriptor, <span class="stringliteral">&quot;ST3&quot;</span>, _struct_3_descriptor);
<a name="l00325"></a>00325 
<a name="l00326"></a>00326    <a class="code" href="group__Eet__Data__Group.html#ga8851a40b130061262a8dd009f0457a65" title="Adds a automatically selectable type to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_VARIANT</a>(
<a name="l00327"></a>00327      _variant_descriptor, Example_Variant, <span class="stringliteral">&quot;data&quot;</span>, data, t,
<a name="l00328"></a>00328      _variant_unified_descriptor);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330    <a class="code" href="group__Eet__Data__Group.html#gabb4c7833ba053f2322e6b667a9ec7f04" title="Adds a linked list type to a data descriptor.">EET_DATA_DESCRIPTOR_ADD_LIST</a>(
<a name="l00331"></a>00331      _lists_descriptor, Example_Lists, <span class="stringliteral">&quot;variant_list&quot;</span>, variant_list,
<a name="l00332"></a>00332      _variant_descriptor);
<a name="l00333"></a>00333 } <span class="comment">/* _data_descriptors_init */</span>
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00336"></a>00336 _data_descriptors_shutdown(<span class="keywordtype">void</span>)
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338    <a class="code" href="group__Eet__Data__Group.html#ga4d0a7a4f47e8393f75b8446e7d056eac" title="This function frees a data descriptor when it is not needed anymore.">eet_data_descriptor_free</a>(_lists_descriptor);
<a name="l00339"></a>00339    <a class="code" href="group__Eet__Data__Group.html#ga4d0a7a4f47e8393f75b8446e7d056eac" title="This function frees a data descriptor when it is not needed anymore.">eet_data_descriptor_free</a>(_struct_1_descriptor);
<a name="l00340"></a>00340    <a class="code" href="group__Eet__Data__Group.html#ga4d0a7a4f47e8393f75b8446e7d056eac" title="This function frees a data descriptor when it is not needed anymore.">eet_data_descriptor_free</a>(_struct_2_descriptor);
<a name="l00341"></a>00341    <a class="code" href="group__Eet__Data__Group.html#ga4d0a7a4f47e8393f75b8446e7d056eac" title="This function frees a data descriptor when it is not needed anymore.">eet_data_descriptor_free</a>(_struct_3_descriptor);
<a name="l00342"></a>00342    <a class="code" href="group__Eet__Data__Group.html#ga4d0a7a4f47e8393f75b8446e7d056eac" title="This function frees a data descriptor when it is not needed anymore.">eet_data_descriptor_free</a>(_union_descriptor);
<a name="l00343"></a>00343    <a class="code" href="group__Eet__Data__Group.html#ga4d0a7a4f47e8393f75b8446e7d056eac" title="This function frees a data descriptor when it is not needed anymore.">eet_data_descriptor_free</a>(_variant_descriptor);
<a name="l00344"></a>00344    <a class="code" href="group__Eet__Data__Group.html#ga4d0a7a4f47e8393f75b8446e7d056eac" title="This function frees a data descriptor when it is not needed anymore.">eet_data_descriptor_free</a>(_union_unified_descriptor);
<a name="l00345"></a>00345    <a class="code" href="group__Eet__Data__Group.html#ga4d0a7a4f47e8393f75b8446e7d056eac" title="This function frees a data descriptor when it is not needed anymore.">eet_data_descriptor_free</a>(_variant_unified_descriptor);
<a name="l00346"></a>00346 } <span class="comment">/* _data_descriptors_shutdown */</span>
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 <span class="comment">/* need to check if the pointer came from mmap()ed area in</span>
<a name="l00349"></a>00349 <span class="comment"> * eet_dictionary or it was allocated with eina_stringshare_add()</span>
<a name="l00350"></a>00350 <span class="comment"> */</span>
<a name="l00351"></a>00351 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00352"></a>00352 _string_free(<span class="keyword">const</span> <span class="keywordtype">char</span> *str)
<a name="l00353"></a>00353 {
<a name="l00354"></a>00354    <span class="keywordflow">if</span> (!str)
<a name="l00355"></a>00355      <span class="keywordflow">return</span>;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357    <span class="keywordflow">if</span> ((_cache_dict) &amp;&amp; (<a class="code" href="group__Eet__File__Group.html#gaafc8deb871cabb7dcdeb086d29c500ca" title="Checks if a given string comes from a given dictionary.">eet_dictionary_string_check</a>(_cache_dict, str)))
<a name="l00358"></a>00358      <span class="keywordflow">return</span>;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360    <a class="code" href="group__Eina__Stringshare__Group.html#ga495411b0bc85b9c0d59ec7255a025260" title="Notes that the given string has lost an instance.">eina_stringshare_del</a>(str);
<a name="l00361"></a>00361 } <span class="comment">/* _string_free */</span>
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 <span class="keyword">static</span> Example_Union *
<a name="l00364"></a>00364 _union_1_new(<span class="keyword">const</span> <span class="keywordtype">char</span> *v1,
<a name="l00365"></a>00365              <span class="keyword">const</span> <span class="keywordtype">char</span> *v2,
<a name="l00366"></a>00366              <span class="keyword">const</span> <span class="keywordtype">char</span> *v3)
<a name="l00367"></a>00367 {
<a name="l00368"></a>00368    Example_Union *un = calloc(1, <span class="keyword">sizeof</span>(Example_Union));
<a name="l00369"></a>00369    <span class="keywordflow">if</span> (!un)
<a name="l00370"></a>00370      {
<a name="l00371"></a>00371         fprintf(
<a name="l00372"></a>00372           stderr, <span class="stringliteral">&quot;ERROR: could not allocate an Example_Union struct.\n&quot;</span>);
<a name="l00373"></a>00373         <span class="keywordflow">return</span> NULL;
<a name="l00374"></a>00374      }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376    un-&gt;type = EET_STRUCT1;
<a name="l00377"></a>00377    _st1_set(&amp;(un-&gt;u.st1), atof(v1), atoi(v2), <a class="code" href="group__Eina__Stringshare__Group.html#ga5293082680141132ffcacc28866ef0ef" title="Retrieves an instance of a string for use in a program.">eina_stringshare_add</a>(v3));
<a name="l00378"></a>00378 
<a name="l00379"></a>00379    <span class="keywordflow">return</span> un;
<a name="l00380"></a>00380 }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="keyword">static</span> Example_Union *
<a name="l00383"></a>00383 _union_2_new(<span class="keyword">const</span> <span class="keywordtype">char</span> *v1,
<a name="l00384"></a>00384              <span class="keyword">const</span> <span class="keywordtype">char</span> *v2)
<a name="l00385"></a>00385 {
<a name="l00386"></a>00386    Example_Union *un = calloc(1, <span class="keyword">sizeof</span>(Example_Union));
<a name="l00387"></a>00387    <span class="keywordflow">if</span> (!un)
<a name="l00388"></a>00388      {
<a name="l00389"></a>00389         fprintf(
<a name="l00390"></a>00390           stderr, <span class="stringliteral">&quot;ERROR: could not allocate an Example_Union struct.\n&quot;</span>);
<a name="l00391"></a>00391         <span class="keywordflow">return</span> NULL;
<a name="l00392"></a>00392      }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394    un-&gt;type = EET_STRUCT2;
<a name="l00395"></a>00395    _st2_set(&amp;(un-&gt;u.st2), atoi(v1), atoi(v2));
<a name="l00396"></a>00396 
<a name="l00397"></a>00397    <span class="keywordflow">return</span> un;
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="keyword">static</span> Example_Union *
<a name="l00401"></a>00401 _union_3_new(<span class="keyword">const</span> <span class="keywordtype">char</span> *v1)
<a name="l00402"></a>00402 {
<a name="l00403"></a>00403    Example_Union *un = calloc(1, <span class="keyword">sizeof</span>(Example_Union));
<a name="l00404"></a>00404    <span class="keywordflow">if</span> (!un)
<a name="l00405"></a>00405      {
<a name="l00406"></a>00406         fprintf(
<a name="l00407"></a>00407           stderr, <span class="stringliteral">&quot;ERROR: could not allocate an Example_Union struct.\n&quot;</span>);
<a name="l00408"></a>00408         <span class="keywordflow">return</span> NULL;
<a name="l00409"></a>00409      }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411    un-&gt;type = EET_STRUCT3;
<a name="l00412"></a>00412    _st3_set(&amp;(un-&gt;u.st3), atoi(v1));
<a name="l00413"></a>00413 
<a name="l00414"></a>00414    <span class="keywordflow">return</span> un;
<a name="l00415"></a>00415 }
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="keyword">static</span> Example_Union *
<a name="l00418"></a>00418 _union_float_new(<span class="keyword">const</span> <span class="keywordtype">char</span> *v1)
<a name="l00419"></a>00419 {
<a name="l00420"></a>00420    Example_Union *un = calloc(1, <span class="keyword">sizeof</span>(Example_Union));
<a name="l00421"></a>00421    <span class="keywordflow">if</span> (!un)
<a name="l00422"></a>00422      {
<a name="l00423"></a>00423         fprintf(
<a name="l00424"></a>00424           stderr, <span class="stringliteral">&quot;ERROR: could not allocate an Example_Union struct.\n&quot;</span>);
<a name="l00425"></a>00425         <span class="keywordflow">return</span> NULL;
<a name="l00426"></a>00426      }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428    un-&gt;type = EET_BASIC_FLOAT;
<a name="l00429"></a>00429    un-&gt;u.f = atof(v1);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431    <span class="keywordflow">return</span> un;
<a name="l00432"></a>00432 }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 <span class="keyword">static</span> Example_Union *
<a name="l00435"></a>00435 _union_string_new(<span class="keyword">const</span> <span class="keywordtype">char</span> *v1)
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437    Example_Union *un = calloc(1, <span class="keyword">sizeof</span>(Example_Union));
<a name="l00438"></a>00438    <span class="keywordflow">if</span> (!un)
<a name="l00439"></a>00439      {
<a name="l00440"></a>00440         fprintf(
<a name="l00441"></a>00441           stderr, <span class="stringliteral">&quot;ERROR: could not allocate an Example_Union struct.\n&quot;</span>);
<a name="l00442"></a>00442         <span class="keywordflow">return</span> NULL;
<a name="l00443"></a>00443      }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445    un-&gt;type = EET_BASIC_STRING;
<a name="l00446"></a>00446    un-&gt;u.string = v1;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448    <span class="keywordflow">return</span> un;
<a name="l00449"></a>00449 }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451 <span class="keyword">static</span> Example_Variant *
<a name="l00452"></a>00452 _variant_1_new(<span class="keyword">const</span> <span class="keywordtype">char</span> *v1,
<a name="l00453"></a>00453                <span class="keyword">const</span> <span class="keywordtype">char</span> *v2,
<a name="l00454"></a>00454                <span class="keyword">const</span> <span class="keywordtype">char</span> *v3)
<a name="l00455"></a>00455 {
<a name="l00456"></a>00456    Example_Struct1 *st1;
<a name="l00457"></a>00457    Example_Variant *va = calloc(1, <span class="keyword">sizeof</span>(Example_Variant));
<a name="l00458"></a>00458    <span class="keywordflow">if</span> (!va)
<a name="l00459"></a>00459      {
<a name="l00460"></a>00460         fprintf(
<a name="l00461"></a>00461           stderr, <span class="stringliteral">&quot;ERROR: could not allocate an Example_Variant struct.\n&quot;</span>);
<a name="l00462"></a>00462         <span class="keywordflow">return</span> NULL;
<a name="l00463"></a>00463      }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465    va-&gt;t.type = eet_mapping[0].name;
<a name="l00466"></a>00466    st1 = calloc(1, <span class="keyword">sizeof</span> (Example_Struct1));
<a name="l00467"></a>00467    _st1_set(st1, atof(v1), atoi(v2), <a class="code" href="group__Eina__Stringshare__Group.html#ga5293082680141132ffcacc28866ef0ef" title="Retrieves an instance of a string for use in a program.">eina_stringshare_add</a>(v3));
<a name="l00468"></a>00468    va-&gt;data = st1;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470    <span class="keywordflow">return</span> va;
<a name="l00471"></a>00471 }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473 <span class="keyword">static</span> Example_Variant *
<a name="l00474"></a>00474 _variant_2_new(<span class="keyword">const</span> <span class="keywordtype">char</span> *v1,
<a name="l00475"></a>00475                <span class="keyword">const</span> <span class="keywordtype">char</span> *v2)
<a name="l00476"></a>00476 {
<a name="l00477"></a>00477    printf(<span class="stringliteral">&quot;varinant 2 new\n&quot;</span>);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479    Example_Struct2 *st2;
<a name="l00480"></a>00480    Example_Variant *va = calloc(1, <span class="keyword">sizeof</span>(Example_Variant));
<a name="l00481"></a>00481    <span class="keywordflow">if</span> (!va)
<a name="l00482"></a>00482      {
<a name="l00483"></a>00483         fprintf(
<a name="l00484"></a>00484           stderr, <span class="stringliteral">&quot;ERROR: could not allocate an Example_Variant struct.\n&quot;</span>);
<a name="l00485"></a>00485         <span class="keywordflow">return</span> NULL;
<a name="l00486"></a>00486      }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488    va-&gt;t.type = eet_mapping[1].name;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490    printf(<span class="stringliteral">&quot;type gets %s\n&quot;</span>, va-&gt;t.type);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492    st2 = calloc(1, <span class="keyword">sizeof</span> (Example_Struct2));
<a name="l00493"></a>00493    _st2_set(st2, atoi(v1), atoi(v2));
<a name="l00494"></a>00494    va-&gt;data = st2;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496    <span class="keywordflow">return</span> va;
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 <span class="keyword">static</span> Example_Variant *
<a name="l00500"></a>00500 _variant_3_new(<span class="keyword">const</span> <span class="keywordtype">char</span> *v1)
<a name="l00501"></a>00501 {
<a name="l00502"></a>00502    Example_Struct3 *st3;
<a name="l00503"></a>00503    Example_Variant *va = calloc(1, <span class="keyword">sizeof</span>(Example_Variant));
<a name="l00504"></a>00504    <span class="keywordflow">if</span> (!va)
<a name="l00505"></a>00505      {
<a name="l00506"></a>00506         fprintf(
<a name="l00507"></a>00507           stderr, <span class="stringliteral">&quot;ERROR: could not allocate an Example_Variant struct.\n&quot;</span>);
<a name="l00508"></a>00508         <span class="keywordflow">return</span> NULL;
<a name="l00509"></a>00509      }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511    va-&gt;t.type = eet_mapping[2].name;
<a name="l00512"></a>00512    st3 = calloc(1, <span class="keyword">sizeof</span> (Example_Struct3));
<a name="l00513"></a>00513    _st3_set(st3, atoi(v1));
<a name="l00514"></a>00514    va-&gt;data = st3;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516    <span class="keywordflow">return</span> va;
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="keyword">static</span> Example_Lists *
<a name="l00520"></a>00520 _data_new(<span class="keywordtype">void</span>)
<a name="l00521"></a>00521 {
<a name="l00522"></a>00522    Example_Lists *example_lists = calloc(1, <span class="keyword">sizeof</span>(Example_Lists));
<a name="l00523"></a>00523    <span class="keywordflow">if</span> (!example_lists)
<a name="l00524"></a>00524      {
<a name="l00525"></a>00525         fprintf(stderr, <span class="stringliteral">&quot;ERROR: could not allocate a Example_Lists struct.\n&quot;</span>);
<a name="l00526"></a>00526         <span class="keywordflow">return</span> NULL;
<a name="l00527"></a>00527      }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529    <span class="keywordflow">return</span> example_lists;
<a name="l00530"></a>00530 } <span class="comment">/* _data_new */</span>
<a name="l00531"></a>00531 
<a name="l00532"></a>00532 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00533"></a>00533 _union_free(Example_Union *un)
<a name="l00534"></a>00534 {
<a name="l00535"></a>00535    <span class="keywordflow">if</span> (un-&gt;type == EET_STRUCT1)
<a name="l00536"></a>00536      {
<a name="l00537"></a>00537         Example_Struct1 *st1 = &amp;(un-&gt;u.st1);
<a name="l00538"></a>00538         _string_free(st1-&gt;s1);
<a name="l00539"></a>00539      }
<a name="l00540"></a>00540 
<a name="l00541"></a>00541    free(un);
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00545"></a>00545 _variant_free(Example_Variant *va)
<a name="l00546"></a>00546 {
<a name="l00547"></a>00547    <span class="keywordflow">if</span> (!strcmp(va-&gt;t.type, eet_mapping[0].name))
<a name="l00548"></a>00548      {
<a name="l00549"></a>00549         Example_Struct1 *st1 = va-&gt;data;
<a name="l00550"></a>00550         _string_free(st1-&gt;s1);
<a name="l00551"></a>00551      }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553    free(va-&gt;data);
<a name="l00554"></a>00554    free(va);
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00558"></a>00558 _data_free(Example_Lists *cache)
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560    Example_Union *un;
<a name="l00561"></a>00561    Example_Variant *va;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563    <a class="code" href="group__Eina__List__Group.html#gae27a2c686a0a11693f9b06957c9bba83" title="Definition for the macro to remove each list node while having access to each node&#39;s data...">EINA_LIST_FREE</a>(cache-&gt;union_list, un)
<a name="l00564"></a>00564      _union_free(un);
<a name="l00565"></a>00565 
<a name="l00566"></a>00566    <a class="code" href="group__Eina__List__Group.html#gae27a2c686a0a11693f9b06957c9bba83" title="Definition for the macro to remove each list node while having access to each node&#39;s data...">EINA_LIST_FREE</a>(cache-&gt;variant_list, va)
<a name="l00567"></a>00567      _variant_free(va);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569    free(cache);
<a name="l00570"></a>00570 } <span class="comment">/* _data_free */</span>
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 static Example_Lists *
<a name="l00573"></a>00573 _data_load(const <span class="keywordtype">char</span> *filename)
<a name="l00574"></a>00574 {
<a name="l00575"></a>00575    Example_Lists *data;
<a name="l00576"></a>00576    <a class="code" href="group__Eet__File__Group.html#ga8d9779184a9870c1a225f1f40c76e8a7">Eet_File</a> *ef = <a class="code" href="group__Eet__File__Group.html#ga1714f8176dde78e274b3fc042912e382" title="Opens an eet file on disk, and returns a handle to it.">eet_open</a>(filename, <a class="code" href="group__Eet__File__Group.html#ggaa8e1a7af50fefaf15eb2f69543d24998a416f7e9a76b8131a44bbeedb13060c81">EET_FILE_MODE_READ</a>);
<a name="l00577"></a>00577    <span class="keywordflow">if</span> (!ef)
<a name="l00578"></a>00578      {
<a name="l00579"></a>00579         fprintf(stderr, <span class="stringliteral">&quot;ERROR: could not open &#39;%s&#39; for read\n&quot;</span>, filename);
<a name="l00580"></a>00580         <span class="keywordflow">return</span> NULL;
<a name="l00581"></a>00581      }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583    data = <a class="code" href="group__Eet__Data__Group.html#ga5fb943bf3b2ba6c901dfce189a82d9fc" title="Reads a data structure from an eet file and decodes it.">eet_data_read</a>(ef, _lists_descriptor, CACHE_FILE_ENTRY);
<a name="l00584"></a>00584    <span class="keywordflow">if</span> (!data)
<a name="l00585"></a>00585      {
<a name="l00586"></a>00586         <a class="code" href="group__Eet__File__Group.html#ga905997371fed881b82b2b00a19cce398" title="Closes an eet file handle and flush pending writes.">eet_close</a>(ef);
<a name="l00587"></a>00587         <span class="keywordflow">return</span> NULL;
<a name="l00588"></a>00588      }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590    <span class="keywordflow">if</span> (_cache_file)
<a name="l00591"></a>00591      <a class="code" href="group__Eet__File__Group.html#ga905997371fed881b82b2b00a19cce398" title="Closes an eet file handle and flush pending writes.">eet_close</a>(_cache_file);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593    _cache_file = ef;
<a name="l00594"></a>00594    _cache_dict = <a class="code" href="group__Eet__File__Group.html#ga822a20881a50aa320d0d455160998183" title="Returns a handle to the shared string dictionary of the Eet file.">eet_dictionary_get</a>(ef);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596    <span class="keywordflow">return</span> data;
<a name="l00597"></a>00597 } <span class="comment">/* _data_load */</span>
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 <span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>
<a name="l00600"></a>00600 _data_save(<span class="keyword">const</span> Example_Lists *cache,
<a name="l00601"></a>00601            <span class="keyword">const</span> <span class="keywordtype">char</span>          *filename)
<a name="l00602"></a>00602 {
<a name="l00603"></a>00603    <span class="keywordtype">char</span> tmp[PATH_MAX];
<a name="l00604"></a>00604    <a class="code" href="group__Eet__File__Group.html#ga8d9779184a9870c1a225f1f40c76e8a7">Eet_File</a> *ef;
<a name="l00605"></a>00605    <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a> ret;
<a name="l00606"></a>00606    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, len;
<a name="l00607"></a>00607    <span class="keyword">struct </span>stat st;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609    len = <a class="code" href="group__Eina__String__Group.html#ga73466cfd3c7d64608d77706e4bc43e25" title="Copies a c-string to another.">eina_strlcpy</a>(tmp, filename, <span class="keyword">sizeof</span>(tmp));
<a name="l00610"></a>00610    <span class="keywordflow">if</span> (len + 12 &gt;= (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(tmp))
<a name="l00611"></a>00611      {
<a name="l00612"></a>00612         fprintf(stderr, <span class="stringliteral">&quot;ERROR: file name is too big: %s\n&quot;</span>, filename);
<a name="l00613"></a>00613         <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;
<a name="l00614"></a>00614      }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616    i = 0;
<a name="l00617"></a>00617    <span class="keywordflow">do</span>
<a name="l00618"></a>00618      {
<a name="l00619"></a>00619         snprintf(tmp + len, 12, <span class="stringliteral">&quot;.%u&quot;</span>, i);
<a name="l00620"></a>00620         i++;
<a name="l00621"></a>00621      }
<a name="l00622"></a>00622    <span class="keywordflow">while</span> (stat(tmp, &amp;st) == 0);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624    ef = <a class="code" href="group__Eet__File__Group.html#ga1714f8176dde78e274b3fc042912e382" title="Opens an eet file on disk, and returns a handle to it.">eet_open</a>(tmp, <a class="code" href="group__Eet__File__Group.html#ggaa8e1a7af50fefaf15eb2f69543d24998a8f395f56fba48be007c65be51d799ee9">EET_FILE_MODE_WRITE</a>);
<a name="l00625"></a>00625    <span class="keywordflow">if</span> (!ef)
<a name="l00626"></a>00626      {
<a name="l00627"></a>00627         fprintf(stderr, <span class="stringliteral">&quot;ERROR: could not open &#39;%s&#39; for write\n&quot;</span>, tmp);
<a name="l00628"></a>00628         <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;
<a name="l00629"></a>00629      }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631    ret = <a class="code" href="group__Eet__Data__Group.html#gaac41f6875bcb226c917102ae35eb8c93" title="Writes a data structure from memory and store in an eet file.">eet_data_write</a>
<a name="l00632"></a>00632        (ef, _lists_descriptor, CACHE_FILE_ENTRY, cache, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);
<a name="l00633"></a>00633 
<a name="l00634"></a>00634    <a class="code" href="group__Eet__File__Group.html#ga905997371fed881b82b2b00a19cce398" title="Closes an eet file handle and flush pending writes.">eet_close</a>(ef);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636    <span class="keywordflow">if</span> (ret)
<a name="l00637"></a>00637      {
<a name="l00638"></a>00638         unlink(filename);
<a name="l00639"></a>00639         rename(tmp, filename);
<a name="l00640"></a>00640      }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642    <span class="keywordflow">return</span> ret;
<a name="l00643"></a>00643 } <span class="comment">/* _data_save */</span>
<a name="l00644"></a>00644 
<a name="l00645"></a>00645 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00646"></a>00646 _print_union(<span class="keyword">const</span> Example_Union *un)
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648    printf(<span class="stringliteral">&quot;\t  |   type: %s&#39;\n&quot;</span>, eet_mapping[un-&gt;type - 1].name);
<a name="l00649"></a>00649 
<a name="l00650"></a>00650    <span class="keywordflow">switch</span> (un-&gt;type)
<a name="l00651"></a>00651      {
<a name="l00652"></a>00652       <span class="keywordflow">case</span> EET_STRUCT1:
<a name="l00653"></a>00653         printf(<span class="stringliteral">&quot;\t\t  val1: %f\n&quot;</span>, un-&gt;u.st1.val1);
<a name="l00654"></a>00654         printf(<span class="stringliteral">&quot;\t\t  stuff: %d\n&quot;</span>, un-&gt;u.st1.stuff);
<a name="l00655"></a>00655         printf(<span class="stringliteral">&quot;\t\t  s1: %s\n&quot;</span>, un-&gt;u.st1.s1);
<a name="l00656"></a>00656         <span class="keywordflow">break</span>;
<a name="l00657"></a>00657 
<a name="l00658"></a>00658       <span class="keywordflow">case</span> EET_STRUCT2:
<a name="l00659"></a>00659         printf(<span class="stringliteral">&quot;\t\t  val1: %i\n&quot;</span>, un-&gt;u.st2.b1);
<a name="l00660"></a>00660         printf(<span class="stringliteral">&quot;\t\t  stuff: %lli\n&quot;</span>, un-&gt;u.st2.v1);
<a name="l00661"></a>00661         <span class="keywordflow">break</span>;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663       <span class="keywordflow">case</span> EET_STRUCT3:
<a name="l00664"></a>00664         printf(<span class="stringliteral">&quot;\t\t  val1: %i\n&quot;</span>, un-&gt;u.st3.body);
<a name="l00665"></a>00665         <span class="keywordflow">break</span>;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667       <span class="keywordflow">case</span> EET_BASIC_FLOAT:
<a name="l00668"></a>00668         printf(<span class="stringliteral">&quot;\t\t  float: %f\n&quot;</span>, un-&gt;u.f);
<a name="l00669"></a>00669         <span class="keywordflow">break</span>;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671       <span class="keywordflow">case</span> EET_BASIC_STRING:
<a name="l00672"></a>00672         printf(<span class="stringliteral">&quot;\t\t  string: %s\n&quot;</span>, un-&gt;u.string);
<a name="l00673"></a>00673         <span class="keywordflow">break</span>;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675       <span class="keywordflow">default</span>:
<a name="l00676"></a>00676         <span class="keywordflow">return</span>;
<a name="l00677"></a>00677      }
<a name="l00678"></a>00678 }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00681"></a>00681 _print_variant(<span class="keyword">const</span> Example_Variant *va)
<a name="l00682"></a>00682 {
<a name="l00683"></a>00683    printf(<span class="stringliteral">&quot;\t  |   type: %s&#39;\n&quot;</span>, va-&gt;t.type);
<a name="l00684"></a>00684 
<a name="l00685"></a>00685    <span class="keywordflow">switch</span> (va-&gt;t.type[2])
<a name="l00686"></a>00686      {
<a name="l00687"></a>00687       <span class="keywordflow">case</span> <span class="charliteral">&#39;1&#39;</span>:
<a name="l00688"></a>00688       {
<a name="l00689"></a>00689          Example_Struct1 *st1 = va-&gt;data;
<a name="l00690"></a>00690 
<a name="l00691"></a>00691          printf(<span class="stringliteral">&quot;\t\t  val1: %f\n&quot;</span>, st1-&gt;val1);
<a name="l00692"></a>00692          printf(<span class="stringliteral">&quot;\t\t  stuff: %d\n&quot;</span>, st1-&gt;stuff);
<a name="l00693"></a>00693          printf(<span class="stringliteral">&quot;\t\t  s1: %s\n&quot;</span>, st1-&gt;s1);
<a name="l00694"></a>00694       }
<a name="l00695"></a>00695       <span class="keywordflow">break</span>;
<a name="l00696"></a>00696 
<a name="l00697"></a>00697       <span class="keywordflow">case</span> <span class="charliteral">&#39;2&#39;</span>:
<a name="l00698"></a>00698       {
<a name="l00699"></a>00699          Example_Struct2 *st2 = va-&gt;data;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701          printf(<span class="stringliteral">&quot;\t\t  val1: %i\n&quot;</span>, st2-&gt;b1);
<a name="l00702"></a>00702          printf(<span class="stringliteral">&quot;\t\t  stuff: %lli\n&quot;</span>, st2-&gt;v1);
<a name="l00703"></a>00703       }
<a name="l00704"></a>00704       <span class="keywordflow">break</span>;
<a name="l00705"></a>00705 
<a name="l00706"></a>00706       <span class="keywordflow">case</span> <span class="charliteral">&#39;3&#39;</span>:
<a name="l00707"></a>00707       {
<a name="l00708"></a>00708          Example_Struct3 *st3 = va-&gt;data;
<a name="l00709"></a>00709 
<a name="l00710"></a>00710          printf(<span class="stringliteral">&quot;\t\t  val1: %i\n&quot;</span>, st3-&gt;body);
<a name="l00711"></a>00711       }
<a name="l00712"></a>00712       <span class="keywordflow">break</span>;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714       <span class="keywordflow">default</span>:
<a name="l00715"></a>00715         <span class="keywordflow">return</span>;
<a name="l00716"></a>00716      }
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 <span class="keywordtype">int</span>
<a name="l00720"></a>00720 main(<span class="keywordtype">int</span>   argc,
<a name="l00721"></a>00721      <span class="keywordtype">char</span> *argv[])
<a name="l00722"></a>00722 {
<a name="l00723"></a>00723    Example_Lists *data_lists;
<a name="l00724"></a>00724    <span class="keywordtype">int</span> ret = 0;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726    <span class="keywordflow">if</span> (argc &lt; 3)
<a name="l00727"></a>00727      {
<a name="l00728"></a>00728         fprintf(stderr,
<a name="l00729"></a>00729                 <span class="stringliteral">&quot;Usage:\n\t%s &lt;input&gt; &lt;output&gt; [action action-params]\n\n&quot;</span>
<a name="l00730"></a>00730                 <span class="stringliteral">&quot;where actions and their parameters are:\n&quot;</span>
<a name="l00731"></a>00731                 <span class="stringliteral">&quot;\tunion &lt;type&gt; [fields]\n&quot;</span>
<a name="l00732"></a>00732                 <span class="stringliteral">&quot;\tvariant &lt;type&gt; [fields]\n&quot;</span>
<a name="l00733"></a>00733                 <span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00734"></a>00734                 argv[0]);
<a name="l00735"></a>00735         <span class="keywordflow">return</span> -1;
<a name="l00736"></a>00736      }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738    <a class="code" href="group__Eina__Main__Group.html#gafee4bfc0e509b6ffed6598edf6f4b3de" title="Initializes the Eina library.">eina_init</a>();
<a name="l00739"></a>00739    <a class="code" href="group__Eet__Group.html#gab802df0fd9c53dafbc486242be5bfb69" title="Initializes the EET library.">eet_init</a>();
<a name="l00740"></a>00740    _data_descriptors_init();
<a name="l00741"></a>00741 
<a name="l00742"></a>00742    data_lists = _data_load(argv[1]);
<a name="l00743"></a>00743    <span class="keywordflow">if</span> (!data_lists)
<a name="l00744"></a>00744      {
<a name="l00745"></a>00745         printf(<span class="stringliteral">&quot;Creating new data lists.\n&quot;</span>);
<a name="l00746"></a>00746         data_lists = _data_new();
<a name="l00747"></a>00747         <span class="keywordflow">if</span> (!data_lists)
<a name="l00748"></a>00748           {
<a name="l00749"></a>00749              ret = -2;
<a name="l00750"></a>00750              <span class="keywordflow">goto</span> end;
<a name="l00751"></a>00751           }
<a name="l00752"></a>00752      }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754    <span class="keywordflow">if</span> (argc &gt; 3)
<a name="l00755"></a>00755      {
<a name="l00756"></a>00756         <span class="keywordflow">if</span> (strcmp(argv[3], <span class="stringliteral">&quot;union&quot;</span>) == 0)
<a name="l00757"></a>00757           {
<a name="l00758"></a>00758              <span class="keywordflow">if</span> (argc &gt; 4)
<a name="l00759"></a>00759                {
<a name="l00760"></a>00760                   <span class="keywordtype">int</span> type = atoi(argv[4]);
<a name="l00761"></a>00761                   Example_Union *un;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763                   <span class="keywordflow">if</span> (type &lt; EET_STRUCT1 || type &gt; EET_BASIC_STRING)
<a name="l00764"></a>00764                     {
<a name="l00765"></a>00765                        fprintf(stderr,
<a name="l00766"></a>00766                                <span class="stringliteral">&quot;ERROR: invalid type parameter (%s).\n&quot;</span>,
<a name="l00767"></a>00767                                argv[4]);
<a name="l00768"></a>00768                        <span class="keywordflow">goto</span> cont;
<a name="l00769"></a>00769                     }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771                   <span class="keywordflow">switch</span> (type)
<a name="l00772"></a>00772                     {
<a name="l00773"></a>00773                      <span class="keywordflow">case</span> 1:
<a name="l00774"></a>00774                        <span class="keywordflow">if</span> (argc != 8)
<a name="l00775"></a>00775                          {
<a name="l00776"></a>00776                             fprintf(
<a name="l00777"></a>00777                               stderr, <span class="stringliteral">&quot;ERROR: wrong number of parameters&quot;</span>
<a name="l00778"></a>00778                                       <span class="stringliteral">&quot; (%d).\n&quot;</span>, argc);
<a name="l00779"></a>00779                             <span class="keywordflow">goto</span> cont;
<a name="l00780"></a>00780                          }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782                        un = _union_1_new(
<a name="l00783"></a>00783                            argv[5], argv[6], argv[7]);
<a name="l00784"></a>00784                        <span class="keywordflow">if</span> (!un)
<a name="l00785"></a>00785                          {
<a name="l00786"></a>00786                             fprintf(
<a name="l00787"></a>00787                               stderr, <span class="stringliteral">&quot;ERROR: could not create the &quot;</span>
<a name="l00788"></a>00788                                       <span class="stringliteral">&quot;requested union.\n&quot;</span>);
<a name="l00789"></a>00789                             <span class="keywordflow">goto</span> cont;
<a name="l00790"></a>00790                          }
<a name="l00791"></a>00791                        data_lists-&gt;union_list =
<a name="l00792"></a>00792                          <a class="code" href="group__Eina__List__Group.html#ga92ec14d1a1040a361c4d8cd0ab7b0ecc" title="Appends the given data to the given linked list.">eina_list_append</a>(data_lists-&gt;union_list, un);
<a name="l00793"></a>00793                        <span class="keywordflow">break</span>;
<a name="l00794"></a>00794 
<a name="l00795"></a>00795                      <span class="keywordflow">case</span> 2:
<a name="l00796"></a>00796                        <span class="keywordflow">if</span> (argc != 7)
<a name="l00797"></a>00797                          {
<a name="l00798"></a>00798                             fprintf(
<a name="l00799"></a>00799                               stderr, <span class="stringliteral">&quot;ERROR: wrong number of parameters&quot;</span>
<a name="l00800"></a>00800                                       <span class="stringliteral">&quot; (%d).\n&quot;</span>, argc);
<a name="l00801"></a>00801                             <span class="keywordflow">goto</span> cont;
<a name="l00802"></a>00802                          }
<a name="l00803"></a>00803 
<a name="l00804"></a>00804                        un = _union_2_new(argv[5], argv[6]);
<a name="l00805"></a>00805                        <span class="keywordflow">if</span> (!un)
<a name="l00806"></a>00806                          {
<a name="l00807"></a>00807                             fprintf(
<a name="l00808"></a>00808                               stderr, <span class="stringliteral">&quot;ERROR: could not create the &quot;</span>
<a name="l00809"></a>00809                                       <span class="stringliteral">&quot;requested union.\n&quot;</span>);
<a name="l00810"></a>00810                             <span class="keywordflow">goto</span> cont;
<a name="l00811"></a>00811                          }
<a name="l00812"></a>00812                        data_lists-&gt;union_list =
<a name="l00813"></a>00813                          <a class="code" href="group__Eina__List__Group.html#ga92ec14d1a1040a361c4d8cd0ab7b0ecc" title="Appends the given data to the given linked list.">eina_list_append</a>(data_lists-&gt;union_list, un);
<a name="l00814"></a>00814                        <span class="keywordflow">break</span>;
<a name="l00815"></a>00815 
<a name="l00816"></a>00816                      <span class="keywordflow">case</span> 3:
<a name="l00817"></a>00817                        <span class="keywordflow">if</span> (argc != 6)
<a name="l00818"></a>00818                          {
<a name="l00819"></a>00819                             fprintf(
<a name="l00820"></a>00820                               stderr, <span class="stringliteral">&quot;ERROR: wrong number of parameters&quot;</span>
<a name="l00821"></a>00821                                       <span class="stringliteral">&quot; (%d).\n&quot;</span>, argc);
<a name="l00822"></a>00822                             <span class="keywordflow">goto</span> cont;
<a name="l00823"></a>00823                          }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825                        un = _union_3_new(argv[5]);
<a name="l00826"></a>00826                        <span class="keywordflow">if</span> (!un)
<a name="l00827"></a>00827                          {
<a name="l00828"></a>00828                             fprintf(
<a name="l00829"></a>00829                               stderr, <span class="stringliteral">&quot;ERROR: could not create the &quot;</span>
<a name="l00830"></a>00830                                       <span class="stringliteral">&quot;requested union.\n&quot;</span>);
<a name="l00831"></a>00831                             <span class="keywordflow">goto</span> cont;
<a name="l00832"></a>00832                          }
<a name="l00833"></a>00833                        data_lists-&gt;union_list =
<a name="l00834"></a>00834                          <a class="code" href="group__Eina__List__Group.html#ga92ec14d1a1040a361c4d8cd0ab7b0ecc" title="Appends the given data to the given linked list.">eina_list_append</a>(data_lists-&gt;union_list, un);
<a name="l00835"></a>00835                        <span class="keywordflow">break</span>;
<a name="l00836"></a>00836 
<a name="l00837"></a>00837                      <span class="keywordflow">case</span> EET_BASIC_FLOAT:
<a name="l00838"></a>00838                        <span class="keywordflow">if</span> (argc != 6)
<a name="l00839"></a>00839                          {
<a name="l00840"></a>00840                             fprintf(
<a name="l00841"></a>00841                               stderr, <span class="stringliteral">&quot;ERROR: wrong number of parameters&quot;</span>
<a name="l00842"></a>00842                                       <span class="stringliteral">&quot; (%d).\n&quot;</span>, argc);
<a name="l00843"></a>00843                             <span class="keywordflow">goto</span> cont;
<a name="l00844"></a>00844                          }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846                        un = _union_float_new(argv[5]);
<a name="l00847"></a>00847                        <span class="keywordflow">if</span> (!un)
<a name="l00848"></a>00848                          {
<a name="l00849"></a>00849                             fprintf(
<a name="l00850"></a>00850                               stderr, <span class="stringliteral">&quot;ERROR: could not create the &quot;</span>
<a name="l00851"></a>00851                                       <span class="stringliteral">&quot;requested union.\n&quot;</span>);
<a name="l00852"></a>00852                             <span class="keywordflow">goto</span> cont;
<a name="l00853"></a>00853                          }
<a name="l00854"></a>00854                        data_lists-&gt;union_list =
<a name="l00855"></a>00855                          <a class="code" href="group__Eina__List__Group.html#ga92ec14d1a1040a361c4d8cd0ab7b0ecc" title="Appends the given data to the given linked list.">eina_list_append</a>(data_lists-&gt;union_list, un);
<a name="l00856"></a>00856                        <span class="keywordflow">break</span>;
<a name="l00857"></a>00857 
<a name="l00858"></a>00858                      <span class="keywordflow">case</span> EET_BASIC_STRING:
<a name="l00859"></a>00859                        <span class="keywordflow">if</span> (argc != 6)
<a name="l00860"></a>00860                          {
<a name="l00861"></a>00861                             fprintf(
<a name="l00862"></a>00862                               stderr, <span class="stringliteral">&quot;ERROR: wrong number of parameters&quot;</span>
<a name="l00863"></a>00863                                       <span class="stringliteral">&quot; (%d).\n&quot;</span>, argc);
<a name="l00864"></a>00864                             <span class="keywordflow">goto</span> cont;
<a name="l00865"></a>00865                          }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867                        un = _union_string_new(argv[5]);
<a name="l00868"></a>00868                        <span class="keywordflow">if</span> (!un)
<a name="l00869"></a>00869                          {
<a name="l00870"></a>00870                             fprintf(
<a name="l00871"></a>00871                               stderr, <span class="stringliteral">&quot;ERROR: could not create the &quot;</span>
<a name="l00872"></a>00872                                       <span class="stringliteral">&quot;requested union.\n&quot;</span>);
<a name="l00873"></a>00873                             <span class="keywordflow">goto</span> cont;
<a name="l00874"></a>00874                          }
<a name="l00875"></a>00875                        data_lists-&gt;union_list =
<a name="l00876"></a>00876                          <a class="code" href="group__Eina__List__Group.html#ga92ec14d1a1040a361c4d8cd0ab7b0ecc" title="Appends the given data to the given linked list.">eina_list_append</a>(data_lists-&gt;union_list, un);
<a name="l00877"></a>00877                        <span class="keywordflow">break</span>;
<a name="l00878"></a>00878 
<a name="l00879"></a>00879                      <span class="keywordflow">default</span>:
<a name="l00880"></a>00880                        fprintf(
<a name="l00881"></a>00881                          stderr, <span class="stringliteral">&quot;ERROR: bad type of of struct passed\n&quot;</span>);
<a name="l00882"></a>00882                        <span class="keywordflow">goto</span> cont;
<a name="l00883"></a>00883                     }
<a name="l00884"></a>00884                }
<a name="l00885"></a>00885              <span class="keywordflow">else</span>
<a name="l00886"></a>00886                fprintf(stderr,
<a name="l00887"></a>00887                        <span class="stringliteral">&quot;ERROR: wrong number of parameters (%d).\n&quot;</span>,
<a name="l00888"></a>00888                        argc);
<a name="l00889"></a>00889           }
<a name="l00890"></a>00890         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[3], <span class="stringliteral">&quot;variant&quot;</span>) == 0)
<a name="l00891"></a>00891           {
<a name="l00892"></a>00892              <span class="keywordflow">if</span> (argc &gt; 4)
<a name="l00893"></a>00893                {
<a name="l00894"></a>00894                   <span class="keywordtype">int</span> type = atoi(argv[4]);
<a name="l00895"></a>00895                   Example_Variant *va;
<a name="l00896"></a>00896 
<a name="l00897"></a>00897                   <span class="keywordflow">if</span> (type &lt; EET_STRUCT1 || type &gt; EET_STRUCT3)
<a name="l00898"></a>00898                     {
<a name="l00899"></a>00899                        fprintf(stderr,
<a name="l00900"></a>00900                                <span class="stringliteral">&quot;ERROR: invalid type parameter (%s).\n&quot;</span>,
<a name="l00901"></a>00901                                argv[4]);
<a name="l00902"></a>00902                        <span class="keywordflow">goto</span> cont;
<a name="l00903"></a>00903                     }
<a name="l00904"></a>00904 
<a name="l00905"></a>00905                   <span class="keywordflow">switch</span> (type)
<a name="l00906"></a>00906                     {
<a name="l00907"></a>00907                      <span class="keywordflow">case</span> 1:
<a name="l00908"></a>00908                        <span class="keywordflow">if</span> (argc != 8)
<a name="l00909"></a>00909                          {
<a name="l00910"></a>00910                             fprintf(
<a name="l00911"></a>00911                               stderr, <span class="stringliteral">&quot;ERROR: wrong number of parameters&quot;</span>
<a name="l00912"></a>00912                                       <span class="stringliteral">&quot; (%d).\n&quot;</span>, argc);
<a name="l00913"></a>00913                             <span class="keywordflow">goto</span> cont;
<a name="l00914"></a>00914                          }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916                        va = _variant_1_new(
<a name="l00917"></a>00917                            argv[5], argv[6], argv[7]);
<a name="l00918"></a>00918                        <span class="keywordflow">if</span> (!va)
<a name="l00919"></a>00919                          {
<a name="l00920"></a>00920                             fprintf(
<a name="l00921"></a>00921                               stderr, <span class="stringliteral">&quot;ERROR: could not create the &quot;</span>
<a name="l00922"></a>00922                                       <span class="stringliteral">&quot;requested variant.\n&quot;</span>);
<a name="l00923"></a>00923                             <span class="keywordflow">goto</span> cont;
<a name="l00924"></a>00924                          }
<a name="l00925"></a>00925                        data_lists-&gt;variant_list =
<a name="l00926"></a>00926                          <a class="code" href="group__Eina__List__Group.html#ga92ec14d1a1040a361c4d8cd0ab7b0ecc" title="Appends the given data to the given linked list.">eina_list_append</a>(data_lists-&gt;variant_list, va);
<a name="l00927"></a>00927                        <span class="keywordflow">break</span>;
<a name="l00928"></a>00928 
<a name="l00929"></a>00929                      <span class="keywordflow">case</span> 2:
<a name="l00930"></a>00930                        <span class="keywordflow">if</span> (argc != 7)
<a name="l00931"></a>00931                          {
<a name="l00932"></a>00932                             fprintf(
<a name="l00933"></a>00933                               stderr, <span class="stringliteral">&quot;ERROR: wrong number of parameters&quot;</span>
<a name="l00934"></a>00934                                       <span class="stringliteral">&quot; (%d).\n&quot;</span>, argc);
<a name="l00935"></a>00935                             <span class="keywordflow">goto</span> cont;
<a name="l00936"></a>00936                          }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938                        va = _variant_2_new(argv[5], argv[6]);
<a name="l00939"></a>00939                        <span class="keywordflow">if</span> (!va)
<a name="l00940"></a>00940                          {
<a name="l00941"></a>00941                             fprintf(
<a name="l00942"></a>00942                               stderr, <span class="stringliteral">&quot;ERROR: could not create the &quot;</span>
<a name="l00943"></a>00943                                       <span class="stringliteral">&quot;requested variant.\n&quot;</span>);
<a name="l00944"></a>00944                             <span class="keywordflow">goto</span> cont;
<a name="l00945"></a>00945                          }
<a name="l00946"></a>00946                        data_lists-&gt;variant_list =
<a name="l00947"></a>00947                          <a class="code" href="group__Eina__List__Group.html#ga92ec14d1a1040a361c4d8cd0ab7b0ecc" title="Appends the given data to the given linked list.">eina_list_append</a>(data_lists-&gt;variant_list, va);
<a name="l00948"></a>00948                        <span class="keywordflow">break</span>;
<a name="l00949"></a>00949 
<a name="l00950"></a>00950                      <span class="keywordflow">case</span> 3:
<a name="l00951"></a>00951                        <span class="keywordflow">if</span> (argc != 6)
<a name="l00952"></a>00952                          {
<a name="l00953"></a>00953                             fprintf(
<a name="l00954"></a>00954                               stderr, <span class="stringliteral">&quot;ERROR: wrong number of parameters&quot;</span>
<a name="l00955"></a>00955                                       <span class="stringliteral">&quot; (%d).\n&quot;</span>, argc);
<a name="l00956"></a>00956                             <span class="keywordflow">goto</span> cont;
<a name="l00957"></a>00957                          }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959                        va = _variant_3_new(argv[5]);
<a name="l00960"></a>00960                        <span class="keywordflow">if</span> (!va)
<a name="l00961"></a>00961                          {
<a name="l00962"></a>00962                             fprintf(
<a name="l00963"></a>00963                               stderr, <span class="stringliteral">&quot;ERROR: could not create the &quot;</span>
<a name="l00964"></a>00964                                       <span class="stringliteral">&quot;requested variant.\n&quot;</span>);
<a name="l00965"></a>00965                             <span class="keywordflow">goto</span> cont;
<a name="l00966"></a>00966                          }
<a name="l00967"></a>00967                        data_lists-&gt;variant_list =
<a name="l00968"></a>00968                          <a class="code" href="group__Eina__List__Group.html#ga92ec14d1a1040a361c4d8cd0ab7b0ecc" title="Appends the given data to the given linked list.">eina_list_append</a>(data_lists-&gt;variant_list, va);
<a name="l00969"></a>00969                        <span class="keywordflow">break</span>;
<a name="l00970"></a>00970 
<a name="l00971"></a>00971                      <span class="keywordflow">default</span>:
<a name="l00972"></a>00972                        fprintf(
<a name="l00973"></a>00973                          stderr, <span class="stringliteral">&quot;ERROR: bad type of of struct passed\n&quot;</span>);
<a name="l00974"></a>00974                        <span class="keywordflow">goto</span> cont;
<a name="l00975"></a>00975                     }
<a name="l00976"></a>00976                }
<a name="l00977"></a>00977              <span class="keywordflow">else</span>
<a name="l00978"></a>00978                fprintf(stderr,
<a name="l00979"></a>00979                        <span class="stringliteral">&quot;ERROR: wrong number of parameters (%d).\n&quot;</span>,
<a name="l00980"></a>00980                        argc);
<a name="l00981"></a>00981           }
<a name="l00982"></a>00982         <span class="keywordflow">else</span>
<a name="l00983"></a>00983           fprintf(stderr, <span class="stringliteral">&quot;ERROR: unknown action &#39;%s&#39;\n&quot;</span>, argv[3]);
<a name="l00984"></a>00984      }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 cont:
<a name="l00987"></a>00987    printf(<span class="stringliteral">&quot;Cached data:\n&quot;</span>);
<a name="l00988"></a>00988 
<a name="l00989"></a>00989    printf(<span class="stringliteral">&quot;\tstats: unions=%u, variants=%u\n&quot;</span>,
<a name="l00990"></a>00990           <a class="code" href="group__Eina__List__Group.html#ga301729054a498a2df09a5f1dd760697e" title="Gets the count of the number of items in a list.">eina_list_count</a>(data_lists-&gt;union_list),
<a name="l00991"></a>00991           <a class="code" href="group__Eina__List__Group.html#ga301729054a498a2df09a5f1dd760697e" title="Gets the count of the number of items in a list.">eina_list_count</a>(data_lists-&gt;variant_list));
<a name="l00992"></a>00992 
<a name="l00993"></a>00993    <span class="keywordflow">if</span> (<a class="code" href="group__Eina__List__Group.html#ga301729054a498a2df09a5f1dd760697e" title="Gets the count of the number of items in a list.">eina_list_count</a>(data_lists-&gt;union_list))
<a name="l00994"></a>00994      {
<a name="l00995"></a>00995         <span class="keyword">const</span> <a class="code" href="struct__Eina__List.html">Eina_List</a> *l;
<a name="l00996"></a>00996         <span class="keyword">const</span> Example_Union *un;
<a name="l00997"></a>00997         printf(<span class="stringliteral">&quot;\t  * union list:\n&quot;</span>);
<a name="l00998"></a>00998 
<a name="l00999"></a>00999         <a class="code" href="group__Eina__List__Group.html#gad02f746a08ee0b12b7ed66d4bc0d71d8" title="Definition for the macro to iterate over a list.">EINA_LIST_FOREACH</a>(data_lists-&gt;union_list, l, un)
<a name="l01000"></a>01000           {
<a name="l01001"></a>01001              _print_union(un);
<a name="l01002"></a>01002           }
<a name="l01003"></a>01003      }
<a name="l01004"></a>01004 
<a name="l01005"></a>01005    <span class="keywordflow">if</span> (<a class="code" href="group__Eina__List__Group.html#ga301729054a498a2df09a5f1dd760697e" title="Gets the count of the number of items in a list.">eina_list_count</a>(data_lists-&gt;variant_list))
<a name="l01006"></a>01006      {
<a name="l01007"></a>01007         <span class="keyword">const</span> <a class="code" href="struct__Eina__List.html">Eina_List</a> *l;
<a name="l01008"></a>01008         <span class="keyword">const</span> Example_Variant *un;
<a name="l01009"></a>01009         printf(<span class="stringliteral">&quot;\t  * variant list:\n&quot;</span>);
<a name="l01010"></a>01010 
<a name="l01011"></a>01011         <a class="code" href="group__Eina__List__Group.html#gad02f746a08ee0b12b7ed66d4bc0d71d8" title="Definition for the macro to iterate over a list.">EINA_LIST_FOREACH</a>(data_lists-&gt;variant_list, l, un)
<a name="l01012"></a>01012           {
<a name="l01013"></a>01013              _print_variant(un);
<a name="l01014"></a>01014           }
<a name="l01015"></a>01015      }
<a name="l01016"></a>01016 
<a name="l01017"></a>01017    printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019    <span class="keywordflow">if</span> (!_data_save(data_lists, argv[2]))
<a name="l01020"></a>01020      ret = -3;
<a name="l01021"></a>01021 
<a name="l01022"></a>01022    _data_free(data_lists);
<a name="l01023"></a>01023 
<a name="l01024"></a>01024 end:
<a name="l01025"></a>01025    <span class="keywordflow">if</span> (_cache_file)
<a name="l01026"></a>01026      <a class="code" href="group__Eet__File__Group.html#ga905997371fed881b82b2b00a19cce398" title="Closes an eet file handle and flush pending writes.">eet_close</a>(_cache_file);
<a name="l01027"></a>01027    _data_descriptors_shutdown();
<a name="l01028"></a>01028    <a class="code" href="group__Eet__Group.html#ga11de4314e79e759cef42383a55f8339f" title="Shuts down the EET library.">eet_shutdown</a>();
<a name="l01029"></a>01029    <a class="code" href="group__Eina__Main__Group.html#ga2c8b4020427108a30c44707af22c99d3" title="Shuts down the Eina library.">eina_shutdown</a>();
<a name="l01030"></a>01030 
<a name="l01031"></a>01031    <span class="keywordflow">return</span> ret;
<a name="l01032"></a>01032 } <span class="comment">/* main */</span>
<a name="l01033"></a>01033 
</pre></div> </div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
