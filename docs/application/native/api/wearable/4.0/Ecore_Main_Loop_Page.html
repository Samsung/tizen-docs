<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: The Ecore Main Loop</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Tizen Native API"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   &#160;<span id="projectnumber">4.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('Ecore_Main_Loop_Page.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">The Ecore Main Loop </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="Ecore_Main_Loop_Page_intro"></a>
What is Ecore?</h2>
<p>Ecore is a clean and tiny event loop library with many modules to do lots of convenient things for a programmer to save time and effort. It's small and lean, designed to work from embedded systems all the way up to large and powerful multi-cpu workstations. The main loop has a number of primitives to be used with its main loop. It serializes all the primitives and allows for great responsiveness without the need for threads(or any other concurrency).</p>
<h3><a class="anchor" id="timers"></a>
Timers</h3>
<p>Timers serve two main purposes: doing something at a specified time and repeatedly doing something with a set interval.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__Ecore__Timer__Group.html">Ecore Timer functions</a></dd></dl>
<h3><a class="anchor" id="pollers"></a>
Pollers</h3>
<p>Pollers allow for polling to be centralized into a single place therefore alleviating the need for different parts of the program to wake up at different times to do polling, thereby making the code simpler and more efficient.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__Ecore__Poller__Group.html">Ecore Poll functions</a></dd></dl>
<h3><a class="anchor" id="idler"></a>
Idlers</h3>
<p>There are three types of idlers: enterers, idlers(proper) and exiters. They are called, respectively, when the program is about to enter an idle state, when the program is idle, and when the program is leaving an idle state. Idler enterers are usually a good place to update the program state. Proper idlers are the appropriate place to do heavy computational tasks thereby using what would otherwise be wasted CPU cycles. Exiters are the perfect place to do anything your program should do just before processing events (also timers, pollers, file descriptor handlers and animators)</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__Ecore__Idle__Group.html">Ecore Idle functions</a></dd></dl>
<h3><a class="anchor" id="fd_handler"></a>
File descriptor handlers</h3>
<p>File descriptor handlers allow you to monitor when there is data available to read on file descriptors, when writing will not block, or if there was an error. Any valid file descriptor can be used with this API, regardless of if was gotten with an OS specific API or from ecore.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__Ecore__FD__Handler__Group.html" title="Definition for functions that deal with file descriptor handlers.">File Descriptor Handling Functions</a></dd></dl>
<h3><a class="anchor" id="animators"></a>
Animators</h3>
<p>Ecore provides a facility called animators, so named since the intended use was in animations, that facilitates knowing what percentage of a given interval has elapsed. This is perfect for performing animations, but is not limited to that use, it can, for example, also be used to create a progress bar.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__Ecore__Animator__Group.html" title="Ecore animators are a helper to simplify creating animations.">Ecore Animator functions</a></dd></dl>
<h3><a class="anchor" id="ev_handlers"></a>
Event handlers</h3>
<p>Event handlers are, arguably, the most important feature of the ecore main loop, they are what allows the programmer to easily handle user interaction. Events however are not only things the user does, events can represent anything for which a type is created.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__Ecore__Event__Group.html">Ecore Event functions</a> All of these primitives are discussed in more detail in their respective pages linked above.</dd></dl>
<p>Here is a diagram of the main loop flow of a simple program:</p>
<div class="image">
<img src="prog_flow.png" alt="prog_flow.png"/>
</div>
 <h2><a class="anchor" id="Ecore_Main_Loop_Page_work"></a>
How does Ecore work?</h2>
<p>Ecore is very easy to learn and use. All the function calls are designed to be easy to remember, explicit in describing what they do, and heavily name-spaced. Ecore programs can start and be very simple.</p>
<p>For example:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;Ecore.h&gt;</span>

 <span class="keywordtype">int</span>
 main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> **argv)
 {
    <a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();
    <a class="code" href="group__Ecore__Application__Group.html#ga70bce8ffb6e2dc2c0fdab005d566532e">ecore_app_args_set</a>(argc, argv);
    <a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();
    <a class="code" href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a>();
    <span class="keywordflow">return</span> 0;
 }
</pre></div><p>This program is very simple and doesn't check for errors, but it does start up and begin a main loop waiting for events or timers to tick off. This program doesn't set up any, but now we can expand on this simple program a little more by adding some event handlers and timers.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;Ecore.h&gt;</span>

 <a class="code" href="group__Ecore__Timer__Group.html#gaf96ffb609956658ec038e54bd39f46f0">Ecore_Timer</a>         *timer1     = NULL;
 <a class="code" href="group__Ecore__Event__Group.html#ga252a2566c9c7c9094964ab8e157f0521">Ecore_Event_Handler</a> *handler1   = NULL;
 <span class="keywordtype">double</span>               start_time = 0.0;

 <span class="keywordtype">int</span>
 timer_func(<span class="keywordtype">void</span> *data)
 {
    printf(<span class="stringliteral">&quot;Tick timer. Sec: %3.2f\n&quot;</span>, <a class="code" href="group__Ecore__Time__Group.html#ga98f2439b5d3e7114a75bfe2f0c22c4e9">ecore_time_get</a>() - start_time);
    <span class="keywordflow">return</span> <a class="code" href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a>;
 }

 <span class="keywordtype">int</span>
 exit_func(<span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> ev_type, <span class="keywordtype">void</span> *ev)
 {
    <a class="code" href="struct__Ecore__Event__Signal__Exit.html" title="A structure that stores information of an Exit request event.">Ecore_Event_Signal_Exit</a> *e;

    e = (<a class="code" href="struct__Ecore__Event__Signal__Exit.html" title="A structure that stores information of an Exit request event.">Ecore_Event_Signal_Exit</a> *)ev;
    <span class="keywordflow">if</span> (e-&gt;<a class="code" href="struct__Ecore__Event__Signal__Exit.html#a75a11bba7c7e80245220a80085ad9b25">interrupt</a>)      printf(<span class="stringliteral">&quot;Exit: interrupt\n&quot;</span>);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="struct__Ecore__Event__Signal__Exit.html#a9859b9dfe71ede48069c219cdaff9e3c">quit</a>)      printf(<span class="stringliteral">&quot;Exit: quit\n&quot;</span>);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="struct__Ecore__Event__Signal__Exit.html#ac5e1afacd480efe389e699c52f6dd4d6">terminate</a>) printf(<span class="stringliteral">&quot;Exit: terminate\n&quot;</span>);
    <a class="code" href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a>();
    <span class="keywordflow">return</span> 1;
 }

 <span class="keywordtype">int</span>
 main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> **argv)
 {
    <a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();
    <a class="code" href="group__Ecore__Application__Group.html#ga70bce8ffb6e2dc2c0fdab005d566532e">ecore_app_args_set</a>(argc, argv);
    start_time = <a class="code" href="group__Ecore__Time__Group.html#ga98f2439b5d3e7114a75bfe2f0c22c4e9">ecore_time_get</a>();
    handler1 = <a class="code" href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62" title="Adds an event handler.">ecore_event_handler_add</a>(<a class="code" href="group__Ecore__Event__Group.html#ga0dd1e36930ae8fa8decc97564d57f310">ECORE_EVENT_SIGNAL_EXIT</a>, exit_func, NULL);
    timer1 = <a class="code" href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add</a>(0.5, timer_func, NULL);
    <a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();
    <a class="code" href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a>();
    <span class="keywordflow">return</span> 0;
 }
</pre></div><p>In the previous example, we initialize our application and get the time at which our program has started so we can calculate an offset. We set up a timer to tick off in 0.5 seconds, and since it returns 1, will keep ticking off every 0.5 seconds until it returns 0, or is deleted by hand. An event handler is set up to call a function - exit_func(), whenever an event of type ECORE_EVENT_SIGNAL_EXIT is received (CTRL-C on the command line will cause such an event to happen). If this event occurs it tells you what kind of exit signal was received, and asks the main loop to quit when it is finished by calling <a class="el" href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit()</a>.</p>
<p>The handles returned by <a class="el" href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add()</a> and <a class="el" href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62" title="Adds an event handler.">ecore_event_handler_add()</a> are only stored here as an example. If you don't need to address the timer or event handler again you don't need to store the result, so just call the function, and don't assign the result to any variable.</p>
<p>This program looks slightly more complex than needed to do these simple things, but in principle, programs don't get any more complex. You add more event handlers, for more events, will have more timers and such, BUT it all follows the same principles as shown in this example. </p>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
