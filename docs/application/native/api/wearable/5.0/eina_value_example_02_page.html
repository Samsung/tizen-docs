<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tizen Native API: Eina_Value struct usage</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_html_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Tizen Native API"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tizen Native API
   &#160;<span id="projectnumber">5.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>The&#160;Basics&#160;of&#160;Tizen&#160;Native&#160;API&#160;Reference</span></a></li>
      <li><a href="modules.html"><span>Native&#160;API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('eina_value_example_02_page.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Eina_Value struct usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example will examine a hypothetical situation in which we had a structure(which represented parameters) with two fields, and then need to add a third field to our structure. If using structs directly we'd need to rewrite every piece of code that touches the struct, by using eina value, and thus having the compiler not even know the struct, we can reduce the amount of changes needed and retain interoperability between the old and new format.</p>
<p>Our example will start with a function that creates descriptions of both of our structs for eina value usage. The first step is to create a struct and describe its members: <div class="fragment"><pre class="fragment"><span class="comment">//Compile with:</span>
<span class="comment">//gcc eina_value_02.c -o eina_value_02 `pkg-config --cflags --libs eina`</span>

<span class="preprocessor">#include &lt;Eina.h&gt;</span>

<span class="keyword">static</span> <a class="code" href="struct__Eina__Value__Struct__Desc.html">Eina_Value_Struct_Desc</a> *V1_DESC = NULL;
<span class="keyword">static</span> <a class="code" href="struct__Eina__Value__Struct__Desc.html">Eina_Value_Struct_Desc</a> *V2_DESC = NULL;

<span class="keywordtype">void</span> value_init(<span class="keywordtype">void</span>)
{
   <span class="keyword">typedef</span> <span class="keyword">struct </span>_My_Struct_V1 {
     <span class="keywordtype">int</span> param1;
     <span class="keywordtype">char</span> param2;
   } My_Struct_V1;


   <span class="keyword">static</span> <a class="code" href="struct__Eina__Value__Struct__Member.html">Eina_Value_Struct_Member</a> v1_members[] = {
     <span class="comment">// no eina_value_type as they are not constant initializers, see below.</span>
     <a class="code" href="group__Eina__Value__Struct__Group.html#ga139206ef35b0b76e87eef56a202c0ae9">EINA_VALUE_STRUCT_MEMBER</a>(NULL, My_Struct_V1, param1),
     <a class="code" href="group__Eina__Value__Struct__Group.html#ga139206ef35b0b76e87eef56a202c0ae9">EINA_VALUE_STRUCT_MEMBER</a>(NULL, My_Struct_V1, param2)
   };
   v1_members[0].<a class="code" href="struct__Eina__Value__Struct__Member.html#a615cdf08597bd18623c8c7daec7b4641">type</a> = <a class="code" href="group__Eina__Value__Group.html#ga17974fd9ab773a3efefd591ffde58f77">EINA_VALUE_TYPE_INT</a>;
   v1_members[1].<a class="code" href="struct__Eina__Value__Struct__Member.html#a615cdf08597bd18623c8c7daec7b4641">type</a> = <a class="code" href="group__Eina__Value__Group.html#ga0d54e0b952b44b7ac4f2fd573f7839c0">EINA_VALUE_TYPE_CHAR</a>;
</pre></div> </p>
<dl class="note"><dt><b>Note:</b></dt><dd>We can't pass the types of the members to EINA_VALUE_STRUCT_MEMBER macro because they are not constant initializers.</dd></dl>
<p>So far it should be pretty easy to understand, we said <code>My_Struct_V1</code> has two members, one of type <code>int</code> and another of type <code>char</code>. We now create the description of the actual struct, again nothing overly complex, we signal which version of EINA_VALUE_STRUCT we're using, we declare no special operations, our members and our size: <div class="fragment"><pre class="fragment">   <span class="keyword">static</span> <a class="code" href="struct__Eina__Value__Struct__Desc.html">Eina_Value_Struct_Desc</a> v1_desc = {
     <a class="code" href="group__Eina__Value__Struct__Group.html#gae76aada4965672ce991f1f41baf71975">EINA_VALUE_STRUCT_DESC_VERSION</a>,
     NULL, <span class="comment">// no special operations</span>
     v1_members,
     <a class="code" href="group__Eina__Types__Group.html#ga7c1b6f81660b4e30516169e9e7d3261c">EINA_C_ARRAY_LENGTH</a>(v1_members),
     <span class="keyword">sizeof</span>(My_Struct_V1)
   };
   V1_DESC = &amp;v1_desc;
</pre></div></p>
<p>We now repeat the process for the second version of our struct, the only difference is the addition of a third parameter of type <code>int</code> : <div class="fragment"><pre class="fragment">
   <span class="keyword">typedef</span> <span class="keyword">struct </span>_My_Struct_V2 {
     <span class="keywordtype">int</span> param1;
     <span class="keywordtype">char</span> param2;
     <span class="keywordtype">int</span> param3;
   } My_Struct_V2;
   <span class="keyword">static</span> <a class="code" href="struct__Eina__Value__Struct__Member.html">Eina_Value_Struct_Member</a> v2_members[] = {
     <span class="comment">// no eina_value_type as they are not constant initializers, see below.</span>
     <a class="code" href="group__Eina__Value__Struct__Group.html#ga139206ef35b0b76e87eef56a202c0ae9">EINA_VALUE_STRUCT_MEMBER</a>(NULL, My_Struct_V2, param1),
     <a class="code" href="group__Eina__Value__Struct__Group.html#ga139206ef35b0b76e87eef56a202c0ae9">EINA_VALUE_STRUCT_MEMBER</a>(NULL, My_Struct_V2, param2),
     <a class="code" href="group__Eina__Value__Struct__Group.html#ga139206ef35b0b76e87eef56a202c0ae9">EINA_VALUE_STRUCT_MEMBER</a>(NULL, My_Struct_V2, param3)
   };
   v2_members[0].<a class="code" href="struct__Eina__Value__Struct__Member.html#a615cdf08597bd18623c8c7daec7b4641">type</a> = <a class="code" href="group__Eina__Value__Group.html#ga17974fd9ab773a3efefd591ffde58f77">EINA_VALUE_TYPE_INT</a>;
   v2_members[1].<a class="code" href="struct__Eina__Value__Struct__Member.html#a615cdf08597bd18623c8c7daec7b4641">type</a> = <a class="code" href="group__Eina__Value__Group.html#ga0d54e0b952b44b7ac4f2fd573f7839c0">EINA_VALUE_TYPE_CHAR</a>;
   v2_members[2].<a class="code" href="struct__Eina__Value__Struct__Member.html#a615cdf08597bd18623c8c7daec7b4641">type</a> = <a class="code" href="group__Eina__Value__Group.html#ga17974fd9ab773a3efefd591ffde58f77">EINA_VALUE_TYPE_INT</a>;
   <span class="keyword">static</span> <a class="code" href="struct__Eina__Value__Struct__Desc.html">Eina_Value_Struct_Desc</a> v2_desc = {
     <a class="code" href="group__Eina__Value__Struct__Group.html#gae76aada4965672ce991f1f41baf71975">EINA_VALUE_STRUCT_DESC_VERSION</a>,
     NULL, <span class="comment">// no special operations</span>
     v2_members,
     <a class="code" href="group__Eina__Types__Group.html#ga7c1b6f81660b4e30516169e9e7d3261c">EINA_C_ARRAY_LENGTH</a>(v2_members),
     <span class="keyword">sizeof</span>(My_Struct_V2)
   };
   V2_DESC = &amp;v2_desc;
}
</pre></div></p>
<p>We'll now look at a function that sets the values of our structs. For simplicity's sake we initialize it we random values, a real world case would read these values from a file, a database or even from the network. The fundamental detail here is that this function works for both V1 and V2 structs, this is because setting a parameter that a struct that doesn't have does nothing without throwing any errors: <div class="fragment"><pre class="fragment">
<span class="keywordtype">void</span> rand_init(<a class="code" href="struct__Eina__Value.html">Eina_Value</a> *v)
{
   <span class="keywordflow">if</span> (v-&gt;<a class="code" href="struct__Eina__Value.html#a1fd07b3214c901eec252a786cca47239">type</a> != <a class="code" href="group__Eina__Value__Group.html#ga8147143699c5f5a686415090080d3f9e">EINA_VALUE_TYPE_STRUCT</a>)
     <span class="keywordflow">return</span>;

   <a class="code" href="group__Eina__Value__Struct__Group.html#ga476aa64a399aba776fa14f2fb065b268" title="Sets the generic value in a struct member.">eina_value_struct_set</a>(v, <span class="stringliteral">&quot;param1&quot;</span>, rand());
   <a class="code" href="group__Eina__Value__Struct__Group.html#ga476aa64a399aba776fa14f2fb065b268" title="Sets the generic value in a struct member.">eina_value_struct_set</a>(v, <span class="stringliteral">&quot;param2&quot;</span>, rand() % 256);
   <a class="code" href="group__Eina__Value__Struct__Group.html#ga476aa64a399aba776fa14f2fb065b268" title="Sets the generic value in a struct member.">eina_value_struct_set</a>(v, <span class="stringliteral">&quot;param3&quot;</span>, rand());
}
</pre></div> </p>
<dl class="note"><dt><b>Note:</b></dt><dd>While using <a class="el" href="group__Eina__Value__Struct__Group.html#ga476aa64a399aba776fa14f2fb065b268" title="Sets the generic value in a struct member.">eina_value_struct_set()</a> with an in-existing parameter causes no error, it does return <a class="el" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>, to notify it was not possible to set the value. This could be used to determine that we're handling a V1 struct and take some action based on that.</dd></dl>
<p>The next thing is to do is see what a function that uses the values of the struct looks like. We'll again be very simplistic in our usage, we'll just print the values, but a real world case, might send these values to another process use them to open a network/database connection or anything else. Since all versions of the struct have <code>param1</code> and <code>param2</code> we'll unconditionally use them: <div class="fragment"><pre class="fragment">
<span class="keywordtype">void</span> my_struct_use(<a class="code" href="struct__Eina__Value.html">Eina_Value</a> *params)
{
   <span class="keywordtype">int</span> p1, p3;
   <span class="keywordtype">char</span> p2;

   <a class="code" href="group__Eina__Value__Struct__Group.html#ga07a7cc420f03a247dffe4d13ce1ad6c5" title="Gets the generic value from a struct member.">eina_value_struct_get</a>(params, <span class="stringliteral">&quot;param1&quot;</span>, &amp;p1);
   <a class="code" href="group__Eina__Value__Struct__Group.html#ga07a7cc420f03a247dffe4d13ce1ad6c5" title="Gets the generic value from a struct member.">eina_value_struct_get</a>(params, <span class="stringliteral">&quot;param2&quot;</span>, &amp;p2);
   printf(<span class="stringliteral">&quot;param1: %d\nparam2: %c\n&quot;</span>, p1, p2);
</pre></div></p>
<p>The next step is to conditionally use <code>param3</code>, which can fortunately be done in the same step in which we get it's value: <div class="fragment"><pre class="fragment">
   <span class="keywordflow">if</span> (<a class="code" href="group__Eina__Value__Struct__Group.html#ga07a7cc420f03a247dffe4d13ce1ad6c5" title="Gets the generic value from a struct member.">eina_value_struct_get</a>(params, <span class="stringliteral">&quot;param3&quot;</span>, &amp;p3))
     printf(<span class="stringliteral">&quot;param3: %d\n&quot;</span>, p3);
}
</pre></div></p>
<p>There we've now got functions that can both populate and use values from both our structs, so now let's actually use them in our main function by creating a struct of each type, initializing them and them using them: <div class="fragment"><pre class="fragment">
<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
   (void)argc;
   (void)argv;
   <a class="code" href="struct__Eina__Value.html">Eina_Value</a> *v1, *v2;

   <a class="code" href="group__Eina__Main__Group.html#gafee4bfc0e509b6ffed6598edf6f4b3de" title="Initializes the Eina library.">eina_init</a>();
   value_init();
   srand(time(NULL));

   v1 = <a class="code" href="group__Eina__Value__Struct__Group.html#gaf469abb97ac59b73e8b2c726a58a78f8" title="Creates generic value storage of type struct.">eina_value_struct_new</a>(V1_DESC);
   v2 = <a class="code" href="group__Eina__Value__Struct__Group.html#gaf469abb97ac59b73e8b2c726a58a78f8" title="Creates generic value storage of type struct.">eina_value_struct_new</a>(V2_DESC);

   rand_init(v1);
   my_struct_use(v1);

   rand_init(v2);
   my_struct_use(v2);

   <a class="code" href="group__Eina__Value__Value__Group.html#gaa2aa7ac9d1fcd7c4497cf104cb374a52" title="Frees value and its data.">eina_value_free</a>(v1);
   <a class="code" href="group__Eina__Value__Value__Group.html#gaa2aa7ac9d1fcd7c4497cf104cb374a52" title="Frees value and its data.">eina_value_free</a>(v2);
   <a class="code" href="group__Eina__Main__Group.html#ga2c8b4020427108a30c44707af22c99d3" title="Shuts down the Eina library.">eina_shutdown</a>();
}
</pre></div></p>
<p>This concludes our example. For the full source code see <a class="el" href="eina_value_02_c.html">eina_value_02.c</a>. </p>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
<hr size="1"/>
<center>
<small>Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a>
and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.&nbsp;</small>
</center>
</body>
</html>
